<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="Kinetic Orbit Runaway electrons Code (KORC) - Full Orbit">
    
    <meta name="author" content="Matt Beidler" >
    <link rel="icon" href="../favicon.png">

    <title>korc_types.f90 &ndash; KORC-Full Orbit</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">KORC-Full Orbit </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>README</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/main.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/main.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>korc_types.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 1.4% of total for source files.">305 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/korc_types.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">korc_types.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/korc_types.html">korc_types</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/korc_types.f90.html#src">korc_types.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
      
      

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/korc_types.html">korc_types</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/korc_types.f90.html#src">korc_types.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="k">module </span><span class="n">korc_types</span>
<a name="ln-2"></a>  <span class="c">!! @note Module containing the definition of KORC derived types and</span>
<a name="ln-3"></a>  <span class="c">!! KORC variables, the building blocks of the code. @endnote</span>
<a name="ln-4"></a><span class="cp">#ifdef M3D_C1</span>
<a name="ln-5"></a>  <span class="k">USE</span><span class="p">,</span> <span class="k">INTRINSIC</span> <span class="kd">::</span> <span class="nb">iso_c_binding</span>
<a name="ln-6"></a><span class="cp">#endif</span>
<a name="ln-7"></a>  <span class="k">implicit none</span>
<a name="ln-8"></a>
<a name="ln-9"></a>  <span class="c">! * * * * * * * * * * * * * * * * * * * * !</span>
<a name="ln-10"></a>  <span class="c">! * * * Real and integer precisions * * * !</span>
<a name="ln-11"></a>  <span class="c">! * * * * * * * * * * * * * * * * * * * * !</span>
<a name="ln-12"></a>
<a name="ln-13"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PUBLIC</span><span class="p">,</span> <span class="k">PARAMETER</span> 	<span class="kd">::</span> <span class="k">is</span> <span class="o">=</span> <span class="nb">KIND</span><span class="p">(</span><span class="nb">INT</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> 
<a name="ln-14"></a>  <span class="c">!! Definition of 1 Byte (8 bits) Fortran KORC integer type.</span>
<a name="ln-15"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PUBLIC</span><span class="p">,</span> <span class="k">PARAMETER</span> 	<span class="kd">::</span> <span class="n">ip</span> <span class="o">=</span> <span class="nb">KIND</span><span class="p">(</span><span class="nb">INT</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span> 
<a name="ln-16"></a>  <span class="c">!! Definition of 8 Bytes (64 bits) Fortran KORC integer type.</span>
<a name="ln-17"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PUBLIC</span><span class="p">,</span> <span class="k">PARAMETER</span> 	<span class="kd">::</span> <span class="n">idef</span> <span class="o">=</span> <span class="nb">KIND</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> 
<a name="ln-18"></a>  <span class="c">!! Definition of the default KORC integer type on the system where</span>
<a name="ln-19"></a>  <span class="c">!! KORC is compiled.</span>
<a name="ln-20"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PUBLIC</span><span class="p">,</span> <span class="k">PARAMETER</span> 	<span class="kd">::</span> <span class="n">rdef</span> <span class="o">=</span> <span class="nb">KIND</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span> 
<a name="ln-21"></a>  <span class="c">!! Definition of the default KORC real type on the system where</span>
<a name="ln-22"></a>  <span class="c">!! KORC is compiled.</span>
<a name="ln-23"></a><span class="cp">#ifdef DOUBLE_PRECISION</span>
<a name="ln-24"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PUBLIC</span><span class="p">,</span> <span class="k">PARAMETER</span> 	<span class="kd">::</span> <span class="n">rp</span> <span class="o">=</span> <span class="nb">KIND</span><span class="p">(</span><span class="mf">0.d0</span><span class="p">)</span> 
<a name="ln-25"></a>  <span class="c">!! Definition of the KORC double precision real type.</span>
<a name="ln-26"></a><span class="cp">#elif SINGLE_PRECISION</span>
<a name="ln-27"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PUBLIC</span><span class="p">,</span> <span class="k">PARAMETER</span> 	<span class="kd">::</span> <span class="n">rp</span> <span class="o">=</span> <span class="nb">KIND</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span> 
<a name="ln-28"></a>  <span class="c">!! Definition of the KORC single precision real type.</span>
<a name="ln-29"></a><span class="cp">#endif</span>
<a name="ln-30"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">PUBLIC</span><span class="p">,</span> <span class="k">PARAMETER</span> <span class="kd">::</span> <span class="n">korc_zero</span> <span class="o">=</span> <span class="mf">1.0E-15</span> 
<a name="ln-31"></a>  <span class="c">!! Definition of the zero in KORC.</span>
<a name="ln-32"></a>
<a name="ln-33"></a>  <span class="c">! * * * * * * * * * * * * * * * * * * * * !</span>
<a name="ln-34"></a>  <span class="c">! * * * Real and integer precisions * * * !</span>
<a name="ln-35"></a>  <span class="c">! * * * * * * * * * * * * * * * * * * * * !</span>
<a name="ln-36"></a>
<a name="ln-37"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PUBLIC</span><span class="p">,</span> <span class="k">PARAMETER</span> 	<span class="kd">::</span> <span class="n">MAX_STRING_LENGTH</span> <span class="o">=</span> <span class="mi">1000</span> 
<a name="ln-38"></a>  <span class="c">!! Default length of a KORC_STRING variable.</span>
<a name="ln-39"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PUBLIC</span><span class="p">,</span> <span class="k">PARAMETER</span> 	<span class="kd">::</span> <span class="n">default_unit_open</span> <span class="o">=</span> <span class="mi">101</span> 
<a name="ln-40"></a>  <span class="c">!! Default file unit for opening and reading from an external text file.</span>
<a name="ln-41"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PUBLIC</span><span class="p">,</span> <span class="k">PARAMETER</span> 	<span class="kd">::</span> <span class="n">default_unit_write</span> <span class="o">=</span> <span class="mi">201</span> 
<a name="ln-42"></a>  <span class="c">!! Default file unit for opening and writing to external an external text file.</span>
<a name="ln-43"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PUBLIC</span><span class="p">,</span> <span class="k">PARAMETER</span> 	<span class="kd">::</span> <span class="n">output_unit_write</span> <span class="o">=</span> <span class="mi">202</span> 
<a name="ln-44"></a>  <span class="c">!! Default file unit for opening and writing to external an external text file.</span>
<a name="ln-45"></a>
<a name="ln-46"></a>  <span class="c">!&gt; @note KORC string type of length MAX_STRING_LENGTH. @endnote</span>
<a name="ln-47"></a>  <span class="k">TYPE</span><span class="p">,</span> <span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">KORC_STRING</span> 
<a name="ln-48"></a>     <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>
<a name="ln-49"></a>  <span class="k">END TYPE </span><span class="n">KORC_STRING</span>
<a name="ln-50"></a>
<a name="ln-51"></a>  <span class="c">! * * * * * * * * * * * * * * * * * * * * !</span>
<a name="ln-52"></a>  <span class="c">! * * * Basic korc array structures * * * !</span>
<a name="ln-53"></a>  <span class="c">! * * * * * * * * * * * * * * * * * * * * !</span>
<a name="ln-54"></a>
<a name="ln-55"></a>  <span class="k">TYPE</span><span class="p">,</span> <span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">V_FIELD_3D</span>
<a name="ln-56"></a>     <span class="c">!! @note KORC 3-D vector field type @endnote</span>
<a name="ln-57"></a>     <span class="c">!! This KORC type represents a 3-D vector field varible in</span>
<a name="ln-58"></a>     <span class="c">!! cylindrical coordinates. For example, this could be the 3-D magnetic</span>
<a name="ln-59"></a>     <span class="c">!! field, which can be written as $$\mathbf{B}(R,\phi,Z) = B_R(R,\phi,Z)</span>
<a name="ln-60"></a>     <span class="c">!! \hat{R} + B_\phi(R,\phi,Z) \hat{\phi} + B_Z(R,\phi,Z) \hat{Z}.$$</span>
<a name="ln-61"></a>     <span class="c">!! All the members (components) of the V_FIELD_3D type follow the</span>
<a name="ln-62"></a>     <span class="c">!! following index convention:</span>
<a name="ln-63"></a>     <span class="c">!! (\(R\) index,\(\phi\) index, \(Z\) index)</span>
<a name="ln-64"></a>
<a name="ln-65"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:,:),</span> <span class="k">ALLOCATABLE</span> <span class="kd">::</span> <span class="n">R</span> 
<a name="ln-66"></a>     <span class="c">!! \(R\) component of the vector field variable.</span>
<a name="ln-67"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:,:),</span> <span class="k">ALLOCATABLE</span> <span class="kd">::</span> <span class="n">PHI</span> 
<a name="ln-68"></a>     <span class="c">!! \(\phi\) component of the vector field variable.</span>
<a name="ln-69"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:,:),</span> <span class="k">ALLOCATABLE</span> <span class="kd">::</span> <span class="n">Z</span> 
<a name="ln-70"></a>     <span class="c">!! \(Z\) component of the vector field variable.</span>
<a name="ln-71"></a>  <span class="k">END TYPE </span><span class="n">V_FIELD_3D</span>
<a name="ln-72"></a>
<a name="ln-73"></a>  <span class="k">TYPE</span><span class="p">,</span> <span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">V_FIELD_2D</span>
<a name="ln-74"></a>     <span class="c">!! @note KORC 2-D vector field type @endnote</span>
<a name="ln-75"></a>     <span class="c">!! This KORC type represents a 2-D vector field varible in cylindrical</span>
<a name="ln-76"></a>     <span class="c">!! coordinates. For example, this could be the magnetic</span>
<a name="ln-77"></a>     <span class="c">!! field in an axisymmetric plasma, which can be written as</span>
<a name="ln-78"></a>     <span class="c">!! $$\mathbf{B}(R,Z) = B_R(R,Z) \hat{R} + B_\phi(R,Z) \hat{\phi} + B_Z(R,Z)</span>
<a name="ln-79"></a>     <span class="c">!! \hat{Z}.$$</span>
<a name="ln-80"></a>     <span class="c">!! All the members (components) of the V_FIELD_2D type follow the</span>
<a name="ln-81"></a>     <span class="c">!! following index convention:</span>
<a name="ln-82"></a>     <span class="c">!! (\(R\) index,\(Z\) index).</span>
<a name="ln-83"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> <span class="kd">::</span> <span class="n">R</span> 
<a name="ln-84"></a>     <span class="c">!! \(R \) component of the vector field variable.</span>
<a name="ln-85"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> <span class="kd">::</span> <span class="n">PHI</span> 
<a name="ln-86"></a>     <span class="c">!! \(\phi \) component of the vector field variable.</span>
<a name="ln-87"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> <span class="kd">::</span> <span class="n">Z</span> 
<a name="ln-88"></a>     <span class="c">!! \(Z \) component of the vector field variable.</span>
<a name="ln-89"></a>  <span class="k">END TYPE </span><span class="n">V_FIELD_2D</span>
<a name="ln-90"></a>
<a name="ln-91"></a>  <span class="k">TYPE</span><span class="p">,</span> <span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">V_FIELD_1D</span>
<a name="ln-92"></a>     <span class="c">!! @note KORC 1-D vector field type @endnote</span>
<a name="ln-93"></a>     <span class="c">!! This KORC type represents a 1-D vector field varible in cylindrical</span>
<a name="ln-94"></a>     <span class="c">!! coordinates. For example, this could be the magnetic</span>
<a name="ln-95"></a>     <span class="c">!! field in an axisymmetric plasma, which can be written as</span>
<a name="ln-96"></a>     <span class="c">!! $$\mathbf{B}(r) = B_R(r) \hat{R} + B_\phi(r) \hat{\phi} + B_Z(r)</span>
<a name="ln-97"></a>     <span class="c">!! \hat{Z}.$$</span>
<a name="ln-98"></a>     <span class="c">!! All the members (components) of the V_FIELD_1D type follow the</span>
<a name="ln-99"></a>     <span class="c">!! following index convention:</span>
<a name="ln-100"></a>     <span class="c">!! (\(r\) index).</span>
<a name="ln-101"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> <span class="kd">::</span> <span class="n">R</span> 
<a name="ln-102"></a>     <span class="c">!! \(R \) component of the vector field variable.</span>
<a name="ln-103"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> <span class="kd">::</span> <span class="n">PHI</span> 
<a name="ln-104"></a>     <span class="c">!! \(\phi \) component of the vector field variable.</span>
<a name="ln-105"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> <span class="kd">::</span> <span class="n">Z</span> 
<a name="ln-106"></a>     <span class="c">!! \(Z \) component of the vector field variable.</span>
<a name="ln-107"></a>  <span class="k">END TYPE </span><span class="n">V_FIELD_1D</span>
<a name="ln-108"></a>  
<a name="ln-109"></a>  <span class="c">! * * * * * * * * * * * * * * * * * * * * !</span>
<a name="ln-110"></a>  <span class="c">! * * * Basic korc array structures * * * !</span>
<a name="ln-111"></a>  <span class="c">! * * * * * * * * * * * * * * * * * * * * !</span>
<a name="ln-112"></a>
<a name="ln-113"></a>  <span class="k">TYPE</span><span class="p">,</span> <span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">KORC_MPI</span>
<a name="ln-114"></a>     <span class="c">!! @note KORC derived type to keep relevant MPI parameters. @endnote</span>
<a name="ln-115"></a>     <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">nmpi</span> 
<a name="ln-116"></a>     <span class="c">!! Number of MPI processes.</span>
<a name="ln-117"></a>     <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">rank</span> 
<a name="ln-118"></a>     <span class="c">!! Rank in WORLD COMMON communicator.</span>
<a name="ln-119"></a>     <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">rank_topo</span> 
<a name="ln-120"></a>     <span class="c">!! Rank in mpi_topo communicator</span>
<a name="ln-121"></a>     <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">mpi_topo</span> 
<a name="ln-122"></a>     <span class="c">!! MPI communicator for a certain topology.</span>
<a name="ln-123"></a>  <span class="k">END TYPE </span><span class="n">KORC_MPI</span>
<a name="ln-124"></a>
<a name="ln-125"></a>
<a name="ln-126"></a>  <span class="k">TYPE</span><span class="p">,</span> <span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">CHARCS_PARAMS</span>
<a name="ln-127"></a>     <span class="c">!! @note KORC derived type containing characteristic scales used in the normalization of KORC variables. @endnote</span>
<a name="ln-128"></a>     <span class="c">!! These characteristic scales are problem-dependent quantities. They are calculated in [[korc_units(module)]] using the input</span>
<a name="ln-129"></a>     <span class="c">!! parameters of a given KORC simulation.</span>
<a name="ln-130"></a>
<a name="ln-131"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="nb">time</span>
<a name="ln-132"></a>     <span class="c">!! @note Characteristic non-relativistic time scale given by \(1/\omega_{ce}\), where \(\omega_{ce}=e B_0/m_e\) is the</span>
<a name="ln-133"></a>     <span class="c">!! largest electron cyclotron frequency in the simulation. @endnote</span>
<a name="ln-134"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">time_r</span>
<a name="ln-135"></a>     <span class="c">!! @note Characteristic relativistic time scale given by \(1/\omega_{ce}\), where \(\omega_{ce}=e B_0/\gamma m_e\) is the</span>
<a name="ln-136"></a>     <span class="c">!! largest relativistic electron cyclotron frequency in the simulation. @endnote</span>
<a name="ln-137"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">velocity</span> 
<a name="ln-138"></a>     <span class="c">!! Characteristic velocity. This is fixed to the speed of \(c\).</span>
<a name="ln-139"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">length</span> 
<a name="ln-140"></a>     <span class="c">!! Characteristic length scale calculated as \(c\) times the relativistic time scale.</span>
<a name="ln-141"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mass</span> 
<a name="ln-142"></a>     <span class="c">!! Characteristic particle mass. This is equal to the electron mass \(m_e\).</span>
<a name="ln-143"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">charge</span> 
<a name="ln-144"></a>     <span class="c">!! Characteristic particle charge. This is equal to the electron charge \(q_e\).</span>
<a name="ln-145"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">density</span> 
<a name="ln-146"></a>     <span class="c">!! Characteristic particle density. This is equal to \(1/l^3\), with \(l\) the characteristic length.</span>
<a name="ln-147"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Eo</span> 
<a name="ln-148"></a>     <span class="c">!! Characteristic electric field \(E_0\). Usually \(E_0\) at the magnetic axis.</span>
<a name="ln-149"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Bo</span> 
<a name="ln-150"></a>     <span class="c">!! Characteristic magnetic field \(B_0\). Usually \(B_0\) at the magnetic axis.</span>
<a name="ln-151"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">energy</span> 
<a name="ln-152"></a>     <span class="c">!! Characteristic energy. This is equal to \(m_e c^2\).</span>
<a name="ln-153"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">pressure</span> 
<a name="ln-154"></a>     <span class="c">!! Characteristic pressure. @todo This needs to be defined.</span>
<a name="ln-155"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">temperature</span> 
<a name="ln-156"></a>     <span class="c">!! Characteristic plasma temperature (Joules). This is equal to \(m_e c^2\).</span>
<a name="ln-157"></a>  <span class="k">END TYPE </span><span class="n">CHARCS_PARAMS</span>
<a name="ln-158"></a>
<a name="ln-159"></a>
<a name="ln-160"></a>  <span class="k">TYPE</span><span class="p">,</span> <span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">KORC_PARAMS</span>
<a name="ln-161"></a>     <span class="c">!! @note Core KORC parameters. @endnote</span>
<a name="ln-162"></a>     <span class="c">!!  This KORC derived type contains the variables that control KORC&#39;s</span>
<a name="ln-163"></a>     <span class="c">!! core behavior.</span>
<a name="ln-164"></a>
<a name="ln-165"></a>     <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path_to_inputs</span> 
<a name="ln-166"></a>     <span class="c">!! Absolute path to KORC&#39;s input file.</span>
<a name="ln-167"></a>     <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path_to_outputs</span> 
<a name="ln-168"></a>     <span class="c">!! Absolute path to the outputs&#39; folder.</span>
<a name="ln-169"></a>     <span class="kt">INTEGER</span> 			<span class="kd">::</span> <span class="n">num_omp_threads</span> 
<a name="ln-170"></a>     <span class="c">!! Number of open MP threads per MPI process used in the simulation.</span>
<a name="ln-171"></a>     <span class="kt">LOGICAL</span> 			<span class="kd">::</span> <span class="n">restart</span> 
<a name="ln-172"></a>     <span class="c">!! Flag to indicate if the simulations proceeds (restart=T) or not</span>
<a name="ln-173"></a>     <span class="c">!! (restart=F). Restart simulation that exited before simulation_time</span>
<a name="ln-174"></a>     <span class="c">!! reached.</span>
<a name="ln-175"></a>     <span class="kt">LOGICAL</span> 			<span class="kd">::</span> <span class="n">proceed</span> 
<a name="ln-176"></a>     <span class="c">!! Flag to indicate if the simulations continues (proceed=T) or not</span>
<a name="ln-177"></a>     <span class="c">!! (proceed=F). Append simulation results after previous simulation_time</span>
<a name="ln-178"></a>     <span class="c">!! reached.</span>
<a name="ln-179"></a>     <span class="kt">LOGICAL</span>  <span class="kd">::</span> <span class="n">reinit</span>
<a name="ln-180"></a>     <span class="c">!! Flag to begin a new simulation, reinitializing from restart file state</span>
<a name="ln-181"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">simulation_time</span> 
<a name="ln-182"></a>     <span class="c">!! Total simulation time in seconds.</span>
<a name="ln-183"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">snapshot_frequency</span> 
<a name="ln-184"></a>     <span class="c">!! Time between snapshots in time of the simulation.</span>
<a name="ln-185"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">restart_overwrite_frequency</span> 
<a name="ln-186"></a>     <span class="c">!! Time between overwrites of restart file in time of the simulation.</span>
<a name="ln-187"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">dt</span> 
<a name="ln-188"></a>     <span class="c">!! Time step in the simulation as a fraction of the relativistic electron</span>
<a name="ln-189"></a>     <span class="c">!! gyro-period \(\tau_e = 2\pi\gamma m_e/eB_0\).</span>
<a name="ln-190"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 			<span class="kd">::</span> <span class="nb">time</span> <span class="o">=</span> <span class="mf">0.0_rp</span> 
<a name="ln-191"></a>     <span class="c">!! Current physical time in the simulation.</span>
<a name="ln-192"></a>     <span class="kt">INTEGER</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">ito</span> <span class="o">=</span> <span class="mi">0_ip</span> 
<a name="ln-193"></a>     <span class="c">!! Initial time iteration in the simulation, this is different from zero</span>
<a name="ln-194"></a>     <span class="c">!! in case is a restarting simulation.</span>
<a name="ln-195"></a>     <span class="kt">INTEGER</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">it</span> <span class="o">=</span> <span class="mi">0_ip</span> 
<a name="ln-196"></a>     <span class="c">!! Current time iteration in the simulation, this is different from zero</span>
<a name="ln-197"></a>     <span class="c">!! in case is a restarting simulation.</span>
<a name="ln-198"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">init_time</span> <span class="o">=</span> <span class="mf">0.0_rp</span>
<a name="ln-199"></a>     <span class="c">!! Time at the beginning of a run with proceed=T     </span>
<a name="ln-200"></a>     <span class="kt">INTEGER</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">t_steps</span>
<a name="ln-201"></a>     <span class="kt">INTEGER</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">prev_iter_2x1t</span> 
<a name="ln-202"></a>     <span class="c">!! Number of time steps needed for evolving the electrons up to</span>
<a name="ln-203"></a>     <span class="c">!! &quot;simulation_time&quot;.</span>
<a name="ln-204"></a>     <span class="kt">INTEGER</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">t_skip</span>
<a name="ln-205"></a>     <span class="kt">INTEGER</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">t_it_SC</span><span class="o">=</span><span class="mi">1_ip</span> 
<a name="ln-206"></a>     <span class="kt">INTEGER</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">output_cadence</span> 
<a name="ln-207"></a>     <span class="c">!! Time iteration offset used to decide when the outputs are generated.</span>
<a name="ln-208"></a>     <span class="kt">INTEGER</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">restart_output_cadence</span> 
<a name="ln-209"></a>     <span class="c">!! Time iteration offset used to decide when the restart files are</span>
<a name="ln-210"></a>     <span class="c">!! generated.</span>
<a name="ln-211"></a>     <span class="kt">INTEGER</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">num_snapshots</span> 
<a name="ln-212"></a>     <span class="c">!! Number of snapshots in time for generating the output files.</span>
<a name="ln-213"></a>     <span class="kt">INTEGER</span> 			<span class="kd">::</span> <span class="n">num_species</span> 
<a name="ln-214"></a>     <span class="c">!! Number of different populations of simulated relativistic electrons</span>
<a name="ln-215"></a>     <span class="c">!! in KORC.</span>
<a name="ln-216"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">minimum_particle_energy</span> 
<a name="ln-217"></a>     <span class="c">!! Minimum allowed energy of simulated electrons. </span>
<a name="ln-218"></a>     <span class="c">!! @todo To improve the criterium to decide when an electron will not</span>
<a name="ln-219"></a>     <span class="c">!! be followed anymore in the simulation.</span>
<a name="ln-220"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">minimum_particle_g</span> 
<a name="ln-221"></a>     <span class="c">!! Minimum allowed relativistic factor \(\gamma\) of simulated electrons.</span>
<a name="ln-222"></a>     <span class="kt">LOGICAL</span> 			<span class="kd">::</span> <span class="n">radiation</span> 
<a name="ln-223"></a>     <span class="c">!! Flag to indicate if synchrotron radiation losses are included</span>
<a name="ln-224"></a>     <span class="c">!! (radiation=T) or not (radiation=F).</span>
<a name="ln-225"></a>     <span class="kt">LOGICAL</span> 			<span class="kd">::</span> <span class="n">collisions</span> 
<a name="ln-226"></a>     <span class="c">!! Flag to indicate if collisionsare included (collisions=T) or not</span>
<a name="ln-227"></a>     <span class="c">!! (collisions=F).</span>
<a name="ln-228"></a>     <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> <span class="kd">::</span> <span class="n">GC_rad_model</span>
<a name="ln-229"></a>     <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> <span class="kd">::</span> <span class="n">collisions_model</span> 
<a name="ln-230"></a>     <span class="c">!! String with the name of the collisions model to be used in the</span>
<a name="ln-231"></a>     <span class="c">!! simulation.</span>
<a name="ln-232"></a>     <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bound_electron_model</span> 
<a name="ln-233"></a>     <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> <span class="kd">::</span> <span class="n">field_model</span>
<a name="ln-234"></a>     <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> <span class="kd">::</span> <span class="n">profile_model</span> 
<a name="ln-235"></a>     <span class="c">!! String with the name of the model for the fields and plasma profiles.</span>
<a name="ln-236"></a>     <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> <span class="kd">::</span> <span class="n">magnetic_field_filename</span> 
<a name="ln-237"></a>     <span class="c">!! String with the name of the model for the fields and plasma profiles.</span>
<a name="ln-238"></a>     <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> <span class="kd">::</span> <span class="n">outputs_list</span> 
<a name="ln-239"></a>     <span class="c">!! List of electron variables to include in the outputs.</span>
<a name="ln-240"></a>     <span class="kt">INTEGER</span> 			<span class="kd">::</span> <span class="n">HDF5_error_handling</span> 
<a name="ln-241"></a>     <span class="c">!! Flag to indicate whether we allow HDF5 to show warnings </span>
<a name="ln-242"></a>     <span class="c">!! during runtime (HDF5_error_handling=1) or not (HDF5_error_handling=0)</span>
<a name="ln-243"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">KORC_MPI</span><span class="p">)</span> 		<span class="kd">::</span> <span class="n">mpi_params</span> 
<a name="ln-244"></a>     <span class="c">!! An instance of the KORC_MPI derived type.</span>
<a name="ln-245"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">CHARCS_PARAMS</span><span class="p">)</span> 		<span class="kd">::</span> <span class="n">cpp</span> 
<a name="ln-246"></a>     <span class="c">!! An instance of the CHARCS_PARAMS derived type.</span>
<a name="ln-247"></a>     <span class="kt">LOGICAL</span> <span class="kd">::</span> <span class="n">FO_GC_compare</span>
<a name="ln-248"></a>     <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> <span class="kd">::</span> <span class="n">orbit_model</span>
<a name="ln-249"></a>     <span class="c">!! String with the name of the orbit model (&#39;FO&#39; or &#39;GC&#39;).</span>
<a name="ln-250"></a>     <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> <span class="kd">::</span> <span class="n">field_eval</span>
<a name="ln-251"></a>     <span class="c">!! String with the name of the field evaluation method for</span>
<a name="ln-252"></a>     <span class="c">!! analytical fields (&#39;interp&#39; or &#39;eqn&#39;)</span>
<a name="ln-253"></a>     <span class="kt">LOGICAL</span> <span class="kd">::</span> <span class="n">GC_coords</span>
<a name="ln-254"></a>     <span class="c">!! Flag to [[get_fields]] to control whether cartesian to cylindrical</span>
<a name="ln-255"></a>     <span class="c">!! coordinate transformation needs to be performed</span>
<a name="ln-256"></a>     <span class="kt">LOGICAL</span> <span class="kd">::</span> <span class="n">FokPlan</span>
<a name="ln-257"></a>     <span class="c">!! Flag to decouple spatial-dependence of evolution</span>
<a name="ln-258"></a>     <span class="kt">LOGICAL</span> <span class="kd">::</span> <span class="n">SameRandSeed</span>
<a name="ln-259"></a>     <span class="kt">LOGICAL</span> <span class="kd">::</span> <span class="n">SC_E</span>
<a name="ln-260"></a>     <span class="kt">LOGICAL</span> <span class="kd">::</span> <span class="n">SC_E_add</span>
<a name="ln-261"></a>     <span class="kt">INTEGER</span>                      <span class="kd">::</span> <span class="n">time_slice</span> <span class="c">!&lt; M3D-C1 time slice to use.</span>
<a name="ln-262"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">rmax</span> <span class="c">!&lt; Maximum r for M3D-C1 fields.</span>
<a name="ln-263"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">rmin</span> <span class="c">!&lt; Minimum r for M3D-C1 fields.</span>
<a name="ln-264"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">zmax</span> <span class="c">!&lt; Maximum z for M3D-C1 fields.</span>
<a name="ln-265"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">zmin</span> <span class="c">!&lt; Minimum z for M3D-C1 fields.</span>
<a name="ln-266"></a>     <span class="kt">INTEGER</span>  <span class="kd">::</span> <span class="n">pchunk</span>
<a name="ln-267"></a>     <span class="c">!! number of particles per vectorized chunk</span>
<a name="ln-268"></a>  <span class="k">END TYPE </span><span class="n">KORC_PARAMS</span>
<a name="ln-269"></a>
<a name="ln-270"></a>
<a name="ln-271"></a>  <span class="k">TYPE</span><span class="p">,</span> <span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">PARTICLES</span>
<a name="ln-272"></a>     <span class="c">!! @note Derived type containing all the electrons&#39; variables</span>
<a name="ln-273"></a>     <span class="c">!!in the simulation. @endnote</span>
<a name="ln-274"></a>
<a name="ln-275"></a>
<a name="ln-276"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">X</span> 
<a name="ln-277"></a>     <span class="c">!! Cartesian coordinates of the electrons&#39; position.</span>
<a name="ln-278"></a>     <span class="c">!! dim(X) = (3,SPECIES::ppp).</span>
<a name="ln-279"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">V</span> 
<a name="ln-280"></a>     <span class="c">!! Cartesian components of the electrons&#39; velocity. dim(V) = dim(X).</span>
<a name="ln-281"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">Rgc</span> 
<a name="ln-282"></a>     <span class="c">!! Cartesian coordinates of the electrons&#39; guiding-center position.</span>
<a name="ln-283"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">Y</span> 
<a name="ln-284"></a>     <span class="c">!! Coordinates of the electrons&#39; position in cylindrical or toroidal</span>
<a name="ln-285"></a>     <span class="c">!! coordinates.</span>
<a name="ln-286"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">Y0</span> 
<a name="ln-287"></a>     <span class="c">!! Placeholder coordinates of the electrons&#39; position in cylindrical</span>
<a name="ln-288"></a>     <span class="c">!! coordinates for GC orbit model.</span>
<a name="ln-289"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">V0</span> 
<a name="ln-290"></a>     <span class="c">!! Placeholder of the electrons&#39; parallel momentum for the GC orbit model</span>
<a name="ln-291"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">E</span> 
<a name="ln-292"></a>     <span class="c">!! Cartesian components of the electric field felt by each electron.</span>
<a name="ln-293"></a>     <span class="c">!! dim(E) = dim(X).</span>
<a name="ln-294"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">B</span> 
<a name="ln-295"></a>     <span class="c">!! Cartesian components of the magnetic field felt by each electron.</span>
<a name="ln-296"></a>     <span class="c">!! dim(B) = dim(X).</span>
<a name="ln-297"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">PSI_P</span> 
<a name="ln-298"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">BR</span> 
<a name="ln-299"></a>     <span class="c">!! Cartesian components of the gradient of the R-component of the</span>
<a name="ln-300"></a>     <span class="c">!! magnetic field felt by each electron. dim(B) = dim(X).</span>
<a name="ln-301"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">BPHI</span> 
<a name="ln-302"></a>     <span class="c">!! Cartesian components of the gradient of the PHI-component of the</span>
<a name="ln-303"></a>     <span class="c">!! magnetic field felt by each electron. dim(B) = dim(X).</span>
<a name="ln-304"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">BZ</span> 
<a name="ln-305"></a>     <span class="c">!! Cartesian components of the gradient of the Z-component of the</span>
<a name="ln-306"></a>     <span class="c">!! magnetic field felt by each electron. dim(B) = dim(X).</span>
<a name="ln-307"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">gradB</span> 
<a name="ln-308"></a>     <span class="c">!! Cylindrical components of the gradient of magnitude of magnetic</span>
<a name="ln-309"></a>     <span class="c">!! field felt by each electron. dim(B) = dim(X).</span>
<a name="ln-310"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">curlb</span> 
<a name="ln-311"></a>     <span class="c">!! Cylindrical components of the curl of the magnetic field unit</span>
<a name="ln-312"></a>     <span class="c">!! vector felt by each electron. dim(B) = dim(X).</span>
<a name="ln-313"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span>      <span class="kd">::</span> <span class="n">RHS</span>
<a name="ln-314"></a>     <span class="c">!! RHS of equations of motion for GC orbit model</span>
<a name="ln-315"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span>      <span class="kd">::</span> <span class="n">k1</span>
<a name="ln-316"></a>     <span class="c">!! Cash-Karp Runge-Kutta coefficient for GC orbit model</span>
<a name="ln-317"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span>      <span class="kd">::</span> <span class="n">k2</span>
<a name="ln-318"></a>     <span class="c">!! Cash-Karp Runge-Kutta coefficient for GC orbit model</span>
<a name="ln-319"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span>      <span class="kd">::</span> <span class="n">k3</span>
<a name="ln-320"></a>     <span class="c">!! Cash-Karp Runge-Kutta coefficient for GC orbit model</span>
<a name="ln-321"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span>      <span class="kd">::</span> <span class="n">k4</span>
<a name="ln-322"></a>     <span class="c">!! Cash-Karp Runge-Kutta coefficient for GC orbit model</span>
<a name="ln-323"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span>      <span class="kd">::</span> <span class="n">k5</span>
<a name="ln-324"></a>     <span class="c">!! Cash-Karp Runge-Kutta coefficient for GC orbit model</span>
<a name="ln-325"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span>      <span class="kd">::</span> <span class="n">k6</span>
<a name="ln-326"></a>     <span class="c">!! Cash-Karp Runge-Kutta coefficient for GC orbit model</span>
<a name="ln-327"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">ne</span> 
<a name="ln-328"></a>     <span class="c">!! Electron density seen by each electron. dim(ne) = (1,SPECIES::ppp).</span>
<a name="ln-329"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">Te</span> 
<a name="ln-330"></a>     <span class="c">!! Electron temperature seen by each electron. dim(Te) = (1,SPECIES::ppp).</span>
<a name="ln-331"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">Zeff</span> 
<a name="ln-332"></a>     <span class="c">!! Zeff seen by each electron. dim(Zeff) = (1,SPECIES::ppp).</span>
<a name="ln-333"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">g</span> 
<a name="ln-334"></a>     <span class="c">!! Instantaneous relativistic \(\gamma = 1/\sqrt{1 - v^2/c^2}\) factor</span>
<a name="ln-335"></a>     <span class="c">!! of each electron in the simulation.</span>
<a name="ln-336"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">eta</span> 
<a name="ln-337"></a>     <span class="c">!! Instantaneous pitch angle of each electron in the simulation.</span>
<a name="ln-338"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">mu</span> 
<a name="ln-339"></a>     <span class="c">!! Magnetic moment of each electron in the simulation.</span>
<a name="ln-340"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">Prad</span> 
<a name="ln-341"></a>     <span class="c">!! Instantaneous radiated power by each electron in the simulation.</span>
<a name="ln-342"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">Pin</span> 
<a name="ln-343"></a>     <span class="c">!! Instantaneous input power of each electron due to the electric</span>
<a name="ln-344"></a>     <span class="c">!! field acceleration.</span>
<a name="ln-345"></a>     <span class="kt">INTEGER</span><span class="p">(</span><span class="k">is</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">flagCon</span>
<a name="ln-346"></a>     <span class="kt">INTEGER</span><span class="p">(</span><span class="k">is</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">flagCol</span> 
<a name="ln-347"></a>     <span class="c">!! Flag for each particle to decide whether it is being followed</span>
<a name="ln-348"></a>     <span class="c">!! (flag=T) or not (flag=F).</span>
<a name="ln-349"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">AUX</span> 
<a name="ln-350"></a>     <span class="c">!! An auxiliary scalar variable for each electron.</span>
<a name="ln-351"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">wt</span> 
<a name="ln-352"></a>     <span class="c">!! Weight of each electron. This is used when sampling weighted</span>
<a name="ln-353"></a>     <span class="c">!! PDFs and in the synthetic camera diagnostic.</span>
<a name="ln-354"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="kt">C_PTR</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> <span class="kd">::</span> <span class="n">hint</span>
<a name="ln-355"></a>     <span class="c">!! Hint for M3D_C1 interpolation.</span>
<a name="ln-356"></a>     <span class="kt">LOGICAL</span>                                <span class="kd">::</span> <span class="n">cart</span>
<a name="ln-357"></a>  <span class="k">END TYPE </span><span class="n">PARTICLES</span>
<a name="ln-358"></a>
<a name="ln-359"></a>
<a name="ln-360"></a>  <span class="k">TYPE</span><span class="p">,</span> <span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">SPECIES</span>
<a name="ln-361"></a>     <span class="c">!! @note Derived type containing the initial parameters of each electron</span>
<a name="ln-362"></a>     <span class="c">!! ensemble followed in a KORC simulation. @endnote</span>
<a name="ln-363"></a>
<a name="ln-364"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">PARTICLES</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">vars</span> 
<a name="ln-365"></a>     <span class="c">!! An instance of the PARTICLES derived type.</span>
<a name="ln-366"></a>     <span class="kt">LOGICAL</span> 				<span class="kd">::</span> <span class="n">runaway</span> 
<a name="ln-367"></a>     <span class="c">!! Flag to decide whether a given electron is a runaway (runaway=T)</span>
<a name="ln-368"></a>     <span class="c">!! or not (runaway=F).</span>
<a name="ln-369"></a>     <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> 	<span class="kd">::</span> <span class="n">spatial_distribution</span> 
<a name="ln-370"></a>     <span class="c">!! String describing the type of initial spatial distribution for</span>
<a name="ln-371"></a>     <span class="c">!! each electron species.</span>
<a name="ln-372"></a>     <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> 	<span class="kd">::</span> <span class="n">energy_distribution</span> 
<a name="ln-373"></a>     <span class="c">!! String describing the type of initial energy distribution for</span>
<a name="ln-374"></a>     <span class="c">!! each electron species.</span>
<a name="ln-375"></a>     <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> 	<span class="kd">::</span> <span class="n">pitch_distribution</span> 
<a name="ln-376"></a>     <span class="c">!! String describing the type of initial pitch-angle distribution for</span>
<a name="ln-377"></a>     <span class="c">!! each electron species.</span>
<a name="ln-378"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">Eo</span> 
<a name="ln-379"></a>     <span class="c">!! Initial energy of each electron species in case of using an initial</span>
<a name="ln-380"></a>     <span class="c">!! mono-energetic distribution.</span>
<a name="ln-381"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">go</span> 
<a name="ln-382"></a>     <span class="c">!! Corresponding relativisitc factor of each electron species in case</span>
<a name="ln-383"></a>     <span class="c">!! of using an initial mono-energetic distribution.</span>
<a name="ln-384"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">etao</span> 
<a name="ln-385"></a>     <span class="c">!! Initial pitch-angle of each electron species in case of using an</span>
<a name="ln-386"></a>     <span class="c">!! initial mono-pitch-angle distribution.</span>
<a name="ln-387"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> 		<span class="kd">::</span> <span class="n">Eo_lims</span> 
<a name="ln-388"></a>     <span class="c">!! Minimum and maximum energy limits of a given initial</span>
<a name="ln-389"></a>     <span class="c">!! non-mono-energetic distribution.</span>
<a name="ln-390"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> 		<span class="kd">::</span> <span class="n">etao_lims</span> 
<a name="ln-391"></a>     <span class="c">!! Minimum and maximum pitch-angle limits of a given initial</span>
<a name="ln-392"></a>     <span class="c">!! non-mono-pitch-angle distribution.</span>
<a name="ln-393"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">wc</span> 
<a name="ln-394"></a>     <span class="c">!! The mean electron cyclotron frequency of each electron species.</span>
<a name="ln-395"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">wc_r</span> 
<a name="ln-396"></a>     <span class="c">!! The mean relativistic electron cyclotron frequency of each electron</span>
<a name="ln-397"></a>     <span class="c">!! species.</span>
<a name="ln-398"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">q</span> 
<a name="ln-399"></a>     <span class="c">!! Charge of each species. @note This was left explicit to allow </span>
<a name="ln-400"></a>     <span class="c">!! KORC to follow electrons and ions in the future. @endnote</span>
<a name="ln-401"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">m</span> 
<a name="ln-402"></a>     <span class="c">!! Mass of each species. @note This was left explicit to allow KORC </span>
<a name="ln-403"></a>     <span class="c">!! to follow electrons and ions in the future. @endnote</span>
<a name="ln-404"></a>     <span class="kt">INTEGER</span> 				<span class="kd">::</span> <span class="n">ppp</span> 
<a name="ln-405"></a>     <span class="c">!! Number of computational particles used to simulate each electron</span>
<a name="ln-406"></a>     <span class="c">!! species.</span>
<a name="ln-407"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">Ro</span> 
<a name="ln-408"></a>     <span class="c">!! Radial position of the center of the electrons&#39; initial spatial</span>
<a name="ln-409"></a>     <span class="c">!! distribution.</span>
<a name="ln-410"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">PHIo</span> 
<a name="ln-411"></a>     <span class="c">!! Azimuthal position of the electrons&#39; initial spatial </span>
<a name="ln-412"></a>     <span class="c">!! distribution, in case of using a disk at a certain poloidal section.</span>
<a name="ln-413"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">Zo</span> 
<a name="ln-414"></a>     <span class="c">!! Height of the center of the electrons&#39; initial spatial distribution.</span>
<a name="ln-415"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">r_inner</span> 
<a name="ln-416"></a>     <span class="c">!! Minimum minor radius of the electrons&#39; initial spatial distribution.</span>
<a name="ln-417"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">r_outter</span> 
<a name="ln-418"></a>     <span class="c">!! Maximum minor radius of the electrons&#39; initial spatial distribution.</span>
<a name="ln-419"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">falloff_rate</span> 
<a name="ln-420"></a>     <span class="c">!! Exponential falloff or standard deviation of a non-uniform radial</span>
<a name="ln-421"></a>     <span class="c">!! distribution of electrons.</span>
<a name="ln-422"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">shear_factor</span> 
<a name="ln-423"></a>     <span class="c">!! Shear factor used to generate an initial spatial distribution with an</span>
<a name="ln-424"></a>     <span class="c">!! elliptic poloidal cross section. </span>
<a name="ln-425"></a>     <span class="c">!! @note See &lt;em&gt;Carbajal and del-Castillo-Negrete, Nuclear Fusion,</span>
<a name="ln-426"></a>     <span class="c">!! submitted (2018)&lt;/em&gt;. @endnote</span>
<a name="ln-427"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">sigmaR</span>
<a name="ln-428"></a>     <span class="c">!! Variance of the first dimension of a 2D Gaussian, spatial</span>
<a name="ln-429"></a>     <span class="c">!! distribution function</span>
<a name="ln-430"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">sigmaZ</span>
<a name="ln-431"></a>     <span class="c">!! Variance of the second dimension of a 2D Gaussian, spatial</span>
<a name="ln-432"></a>     <span class="c">!! distribution function</span>
<a name="ln-433"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">theta_gauss</span>
<a name="ln-434"></a>     <span class="c">!! Angle of counter-clockwise rotation (in degrees) of 2D Gaussian</span>
<a name="ln-435"></a>     <span class="c">!! distribution relative to R,Z</span>
<a name="ln-436"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">psi_max</span>
<a name="ln-437"></a>     <span class="c">!! Maximum value of the argument of the 2D gaussian exponential, used</span>
<a name="ln-438"></a>     <span class="c">!! for an indicator function that limits the region of MH sampling</span>
<a name="ln-439"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">Spong_b</span>
<a name="ln-440"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">Spong_w</span>
<a name="ln-441"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">Spong_dlam</span>
<a name="ln-442"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">dth</span>
<a name="ln-443"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">dgam</span>
<a name="ln-444"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">dR</span>
<a name="ln-445"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">dZ</span>
<a name="ln-446"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span><span class="k">DIMENSION</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Xtrace</span>
<a name="ln-447"></a>     <span class="c">!! Initial position in Cartesian coordinates for tracer particle</span>
<a name="ln-448"></a>  <span class="k">END TYPE </span><span class="n">SPECIES</span>
<a name="ln-449"></a>
<a name="ln-450"></a>
<a name="ln-451"></a>  <span class="k">TYPE</span><span class="p">,</span> <span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">A_FIELD</span>
<a name="ln-452"></a>     <span class="c">!! @note Derived type having all the parameters of the analytical</span>
<a name="ln-453"></a>     <span class="c">!! magnetic field included in KORC. @endnote</span>
<a name="ln-454"></a>     <span class="c">!! The analytical magnetic field is given by:</span>
<a name="ln-455"></a>     <span class="c">!! $$\mathbf{B}(r,\vartheta) = \frac{1}{1 + \eta \cos{\vartheta}}</span>
<a name="ln-456"></a>     <span class="c">!! \left[ B_0 \hat{e}_\zeta  + B_\vartheta(r) \hat{e}_\vartheta \right],$$</span>
<a name="ln-457"></a>     <span class="c">!! where \(\eta = r/R_0\) is the aspect ratio, the constant \(B_0\)</span>
<a name="ln-458"></a>     <span class="c">!! denotes the magnitude of the toroidal magnetic field, </span>
<a name="ln-459"></a>     <span class="c">!! and \(B_\vartheta(r) = \eta B_0/q(r)\) is the poloidal magnetic</span>
<a name="ln-460"></a>     <span class="c">!! field with safety factor </span>
<a name="ln-461"></a>     <span class="c">!! \(q(r) = q_0\left( 1 + \frac{r^2}{\lambda^2} \right)\). The</span>
<a name="ln-462"></a>     <span class="c">!! constant \(q_0\) is the safety factor at </span>
<a name="ln-463"></a>     <span class="c">!! the magnetic axis and the constant \(\lambda\) is obtained from</span>
<a name="ln-464"></a>     <span class="c">!! the values of \(q_0\) and \(q(r)\) </span>
<a name="ln-465"></a>     <span class="c">!! at the plasma edge \(r=r_{edge}\).</span>
<a name="ln-466"></a>
<a name="ln-467"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">Bo</span> 
<a name="ln-468"></a>     <span class="c">!! Magnitude of the toroidal magnetic field \(B_0\).</span>
<a name="ln-469"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">a</span> 
<a name="ln-470"></a>     <span class="c">!! Plasma edge \(r_{edge}\) as measured from the magnetic axis.</span>
<a name="ln-471"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">Ro</span> 
<a name="ln-472"></a>     <span class="c">!! Radial position of the magnetic axis \(R_0\)</span>
<a name="ln-473"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">qa</span> 
<a name="ln-474"></a>     <span class="c">!! Safety factor at the plasma edge.</span>
<a name="ln-475"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">qo</span> 
<a name="ln-476"></a>     <span class="c">!! Safety factor at the magnetic axis \(q_0\).</span>
<a name="ln-477"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">lambda</span> 
<a name="ln-478"></a>     <span class="c">!! \(\lambda\) parameter of \(q(r)\).</span>
<a name="ln-479"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">Bpo</span> 
<a name="ln-480"></a>     <span class="c">!! @deprecated Parameter not used anymore. @todo Delete parameter.</span>
<a name="ln-481"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">Bp_sign</span> 
<a name="ln-482"></a>     <span class="c">!! Sign of \(B_\vartheta(r)\). This depends on current_direction,</span>
<a name="ln-483"></a>     <span class="c">!! Bp_sign=1 for </span>
<a name="ln-484"></a>     <span class="c">!! current_direction=&#39;PARALLEL&#39;, and Bp_sign=-1 for</span>
<a name="ln-485"></a>     <span class="c">!! current_direction=&#39;ANTI-PARALLEL&#39;.</span>
<a name="ln-486"></a>     <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> <span class="kd">::</span> <span class="n">current_direction</span> 
<a name="ln-487"></a>     <span class="c">!! Direction of plasma current: PARALLEL or ANTI-PARALLEL to the</span>
<a name="ln-488"></a>     <span class="c">!! toroidal magnetic field.</span>
<a name="ln-489"></a>  <span class="k">END TYPE </span><span class="n">A_FIELD</span>
<a name="ln-490"></a>
<a name="ln-491"></a>  <span class="k">TYPE</span><span class="p">,</span> <span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">MESH</span>
<a name="ln-492"></a>     <span class="c">!! Derived type with the cylindrical coordinates of the grid nodes </span>
<a name="ln-493"></a>     <span class="c">!! at which the pre-computed plasma profiles and fields are known.</span>
<a name="ln-494"></a>
<a name="ln-495"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> <span class="kd">::</span> <span class="n">R</span> 
<a name="ln-496"></a>     <span class="c">!! Radial grid.</span>
<a name="ln-497"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> <span class="kd">::</span> <span class="n">PHI</span> 
<a name="ln-498"></a>     <span class="c">!! Azimuthal grid.</span>
<a name="ln-499"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> <span class="kd">::</span> <span class="n">Z</span> 
<a name="ln-500"></a>     <span class="c">!! Z grid.</span>
<a name="ln-501"></a>  <span class="k">END TYPE </span><span class="n">MESH</span>
<a name="ln-502"></a>
<a name="ln-503"></a>
<a name="ln-504"></a>  <span class="k">TYPE</span><span class="p">,</span> <span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">FIELDS</span>
<a name="ln-505"></a>     <span class="c">!! @note Derived type with all the variables and data of analytical </span>
<a name="ln-506"></a>     <span class="c">!! and pre-computed electric and magnetic fields. @endnote</span>
<a name="ln-507"></a>
<a name="ln-508"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">A_FIELD</span><span class="p">)</span> 	 			<span class="kd">::</span> <span class="n">AB</span> 
<a name="ln-509"></a>     <span class="c">!! An instance of the KORC derived data type A_FIELD.</span>
<a name="ln-510"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_3D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">E_3D</span> 
<a name="ln-511"></a>     <span class="c">!! KORC 3-D vector field of the pre-computed electric field.</span>
<a name="ln-512"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_3D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">B_3D</span>
<a name="ln-513"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_3D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">dBdR_3D</span>
<a name="ln-514"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_3D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">dBdPHI_3D</span>
<a name="ln-515"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_3D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">dBdZ_3D</span> 
<a name="ln-516"></a>     <span class="c">!! KORC 3-D vector field of the pre-computed magnetic field.</span>
<a name="ln-517"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_2D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">E_2D</span> 
<a name="ln-518"></a>     <span class="c">!! KORC 2-D vector field of the pre-computed electric field.</span>
<a name="ln-519"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_2D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">B_2D</span>
<a name="ln-520"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_2D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">dBdR_2D</span>
<a name="ln-521"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_2D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">dBdPHI_2D</span>
<a name="ln-522"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_2D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">dBdZ_2D</span> 
<a name="ln-523"></a>     <span class="c">!! KORC 3-D vector field of the pre-computed magnetic field.</span>
<a name="ln-524"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_2D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">gradB_2D</span>
<a name="ln-525"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_3D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">gradB_3D</span> 
<a name="ln-526"></a>     <span class="c">!! KORC 3-D vector field of the gradient of the magnitude of the</span>
<a name="ln-527"></a>     <span class="c">!! pre-computed magnetic field.</span>
<a name="ln-528"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_2D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">curlb_2D</span>
<a name="ln-529"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_3D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">curlb_3D</span> 
<a name="ln-530"></a>     <span class="c">!! KORC 3-D vector field of the curl of the unit vector in the</span>
<a name="ln-531"></a>     <span class="c">!! direction of the pre-computed magnetic field.</span>
<a name="ln-532"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_1D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">E_SC_1D</span>
<a name="ln-533"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_1D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">J0_SC_1D</span>
<a name="ln-534"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_1D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">J1_SC_1D</span>
<a name="ln-535"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_1D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">J2_SC_1D</span>
<a name="ln-536"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_1D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">J3_SC_1D</span>
<a name="ln-537"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_1D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">A1_SC_1D</span>
<a name="ln-538"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_1D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">A2_SC_1D</span>
<a name="ln-539"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">V_FIELD_1D</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">A3_SC_1D</span>
<a name="ln-540"></a>     
<a name="ln-541"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> <span class="kd">::</span> <span class="n">r_1D</span>
<a name="ln-542"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> <span class="kd">::</span> <span class="n">PSIP_1D</span>
<a name="ln-543"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> <span class="kd">::</span> <span class="n">dMagPsiSqdPsiP</span>
<a name="ln-544"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> <span class="kd">::</span> <span class="n">ddMagPsiSqdPsiPSq</span>
<a name="ln-545"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">MESH</span><span class="p">)</span> 		 		<span class="kd">::</span> <span class="n">X</span> 
<a name="ln-546"></a>     <span class="c">!! An instance of the KORC derived type MESH.</span>
<a name="ln-547"></a>     <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> <span class="kd">::</span> <span class="n">E_model</span>
<a name="ln-548"></a>     <span class="c">!! Name for dynamical, analytic, electric field model to be added to</span>
<a name="ln-549"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">E_dyn</span>
<a name="ln-550"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">E_pulse</span>
<a name="ln-551"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">E_width</span>
<a name="ln-552"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">PSIP_min</span>
<a name="ln-553"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">PSIp_lim</span><span class="p">,</span><span class="n">PSIp_0</span>
<a name="ln-554"></a>     <span class="c">!! interpolated E field</span>
<a name="ln-555"></a>     <span class="kt">INTEGER</span> 			<span class="kd">::</span> <span class="n">res_double</span>
<a name="ln-556"></a>     <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">dims</span> 
<a name="ln-557"></a>     <span class="c">!! Dimensions of the KORC vector field. dims=(number of grid </span>
<a name="ln-558"></a>     <span class="c">!! nodes along \(R\), number of grid nodes along \(\phi\), </span>
<a name="ln-559"></a>     <span class="c">!! number of grid nodes along \(Z\)).</span>
<a name="ln-560"></a>     <span class="kt">INTEGER</span> 			<span class="kd">::</span> <span class="n">dim_1D</span>
<a name="ln-561"></a>     <span class="kt">INTEGER</span> 			<span class="kd">::</span> <span class="n">subcycle_E_SC</span>
<a name="ln-562"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">dt_E_SC</span><span class="p">,</span><span class="n">Ip_exp</span><span class="p">,</span><span class="n">Ip0</span>
<a name="ln-563"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">PSIp</span>
<a name="ln-564"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">PSIp_FS</span>
<a name="ln-565"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:,:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">PSIp3D</span> 
<a name="ln-566"></a>     <span class="c">!! 2-D array for storing the data of the poloidal magnetic flux.</span>
<a name="ln-567"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">FLAG2D</span> 
<a name="ln-568"></a>     <span class="c">!! 2-D array defining the simulation domain where pre-computed data exist.</span>
<a name="ln-569"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:,:),</span> <span class="k">ALLOCATABLE</span>      <span class="kd">::</span> <span class="n">FLAG3D</span> 
<a name="ln-570"></a>     <span class="c">!! 3-D array defining the simulation domain where pre-computed data exist.</span>
<a name="ln-571"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 					<span class="kd">::</span> <span class="n">Eo</span> 
<a name="ln-572"></a>     <span class="c">!! Characteristic electric field.</span>
<a name="ln-573"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 					<span class="kd">::</span> <span class="n">Bo</span> 
<a name="ln-574"></a>     <span class="c">!! Characteristic magnetic field.</span>
<a name="ln-575"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 					<span class="kd">::</span> <span class="n">Ro</span> 
<a name="ln-576"></a>     <span class="c">!! Radial position of the magnetic axis.</span>
<a name="ln-577"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 					<span class="kd">::</span> <span class="n">Zo</span> 
<a name="ln-578"></a>     <span class="c">!! \(Z\) position of the magnetic axis.</span>
<a name="ln-579"></a>     <span class="kt">LOGICAL</span> 					<span class="kd">::</span> <span class="n">Bfield</span> 
<a name="ln-580"></a>     <span class="c">!! Flag to indicate whether a pre-computed magnetic field will be</span>
<a name="ln-581"></a>     <span class="c">!! used (Bfield=T) or not (Bfield=F).</span>
<a name="ln-582"></a>     <span class="kt">LOGICAL</span> 					<span class="kd">::</span> <span class="n">dBfield</span> 
<a name="ln-583"></a>     <span class="c">!! Flag to indicate whether a pre-computed magnetic field will be</span>
<a name="ln-584"></a>     <span class="c">!! used (Bfield=T) or not (Bfield=F).</span>
<a name="ln-585"></a>     <span class="kt">LOGICAL</span> 					<span class="kd">::</span> <span class="n">Bflux</span>
<a name="ln-586"></a>     <span class="kt">LOGICAL</span> 					<span class="kd">::</span> <span class="n">Bflux3D</span> 
<a name="ln-587"></a>     <span class="c">!! Flag to indicate whether a pre-computed poloidal magnetic flux will</span>
<a name="ln-588"></a>     <span class="c">!! be used (Bflux=T) or not (Bflux=F).</span>
<a name="ln-589"></a>     <span class="kt">LOGICAL</span> 					<span class="kd">::</span> <span class="n">Efield</span> 
<a name="ln-590"></a>     <span class="c">!! Flag to indicate whether a pre-computed electric field will be used</span>
<a name="ln-591"></a>     <span class="c">!! (Efield=T) or not (Efield=F).</span>
<a name="ln-592"></a>     <span class="kt">LOGICAL</span> 					<span class="kd">::</span> <span class="n">Bfield_in_file</span> 
<a name="ln-593"></a>     <span class="c">!! Flag to indicate if a pre-computed magnetic field is in the input file.</span>
<a name="ln-594"></a>     <span class="kt">LOGICAL</span> 					<span class="kd">::</span> <span class="n">dBfield_in_file</span> 
<a name="ln-595"></a>     <span class="c">!! Flag to indicate if a pre-computed magnetic field is in the input file.</span>
<a name="ln-596"></a>     <span class="kt">LOGICAL</span> 					<span class="kd">::</span> <span class="n">Bflux_in_file</span> 
<a name="ln-597"></a>     <span class="c">!! Flag to indicate if a pre-computed poloidal magnetic flux is in the</span>
<a name="ln-598"></a>     <span class="c">!! input file.</span>
<a name="ln-599"></a>     <span class="kt">LOGICAL</span> 					<span class="kd">::</span> <span class="n">Efield_in_file</span> 
<a name="ln-600"></a>     <span class="c">!! Flag to indicate if a pre-computed electric field is in the input file.</span>
<a name="ln-601"></a>     <span class="kt">LOGICAL</span> 					<span class="kd">::</span> <span class="n">axisymmetric_fields</span> 
<a name="ln-602"></a>     <span class="c">!! Flag to indicate if the pre-computed fields are axisymmetric.</span>
<a name="ln-603"></a>     <span class="kt">LOGICAL</span> 					<span class="kd">::</span> <span class="n">Dim2x1t</span>
<a name="ln-604"></a>     <span class="kt">LOGICAL</span> 					<span class="kd">::</span> <span class="n">E_2x1t</span><span class="p">,</span><span class="n">ReInterp_2x1t</span>
<a name="ln-605"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">t0_2x1t</span>
<a name="ln-606"></a>     <span class="kt">INTEGER</span>  <span class="kd">::</span> <span class="n">ind0_2x1t</span><span class="p">,</span><span class="n">ind_2x1t</span>
<a name="ln-607"></a><span class="cp">#ifdef M3D_C1</span>
<a name="ln-608"></a>     <span class="kt">INTEGER</span> <span class="p">(</span><span class="kt">C_INT</span><span class="p">)</span>                         <span class="kd">::</span> <span class="n">M3D_C1_B</span>
<a name="ln-609"></a>     <span class="c">!! An M3D-C1 magnetic field.</span>
<a name="ln-610"></a>     <span class="kt">INTEGER</span> <span class="p">(</span><span class="kt">C_INT</span><span class="p">)</span>                         <span class="kd">::</span> <span class="n">M3D_C1_E</span>
<a name="ln-611"></a>     <span class="c">!! An M3D-C1 Electric field.</span>
<a name="ln-612"></a>     <span class="kt">INTEGER</span> <span class="p">(</span><span class="kt">C_INT</span><span class="p">)</span>                         <span class="kd">::</span> <span class="n">M3D_C1_A</span>
<a name="ln-613"></a>     <span class="c">!! An M3D-C1 vector potential.</span>
<a name="ln-614"></a><span class="cp">#endif</span>
<a name="ln-615"></a>  <span class="k">END TYPE </span><span class="n">FIELDS</span>
<a name="ln-616"></a>
<a name="ln-617"></a>
<a name="ln-618"></a>  <span class="k">TYPE</span><span class="p">,</span> <span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">PROFILES</span>
<a name="ln-619"></a>     <span class="c">!! @note KORC derived data type having information about the plasma</span>
<a name="ln-620"></a>     <span class="c">!! profiles. </span>
<a name="ln-621"></a>     <span class="c">!! See [[korc_profiles.f90(&quot;file&quot;)]] for more information. @endnote</span>
<a name="ln-622"></a>     <span class="c">!! KORC can run using either analytical and pre-computed plasma profiles. </span>
<a name="ln-623"></a>     <span class="c">!! Pre-computed plasma profiles, </span>
<a name="ln-624"></a>     <span class="c">!! as in the case of pre-computed electric or magnetic fields, are</span>
<a name="ln-625"></a>     <span class="c">!! interpolated </span>
<a name="ln-626"></a>     <span class="c">!! to electrons&#39; position in [[korc_profiles]].</span>
<a name="ln-627"></a>     <span class="c">!!</span>
<a name="ln-628"></a>     <span class="c">!! There are two types of analytical plsama profiles that can be used</span>
<a name="ln-629"></a>     <span class="c">!! in KORC: </span>
<a name="ln-630"></a>     <span class="c">!! 3rd degree polynomial radial plasma profiles,</span>
<a name="ln-631"></a>     <span class="c">!! $$f(r) = a_3r^3 + a_2r^2 +a_1r + a_0,$$</span>
<a name="ln-632"></a>     <span class="c">!! and radial plasma profiles with a \(\tanh(r)\) dependency:</span>
<a name="ln-633"></a>     <span class="c">!! $$f(r) = f_0\left[1 - \tanh^n\left(\frac{2r}{a}\right)\right],$$</span>
<a name="ln-634"></a>     <span class="c">!! where \(f_0\) is a given plasma parameter at the magnetic axis,</span>
<a name="ln-635"></a>     <span class="c">!! and \(a\) is </span>
<a name="ln-636"></a>     <span class="c">!! the plasma radius as measured </span>
<a name="ln-637"></a>     <span class="c">!! from the magnetic axis to the last closed flux surface. Notice that the </span>
<a name="ln-638"></a>     <span class="c">!! larger \(n\) is, the more uniform the radial profiles are.</span>
<a name="ln-639"></a>
<a name="ln-640"></a>     <span class="k">TYPE</span><span class="p">(</span><span class="n">MESH</span><span class="p">)</span> 				        <span class="kd">::</span> <span class="n">X</span> 
<a name="ln-641"></a>     <span class="c">!! An instance of the KORC derived data type MESH.</span>
<a name="ln-642"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 				        <span class="kd">::</span> <span class="n">a</span> 
<a name="ln-643"></a>     <span class="c">!! Plasma radius as measured from the magnetic axis</span>
<a name="ln-644"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 				        <span class="kd">::</span> <span class="n">R0</span>
<a name="ln-645"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 				        <span class="kd">::</span> <span class="n">Z0</span>
<a name="ln-646"></a>
<a name="ln-647"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 				        <span class="kd">::</span> <span class="n">R0_RE</span>
<a name="ln-648"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 				        <span class="kd">::</span> <span class="n">Z0_RE</span>
<a name="ln-649"></a>     
<a name="ln-650"></a>     <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">dims</span> 
<a name="ln-651"></a>     <span class="c">!! Dimensions of the arrays containing the pre-computed profiles data. dims=(number of grid nodes along \(R\), </span>
<a name="ln-652"></a>     <span class="c">!! number of grid nodes along \(\phi\), number of grid nodes along \(Z\)).</span>
<a name="ln-653"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">FLAG2D</span> 
<a name="ln-654"></a>     <span class="c">!! 2-D array defining the simulation domain where pre-computed data exist.</span>
<a name="ln-655"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:,:),</span> <span class="k">ALLOCATABLE</span>      <span class="kd">::</span> <span class="n">FLAG3D</span> 
<a name="ln-656"></a>     <span class="c">!! 3-D array defining the simulation domain where pre-computed data exist.</span>
<a name="ln-657"></a>
<a name="ln-658"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 					<span class="kd">::</span> <span class="n">n_ne</span> 
<a name="ln-659"></a>     <span class="c">!! \(n\) used in \(\tanh^n(r)\) of the electron density profile.</span>
<a name="ln-660"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 					<span class="kd">::</span> <span class="n">n_Te</span> 
<a name="ln-661"></a>     <span class="c">!! \(n\) used in \(\tanh^n(r)\) of the electron temperature profile.</span>
<a name="ln-662"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 					<span class="kd">::</span> <span class="n">n_Zeff</span> 
<a name="ln-663"></a>     <span class="c">!! \(n\) used in \(\tanh^n(r)\) of the \(Z_{eff}\) profile.</span>
<a name="ln-664"></a>
<a name="ln-665"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">n_REr0</span><span class="o">=</span><span class="mf">0._rp</span>
<a name="ln-666"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">n_tauion</span><span class="o">=</span><span class="mf">0._rp</span>
<a name="ln-667"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">n_tauin</span><span class="o">=</span><span class="mf">0._rp</span>
<a name="ln-668"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">n_tauout</span><span class="o">=</span><span class="mf">0._rp</span>
<a name="ln-669"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">n_shelfdelay</span><span class="o">=</span><span class="mf">0._rp</span>
<a name="ln-670"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">n_lamfront</span><span class="o">=</span><span class="mf">0._rp</span>
<a name="ln-671"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">n_lamback</span><span class="o">=</span><span class="mf">0._rp</span>
<a name="ln-672"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">n_lamshelf</span><span class="o">=</span><span class="mf">0._rp</span>
<a name="ln-673"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">n_shelf</span><span class="o">=</span><span class="mf">0._rp</span>
<a name="ln-674"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">psiN_0</span><span class="o">=</span><span class="mf">1._rp</span>
<a name="ln-675"></a>
<a name="ln-676"></a>     
<a name="ln-677"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">a_ne</span> 
<a name="ln-678"></a>     <span class="c">!! Coefficients of the polynomial electron density profile. </span>
<a name="ln-679"></a>     <span class="c">!! See detailed description above, a_ne=(\(a_{0}\),\(a_{2}\),\(a_{3}\),\(a_{4}\)).</span>
<a name="ln-680"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">a_Te</span> 
<a name="ln-681"></a>     <span class="c">!! Coefficients of the polynomial electron temperature profile. </span>
<a name="ln-682"></a>     <span class="c">!! See detailed description above, a_ne=(\(a_{0}\),\(a_{2}\),\(a_{3}\),\(a_{4}\)).</span>
<a name="ln-683"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> 			<span class="kd">::</span> <span class="n">a_Zeff</span> 
<a name="ln-684"></a>     <span class="c">!! Coefficients of the \(Z_{eff}\) profile. </span>
<a name="ln-685"></a>     <span class="c">!! See detailed description above, a_ne=(\(a_{0}\),\(a_{2}\),\(a_{3}\),\(a_{4}\)).</span>
<a name="ln-686"></a>
<a name="ln-687"></a>     <span class="c">! Zeff</span>
<a name="ln-688"></a>     <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> 		<span class="kd">::</span> <span class="n">Zeff_profile</span> 
<a name="ln-689"></a>     <span class="c">!! String containing the type of \(Z_{eff}\) profile to be used in the simulation.</span>
<a name="ln-690"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 					<span class="kd">::</span> <span class="n">Zeffo</span> 
<a name="ln-691"></a>     <span class="c">!! \(Z_{eff}\) at the magnetic axis.</span>
<a name="ln-692"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:,:),</span> <span class="k">ALLOCATABLE</span>      <span class="kd">::</span> <span class="n">Zeff_3D</span> 
<a name="ln-693"></a>     <span class="c">!! 3-D array for keeping the pre-computed data of the \(Z_{eff}\) profile.</span>
<a name="ln-694"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">Zeff_2D</span> 
<a name="ln-695"></a>     <span class="c">!! 2-D array for keeping the pre-computed data of the \(Z_{eff}\) profile.</span>
<a name="ln-696"></a>
<a name="ln-697"></a>     <span class="c">! Density</span>
<a name="ln-698"></a>     <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> 		<span class="kd">::</span> <span class="n">ne_profile</span> 
<a name="ln-699"></a>     <span class="c">!! String containing the type of electron density profile to be used in the simulation.</span>
<a name="ln-700"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 					<span class="kd">::</span> <span class="n">neo</span> 
<a name="ln-701"></a>     <span class="c">!! Electron density at the magnetic axis</span>
<a name="ln-702"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:,:),</span> <span class="k">ALLOCATABLE</span>      <span class="kd">::</span> <span class="n">ne_3D</span> 
<a name="ln-703"></a>     <span class="c">!! 3-D array for keeping the pre-computed data of the electron density profile.</span>
<a name="ln-704"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">ne_2D</span> 
<a name="ln-705"></a>     <span class="c">!! 2-D array for keeping the pre-computed data of the electron density profile.</span>
<a name="ln-706"></a>
<a name="ln-707"></a>     <span class="c">!Temperature</span>
<a name="ln-708"></a>     <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> 		<span class="kd">::</span> <span class="n">Te_profile</span> 
<a name="ln-709"></a>     <span class="c">!! String containing the type of electron temperature profile to be used in the simulation.</span>
<a name="ln-710"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 					<span class="kd">::</span> <span class="n">Teo</span> 
<a name="ln-711"></a>     <span class="c">!! Electron temperature at the magnetic axis</span>
<a name="ln-712"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:,:),</span> <span class="k">ALLOCATABLE</span>      <span class="kd">::</span> <span class="n">Te_3D</span> 
<a name="ln-713"></a>     <span class="c">!! 3-D array for keeping the pre-computed data of the electron density profile.</span>
<a name="ln-714"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span> 	<span class="kd">::</span> <span class="n">Te_2D</span> 
<a name="ln-715"></a>     <span class="c">!! 2-D array for keeping the pre-computed data of the electron density profile.</span>
<a name="ln-716"></a>
<a name="ln-717"></a>     <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> 		<span class="kd">::</span> <span class="n">filename</span> 
<a name="ln-718"></a>     <span class="c">!! Full path to the HDF5 file containing the pre-computed plasma profiles.</span>
<a name="ln-719"></a>     <span class="kt">LOGICAL</span> 					<span class="kd">::</span> <span class="n">axisymmetric</span> 
<a name="ln-720"></a>     <span class="c">!! Flag to indicate if the plasma profiles are axisymmetric.</span>
<a name="ln-721"></a><span class="cp">#ifdef M3D_C1</span>
<a name="ln-722"></a>     <span class="kt">INTEGER</span> <span class="p">(</span><span class="kt">C_INT</span><span class="p">)</span>                         <span class="kd">::</span> <span class="n">M3D_C1_ne</span>
<a name="ln-723"></a>     <span class="kt">INTEGER</span> <span class="p">(</span><span class="kt">C_INT</span><span class="p">)</span>                         <span class="kd">::</span> <span class="n">M3D_C1_te</span>
<a name="ln-724"></a>     <span class="kt">INTEGER</span> <span class="p">(</span><span class="kt">C_INT</span><span class="p">)</span>                         <span class="kd">::</span> <span class="n">M3D_C1_zeff</span>
<a name="ln-725"></a><span class="cp">#endif</span>
<a name="ln-726"></a>  <span class="k">END TYPE </span><span class="n">PROFILES</span>
<a name="ln-727"></a>
<a name="ln-728"></a><span class="k">end module </span><span class="n">korc_types</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2020 
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on  
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> KORC-Full Orbit was developed by Matt Beidler</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>