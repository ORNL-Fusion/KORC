<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="Kinetic Orbit Runaway electrons Code (KORC) - Full Orbit">
    
    <meta name="author" content="Matt Beidler" >
    <link rel="icon" href="../favicon.png">

    <title>save_simulation_parameters &ndash; KORC-Full Orbit</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">KORC-Full Orbit </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>README</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/main.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/main.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>save_simulation_parameters
      <small>Subroutine</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 3.0% of total for procedures.">617 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/korc_HDF5.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
     <li><a href='../sourcefile/korc_hdf5.f90.html'>korc_HDF5.f90</a></li>
    
     <li><a href='../module/korc_hdf5.html'>korc_HDF5</a></li>
    
  
     <li class="active">save_simulation_parameters</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/save_simulation_parameters.html#src">save_simulation_parameters</a>
  </div>
</div>



</div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>
public subroutine save_simulation_parameters(params, spp, F, P)
    
    
   
</h2>
    
  


    
    <p></p><div class="alert alert-info" role="alert"><h4>Note</h4><p>Subroutine to save to a HDF5 file all the relevant simulation
 parameters. </p></div>
<p>This subroutine saves to the HDF5 file "<a>simulation_parameters.h5</a>"
 all the relevant simulation parameters of KORC, most of them being part
 of the input file, but also including some derived quantities from the
 input parameters. This file is intended to facilitate the
 post-processing of KORC data using any software that supports
 the HDF5 software.</p>
    

    <h3>Arguments</h3>
    
      
<table class="table table-striped varlist">
<thead><tr><th>Type</th>
<th>Intent</th><th>Optional</th>
<th>Attributes</th><th></th><th>Name</th><th></th></thead>



<tbody>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-params"></span>type(KORC_PARAMS),</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>params</strong></td><td><p>Core KORC simulation parameters.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-spp"></span>type(SPECIES),</td>
  <td>intent(in),</td>
  <td></td>
  
  <td>DIMENSION(:), ALLOCATABLE</td><td>::</td>
  <td><strong>spp</strong></td><td><p>An instance of KORC's derived type SPECIES containing all
 the information of different electron species. See <a href="../module/korc_types.html">korc_types</a>.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-f"></span>type(FIELDS),</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>F</strong></td><td><p>An instance of KORC's derived type FIELDS containing all the information
 about the fields used in the simulation. See <a href="../module/korc_types.html">korc_types</a>
 and <a href="../module/korc_fields.html">korc_fields</a>.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-p~2"></span>type(PROFILES),</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>P</strong></td><td><p>An instance of KORC's derived type PROFILES containing all the
 information about the plasma profiles used in the simulation.
 See <a href="../module/korc_types.html">korc_types</a> and <a href="../module/korc_profiles.html">korc_profiles</a>.</p></td>
  
</tr>

</tbody>
</table>

    
    
    
    
     
    <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/save_simulation_parameters.html#src">save_simulation_parameters</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    

    
    
    
    
    

    
    
    
    
    


    
    
    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span>  <span class="k">subroutine </span><span class="n">save_simulation_parameters</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">spp</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">P</span><span class="p">)</span>
    <span class="c">!! @note Subroutine to save to a HDF5 file all the relevant simulation</span>
    <span class="c">!! parameters. @endnote</span>
    <span class="c">!! This subroutine saves to the HDF5 file &quot;&lt;a&gt;simulation_parameters.h5&lt;/a&gt;&quot;</span>
    <span class="c">!! all the relevant simulation parameters of KORC, most of them being part</span>
    <span class="c">!! of the input file, but also including some derived quantities from the</span>
    <span class="c">!! input parameters. This file is intended to facilitate the</span>
    <span class="c">!! post-processing of KORC data using any software that supports</span>
    <span class="c">!! the HDF5 software.</span>
    <span class="k">TYPE</span><span class="p">(</span><span class="n">KORC_PARAMS</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">params</span>
    <span class="c">!!Core KORC simulation parameters.</span>
    <span class="k">TYPE</span><span class="p">(</span><span class="n">SPECIES</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> 	<span class="kd">::</span> <span class="n">spp</span>
    <span class="c">!! An instance of KORC&#39;s derived type SPECIES containing all</span>
    <span class="c">!! the information of different electron species. See [[korc_types]].</span>
    <span class="k">TYPE</span><span class="p">(</span><span class="n">FIELDS</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> 					<span class="kd">::</span> <span class="n">F</span>
    <span class="c">!! An instance of KORC&#39;s derived type FIELDS containing all the information</span>
    <span class="c">!! about the fields used in the simulation. See [[korc_types]]</span>
    <span class="c">!! and [[korc_fields]].</span>
    <span class="k">TYPE</span><span class="p">(</span><span class="n">PROFILES</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> 					<span class="kd">::</span> <span class="n">P</span>
    <span class="c">!! An instance of KORC&#39;s derived type PROFILES containing all the</span>
    <span class="c">!! information about the plasma profiles used in the simulation.</span>
    <span class="c">!! See [[korc_types]] and [[korc_profiles]].</span>
    <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">filename</span>
    <span class="c">!! String containing the name of the HDF5 file.</span>
    <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">gname</span>
    <span class="c">!! String containing the group name of a set of KORC parameters.</span>
    <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">dset</span>
    <span class="c">!! Name of data set to be saved to file.</span>
    <span class="kt">INTEGER</span><span class="p">(</span><span class="n">HID_T</span><span class="p">)</span> 						<span class="kd">::</span> <span class="n">h5file_id</span>
    <span class="c">!!  HDF5 file identifier.</span>
    <span class="kt">INTEGER</span><span class="p">(</span><span class="n">HID_T</span><span class="p">)</span> 						<span class="kd">::</span> <span class="n">group_id</span>
    <span class="c">!! HDF5 group identifier.</span>
    <span class="kt">INTEGER</span><span class="p">(</span><span class="n">HSIZE_T</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> 		<span class="kd">::</span> <span class="n">dims</span>
    <span class="c">!! Dimensions of data saved to HDF5 file.</span>
    <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> 			<span class="kd">::</span> <span class="n">rdata</span>
    <span class="c">!! 1-D array of real data to be saved to HDF5 file.</span>
    <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> 				<span class="kd">::</span> <span class="n">idata</span>
    <span class="c">!! 1-D array of integer data to be saved to HDF5 file.</span>
    <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> <span class="kd">::</span> <span class="n">attr_array</span>
    <span class="c">!! An 1-D array with attributes of 1-D real or integer arrays that are</span>
    <span class="c">!! passed to KORC interfaces of HDF5 I/O subroutines.</span>
    <span class="kt">CHARACTER</span><span class="p">(</span><span class="n">MAX_STRING_LENGTH</span><span class="p">)</span> 				<span class="kd">::</span> <span class="n">attr</span>
    <span class="c">!!  A single attributes of real or integer data that is passed to KORC</span>
    <span class="c">!! interfaces of HDF5 I/O subroutines.</span>
    <span class="kt">INTEGER</span> 							<span class="kd">::</span> <span class="n">h5error</span>
    <span class="c">!! HDF5 error status.</span>
    <span class="kt">CHARACTER</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span> 						<span class="kd">::</span> <span class="n">tmp_str</span>
    <span class="c">!! Temporary string used to manipulate various strings.</span>
    <span class="kt">REAL</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> 							<span class="kd">::</span> <span class="n">units</span>
    <span class="c">!! Temporary variable used to add physical units to KORC parameters.</span>

    <span class="c">! * * * Error handling * * * !</span>
    <span class="k">call </span><span class="n">h5eset_auto_f</span><span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">HDF5_error_handling</span><span class="p">,</span> <span class="n">h5error</span><span class="p">)</span>
    <span class="c">! Turn off: 0_idef. Turn on: 1_idef</span>

    <span class="k">if</span> <span class="p">(.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">params</span><span class="p">%</span><span class="n">restart</span><span class="p">))</span> <span class="k">then</span>

<span class="k">    if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">mpi_params</span><span class="p">%</span><span class="n">rank</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<span class="k">       write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;Saving simulations parameters&quot;)&#39;</span><span class="p">)</span>
    <span class="k">end if</span>

<span class="k">       </span>
<span class="k">       if</span> <span class="p">(</span><span class="n">SIZE</span><span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">outputs_list</span><span class="p">).</span><span class="n">GT</span><span class="p">.</span><span class="mi">1_idef</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          write</span><span class="p">(</span><span class="n">tmp_str</span><span class="p">,</span><span class="s1">&#39;(I18)&#39;</span><span class="p">)</span> <span class="n">params</span><span class="p">%</span><span class="n">mpi_params</span><span class="p">%</span><span class="n">rank</span>
          <span class="n">filename</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">path_to_outputs</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;file_&quot;</span>  <span class="p">&amp;</span>
               <span class="o">//</span> <span class="nb">TRIM</span><span class="p">(</span><span class="nb">ADJUSTL</span><span class="p">(</span><span class="n">tmp_str</span><span class="p">))</span> <span class="o">//</span> <span class="s2">&quot;.h5&quot;</span>
          <span class="k">call </span><span class="n">h5fcreate_f</span><span class="p">(</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">H5F_ACC_TRUNC_F</span><span class="p">,</span> <span class="n">h5file_id</span><span class="p">,</span> <span class="n">h5error</span><span class="p">)</span>
          <span class="k">call </span><span class="n">h5fclose_f</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">h5error</span><span class="p">)</span>
       <span class="k">end if</span>

<span class="k">       if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">mpi_params</span><span class="p">%</span><span class="n">rank</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          </span><span class="n">filename</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">path_to_outputs</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;simulation_parameters.h5&quot;</span>

          <span class="k">call </span><span class="n">h5fcreate_f</span><span class="p">(</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">H5F_ACC_TRUNC_F</span><span class="p">,</span> <span class="n">h5file_id</span><span class="p">,</span> <span class="n">h5error</span><span class="p">)</span>

          <span class="c">! Simulation parameters group</span>
          <span class="n">gname</span> <span class="o">=</span> <span class="s2">&quot;simulation&quot;</span>
          <span class="k">call </span><span class="n">h5gcreate_f</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">),</span> <span class="n">group_id</span><span class="p">,</span> <span class="n">h5error</span><span class="p">)</span>

          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">idata</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/field_model&quot;</span>
          <span class="k">call </span><span class="n">save_string_parameter</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,(</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">field_model</span><span class="o">/</span><span class="p">))</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/profile_model&quot;</span>
          <span class="k">call </span><span class="n">save_string_parameter</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,(</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">profile_model</span><span class="o">/</span><span class="p">))</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/simulation_time&quot;</span>
          <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Total aimed simulation time in seconds&quot;</span>
          <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">params</span><span class="p">%</span><span class="n">simulation_time</span><span class="o">*</span> <span class="p">&amp;</span>
               <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="nb">time</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/snapshot_frequency&quot;</span>
          <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Time between snapshots in seconds&quot;</span>
          <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">params</span><span class="p">%</span><span class="n">snapshot_frequency</span><span class="o">*</span> <span class="p">&amp;</span>
               <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="nb">time</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/dt&quot;</span>
          <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Time step in secs&quot;</span>
          <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">params</span><span class="p">%</span><span class="n">dt</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="nb">time</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/t_steps&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Number of time steps&quot;</span>
          <span class="n">idata</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">t_steps</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">idata</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/num_omp_threads&quot;</span>
          <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Number of omp threads&quot;</span>
          <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span> <span class="n">params</span><span class="p">%</span><span class="n">num_omp_threads</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/output_cadence&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Cadence of output files&quot;</span>
          <span class="n">idata</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">output_cadence</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">idata</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/HDF5_error_handling&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Error handling option: 0=OFF, 1=ON&quot;</span>
          <span class="n">idata</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">HDF5_error_handling</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">idata</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/restart_output_cadence&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Cadence of output files&quot;</span>
          <span class="n">idata</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">restart_output_cadence</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">idata</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/num_snapshots&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Number of outputs for each variable&quot;</span>
          <span class="n">idata</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">num_snapshots</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">idata</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/num_species&quot;</span>
          <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Number of particle species&quot;</span>
          <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">params</span><span class="p">%</span><span class="n">num_species</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/nmpi&quot;</span>
          <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Number of mpi processes&quot;</span>
          <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">params</span><span class="p">%</span><span class="n">mpi_params</span><span class="p">%</span><span class="n">nmpi</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/minimum_particle_energy&quot;</span>
          <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Minimum energy of simulated particles in eV&quot;</span>
          <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">params</span><span class="p">%</span><span class="n">minimum_particle_energy</span><span class="o">*</span> <span class="p">&amp;</span>
               <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">energy</span><span class="o">/</span><span class="n">C_E</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/minimum_particle_g&quot;</span>
          <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Minimum relativistic factor gamma of simulated particles&quot;</span>
          <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">params</span><span class="p">%</span><span class="n">minimum_particle_g</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/radiation&quot;</span>
          <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Radiation losses included in simulation&quot;</span>
          <span class="k">if</span><span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">radiation</span><span class="p">)</span> <span class="k">then</span>
<span class="k">             call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="mi">1_idef</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>
          <span class="k">else</span>
<span class="k">             call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="mi">0_idef</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>
          <span class="k">end if</span>

<span class="k">          </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/collisions&quot;</span>
          <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Collisions included in simulation&quot;</span>
          <span class="k">if</span><span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">collisions</span><span class="p">)</span> <span class="k">then</span>
<span class="k">             call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="mi">1_idef</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>
          <span class="k">else</span>
<span class="k">             call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="mi">0_idef</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>
          <span class="k">end if</span>

<span class="k">          </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/outputs_list&quot;</span>
          <span class="k">call </span><span class="n">save_string_parameter</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">params</span><span class="p">%</span><span class="n">outputs_list</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/orbit_model&quot;</span>
          <span class="k">call </span><span class="n">save_string_parameter</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,(</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">orbit_model</span><span class="o">/</span><span class="p">))</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/field_eval&quot;</span>
          <span class="k">call </span><span class="n">save_string_parameter</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,(</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">field_eval</span><span class="o">/</span><span class="p">))</span>

          <span class="k">DEALLOCATE</span><span class="p">(</span><span class="n">idata</span><span class="p">)</span>
          <span class="k">DEALLOCATE</span><span class="p">(</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="k">call </span><span class="n">h5gclose_f</span><span class="p">(</span><span class="n">group_id</span><span class="p">,</span> <span class="n">h5error</span><span class="p">)</span>


          <span class="c">! Plasma species group</span>
          <span class="n">gname</span> <span class="o">=</span> <span class="s2">&quot;species&quot;</span>
          <span class="k">call </span><span class="n">h5gcreate_f</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">),</span> <span class="n">group_id</span><span class="p">,</span> <span class="n">h5error</span><span class="p">)</span>

          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">attr_array</span><span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">num_species</span><span class="p">))</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/spatial_distribution&quot;</span>
          <span class="k">call </span><span class="n">save_string_parameter</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">spatial_distribution</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/energy_distribution&quot;</span>
          <span class="k">call </span><span class="n">save_string_parameter</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">energy_distribution</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/pitch_distribution&quot;</span>
          <span class="k">call </span><span class="n">save_string_parameter</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">pitch_distribution</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/ppp&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Particles per (mpi) process&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">ppp</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/q&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Electric charge&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">q</span><span class="o">*</span> <span class="p">&amp;</span>
               <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">charge</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/m&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Species mass in kg&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">m</span><span class="o">*</span> <span class="p">&amp;</span>
               <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">mass</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Eo&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Initial (average) energy in eV&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">Eo</span><span class="o">*</span> <span class="p">&amp;</span>
               <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">energy</span><span class="o">/</span><span class="n">C_E</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/go&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Initial relativistic g factor.&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">go</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/etao&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Initial pitch angle in degrees&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">etao</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/wc&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Average relativistic cyclotron frequency in Hz&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">wc_r</span><span class="o">/</span> <span class="p">&amp;</span>
               <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="nb">time</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Ro&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Initial radial position of population&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">Ro</span><span class="o">*</span> <span class="p">&amp;</span>
               <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/PHIo&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Azimuthal angle in degrees.&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">PHIo</span><span class="o">*</span> <span class="p">&amp;</span>
               <span class="mi">18</span><span class="mf">0.0_rp</span><span class="o">/</span><span class="n">C_PI</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Zo&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Initial Z position of population&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">Zo</span><span class="o">*</span> <span class="p">&amp;</span>
               <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/ri&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Inner radius of initial spatial distribution&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">r_inner</span><span class="o">*</span> <span class="p">&amp;</span>
               <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/ro&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Outter radius of initial spatial distribution&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">r_outter</span><span class="o">*</span> <span class="p">&amp;</span>
               <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/falloff_rate&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Falloff of gaussian or exponential radial &amp;</span>
<span class="s2">               profile in m&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">falloff_rate</span><span class="o">/</span> <span class="p">&amp;</span>
               <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/shear_factor&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Shear factor (in case ELLIPTIC-TORUS  &amp;</span>
<span class="s2">               spatial distribution is used.&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">shear_factor</span><span class="p">,</span> <span class="p">&amp;</span>
               <span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/sigmaR&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Variance of first dimension of 2D spatial &amp; </span>
<span class="s2">               distribution.&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
               <span class="n">spp</span><span class="p">%</span><span class="n">sigmaR</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/sigmaZ&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Variance of second dimension of 2D spatial &amp;</span>
<span class="s2">               distribution.&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
               <span class="n">spp</span><span class="p">%</span><span class="n">sigmaZ</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/theta_gauss&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Angle of rotation of 2D spatial distribution.&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">theta_gauss</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/psi_max&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Indicator function level of the argument of &amp;</span>
<span class="s2">               the 2D gaussian exponential.&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">psi_max</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/dth&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Variance of sampling normal variate for pitch angle.&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">dth</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/dgam&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Variance of sampling normal variate for gamma.&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">dgam</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/dR&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Variance of sampling normal variate for R.&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">dR</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span> <span class="p">&amp;</span>
               <span class="n">attr_array</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/dZ&quot;</span>
          <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Variance of sampling normal variate for Z.&quot;</span>
          <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">spp</span><span class="p">%</span><span class="n">dZ</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span> <span class="p">&amp;</span>
               <span class="n">attr_array</span><span class="p">)</span>
          
          <span class="k">call </span><span class="n">h5gclose_f</span><span class="p">(</span><span class="n">group_id</span><span class="p">,</span> <span class="n">h5error</span><span class="p">)</span>

          <span class="k">DEALLOCATE</span><span class="p">(</span><span class="n">attr_array</span><span class="p">)</span>


          <span class="c">! Plasma profiles group</span>
<span class="c">!          if (params%collisions) then</span>
             <span class="n">gname</span> <span class="o">=</span> <span class="s2">&quot;profiles&quot;</span>
             <span class="k">call </span><span class="n">h5gcreate_f</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">),</span> <span class="n">group_id</span><span class="p">,</span> <span class="n">h5error</span><span class="p">)</span>

             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/density_profile&quot;</span>
             <span class="k">call </span><span class="n">save_string_parameter</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,(</span><span class="o">/</span><span class="n">P</span><span class="p">%</span><span class="n">ne_profile</span><span class="o">/</span><span class="p">))</span>

             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/temperature_profile&quot;</span>
             <span class="k">call </span><span class="n">save_string_parameter</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,(</span><span class="o">/</span><span class="n">P</span><span class="p">%</span><span class="n">Te_profile</span><span class="o">/</span><span class="p">))</span>

             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Zeff_profile&quot;</span>
             <span class="k">call </span><span class="n">save_string_parameter</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,(</span><span class="o">/</span><span class="n">P</span><span class="p">%</span><span class="n">Zeff_profile</span><span class="o">/</span><span class="p">))</span>

             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/neo&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Density at the magnetic axis (m^-3)&quot;</span>
             <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">P</span><span class="p">%</span><span class="n">neo</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">density</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Teo&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Temperature at the magnetic axis (eV)&quot;</span>
             <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">P</span><span class="p">%</span><span class="n">Teo</span><span class="o">*</span> <span class="p">&amp;</span>
                  <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">temperature</span><span class="o">/</span><span class="n">C_E</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Zeffo&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Zeff at the magnetic axis&quot;</span>
             <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">P</span><span class="p">%</span><span class="n">Zeffo</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

             <span class="k">if</span> <span class="p">(</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">profile_model</span><span class="p">)</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="s1">&#39;ANALYTICAL&#39;</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/n_ne&quot;</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Exponent of tanh(x)^n for density profile&quot;</span>
                <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">P</span><span class="p">%</span><span class="n">n_ne</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/a_ne&quot;</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Coefficients f=ao+a1*r+a2*r^2+a3*r^3.  &amp;</span>
<span class="s2">                     a_ne=[a0,a1,a2,a3]&quot;</span>
                <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">P</span><span class="p">%</span><span class="n">a_ne</span><span class="p">)</span>

                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/n_Te&quot;</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Exponent of tanh(x)^n for density profile&quot;</span>
                <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">P</span><span class="p">%</span><span class="n">n_Te</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/a_Te&quot;</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Coefficients f=ao+a1*r+a2*r^2+a3*r^3.  &amp;</span>
<span class="s2">                     a_Te=[a0,a1,a2,a3]&quot;</span>
                <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">P</span><span class="p">%</span><span class="n">a_Te</span><span class="p">)</span>

                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/n_Zeff&quot;</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Exponent of tanh(x)^n for Zeff profile&quot;</span>
                <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">P</span><span class="p">%</span><span class="n">n_Zeff</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/a_Zeff&quot;</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Coefficients f=ao+a1*r+a2*r^2+a3*r^3.  &amp;</span>
<span class="s2">                     a_Zeff=[a0,a1,a2,a3]&quot;</span>
                <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">P</span><span class="p">%</span><span class="n">a_Zeff</span><span class="p">)</span>

                <span class="k">if</span>  <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">field_eval</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="s1">&#39;interp&#39;</span><span class="p">)</span> <span class="k">then</span>

<span class="k">                   ALLOCATE</span><span class="p">(</span><span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                   <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/dims&quot;</span>
                   <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Mesh dimension of the profile (NR,NPHI,NZ)&quot;</span>
                   <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

                   <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/R&quot;</span>
                   <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Radial position of the magnetic field grid nodes&quot;</span>
                   <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">R</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

                   <span class="k">if</span> <span class="p">(</span><span class="nb">ALLOCATED</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">PHI</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                      </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/PHI&quot;</span>
                      <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Azimuthal angle of the magnetic &amp;</span>
<span class="s2">                           field grid nodes&quot;</span>
                      <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">PHI</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>
                   <span class="k">end if</span>
<span class="k">                   </span>
<span class="k">                   </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Z&quot;</span>
                   <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Z position of the magnetic field grid nodes&quot;</span>
                   <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">Z</span><span class="o">*</span> <span class="p">&amp;</span>
                        <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

                   <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/ne&quot;</span>
                   <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">density</span>
                   <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">units</span><span class="o">*</span><span class="n">P</span><span class="p">%</span><span class="n">ne_2D</span><span class="p">)</span>

                   <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Te&quot;</span>
                   <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">temperature</span>
                   <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">units</span><span class="o">*</span><span class="n">P</span><span class="p">%</span><span class="n">Te_2D</span><span class="p">)</span>

                   <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Zeff&quot;</span>
                   <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">P</span><span class="p">%</span><span class="n">Zeff_2D</span><span class="p">)</span>

                   <span class="k">DEALLOCATE</span><span class="p">(</span><span class="n">attr_array</span><span class="p">)</span>
                <span class="k">end if</span>
<span class="k">                </span>
<span class="k">             else if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">profile_model</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">8</span><span class="p">)</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="s1">&#39;EXTERNAL&#39;</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                ALLOCATE</span><span class="p">(</span><span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/dims&quot;</span>
                <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Mesh dimension of the profiles (NR,NPHI,NZ)&quot;</span>
                <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">P</span><span class="p">%</span><span class="n">dims</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/R&quot;</span>
                <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Grid nodes of profiles along the &amp;</span>
<span class="s2">                     radial position&quot;</span>
                <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">P</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">R</span><span class="o">*</span> <span class="p">&amp;</span>
                     <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span><span class="nb">ALLOCATED</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">PHI</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                   </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/PHI&quot;</span>
                   <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Grid nodes of profiles along the &amp;</span>
<span class="s2">                        azimuthal position&quot;</span>
                   <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">P</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">PHI</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>
                <span class="k">end if</span>

<span class="k">                </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Z&quot;</span>
                <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Grid nodes of profiles along the Z position&quot;</span>
                <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">P</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">Z</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/ne&quot;</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">density</span>
                <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">units</span><span class="o">*</span><span class="n">P</span><span class="p">%</span><span class="n">ne_2D</span><span class="p">)</span>

                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Te&quot;</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">temperature</span>
                <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">units</span><span class="o">*</span><span class="n">P</span><span class="p">%</span><span class="n">Te_2D</span><span class="p">)</span>

                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Zeff&quot;</span>
                <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">P</span><span class="p">%</span><span class="n">Zeff_2D</span><span class="p">)</span>

                <span class="k">DEALLOCATE</span><span class="p">(</span><span class="n">attr_array</span><span class="p">)</span>
             <span class="k">else if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">profile_model</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="s1">&#39;UNIFORM&#39;</span><span class="p">)</span> <span class="k">then</span>
                <span class="c">! Something</span>
             <span class="k">end if</span>

<span class="k">             call </span><span class="n">h5gclose_f</span><span class="p">(</span><span class="n">group_id</span><span class="p">,</span> <span class="n">h5error</span><span class="p">)</span>
          <span class="c">!end if</span>


          <span class="c">! Electromagnetic fields group</span>

          <span class="n">gname</span> <span class="o">=</span> <span class="s2">&quot;fields&quot;</span>
          <span class="k">call </span><span class="n">h5gcreate_f</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">),</span> <span class="n">group_id</span><span class="p">,</span> <span class="n">h5error</span><span class="p">)</span>

          <span class="k">if</span> <span class="p">(</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">field_model</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">10</span><span class="p">))</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="s1">&#39;ANALYTICAL&#39;</span><span class="p">)</span> <span class="k">then</span>
<span class="k">             </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Bo&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Toroidal field at the magnetic axis in T&quot;</span>
             <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Bo</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/current_direction&quot;</span>
             <span class="k">call </span><span class="n">save_string_parameter</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                  <span class="p">(</span><span class="o">/</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">current_direction</span><span class="o">/</span><span class="p">))</span>

             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/a&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Minor radius in m&quot;</span>
             <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">a</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Ro&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Magnetic axis radial position&quot;</span>
             <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Ro</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Zo&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Magnetic axis vertical position&quot;</span>
             <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Zo</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>
             
             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/qa&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Safety factor at minor radius&quot;</span>
             <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">qa</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/qo&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Safety factor at the magnetic axis&quot;</span>
             <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">qo</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/lambda&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Parameter lamda in m&quot;</span>
             <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">lambda</span><span class="o">*</span> <span class="p">&amp;</span>
                  <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Bpo&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Poloidal magnetic field in T&quot;</span>
             <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">Bpo</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>
             
             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Eo&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Electric field at the magnetic axis in V/m&quot;</span>
             <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Eo</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Eo</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

             <span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">SC_E</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/dt_E_SC&quot;</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Time step for self-consistent E calculation&quot;</span>
                <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dt_E_SC</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Ip_exp&quot;</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Scaling for self-consistent current density&quot;</span>
                <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Ip_exp</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Ip0&quot;</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Total RE current normalization&quot;</span>
                <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Ip0</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>
                
                <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/r_1D&quot;</span>
                <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;1D minor radial mesh for &amp;</span>
<span class="s2">                     self-consistent fields&quot;</span>
                <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">r_1D</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>
                <span class="k">DEALLOCATE</span><span class="p">(</span><span class="n">attr_array</span><span class="p">)</span>
             <span class="k">end if</span>
<span class="k">             </span>
<span class="k">             if</span>  <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">field_eval</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="s1">&#39;interp&#39;</span><span class="p">)</span> <span class="k">then</span>

<span class="k">                ALLOCATE</span><span class="p">(</span><span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/dims&quot;</span>
                <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Mesh dimension of the magnetic  &amp;</span>
<span class="s2">                     field (NR,NPHI,NZ)&quot;</span>
                <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/R&quot;</span>
                <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Radial position of the magnetic field grid nodes&quot;</span>
                <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">R</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span><span class="nb">ALLOCATED</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">PHI</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                   </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/PHI&quot;</span>
                   <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Azimuthal angle of the magnetic &amp;</span>
<span class="s2">                        field grid nodes&quot;</span>
                   <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">PHI</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>
                <span class="k">end if</span>

<span class="k">                </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Z&quot;</span>
                <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Z position of the magnetic field grid nodes&quot;</span>
                <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">Z</span><span class="o">*</span> <span class="p">&amp;</span>
                     <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span><span class="nb">ALLOCATED</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">PSIp</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                   </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/psi_p&quot;</span>
                   <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="o">**</span><span class="mi">2</span>
                   <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">PSIp</span><span class="p">)</span>
                <span class="k">end if</span>
<span class="k">                </span>
<span class="k">                if</span><span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">field_model</span><span class="p">(</span><span class="mi">12</span><span class="p">:</span><span class="mi">13</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;2D&#39;</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                </span>
<span class="k">                   </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/BR&quot;</span>
                   <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span>
                   <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">B_2D</span><span class="p">%</span><span class="n">R</span><span class="p">)</span>

                   <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/BPHI&quot;</span>
                   <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span>
                   <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">B_2D</span><span class="p">%</span><span class="n">PHI</span><span class="p">)</span>

                   <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/BZ&quot;</span>
                   <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span>
                   <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">B_2D</span><span class="p">%</span><span class="n">Z</span><span class="p">)</span>
                   
                   <span class="k">if</span> <span class="p">(</span><span class="nb">ALLOCATED</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">FLAG2D</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                      </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Flag&quot;</span>
                      <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                           <span class="n">F</span><span class="p">%</span><span class="n">FLAG2D</span><span class="p">)</span>
                   <span class="k">end if</span>
<span class="k">                </span>
<span class="k">                   if</span>  <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">orbit_model</span><span class="p">(</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">).</span><span class="n">EQ</span><span class="p">.</span><span class="s1">&#39;pre&#39;</span><span class="p">)</span> <span class="k">then</span>

<span class="k">                      </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/gradBR&quot;</span>
                      <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                      <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                           <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">gradB_2D</span><span class="p">%</span><span class="n">R</span><span class="p">)</span>

                      <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/gradBPHI&quot;</span>
                      <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                      <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                           <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">gradB_2D</span><span class="p">%</span><span class="n">PHI</span><span class="p">)</span>

                      <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/gradBZ&quot;</span>
                      <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                      <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                           <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">gradB_2D</span><span class="p">%</span><span class="n">Z</span><span class="p">)</span>

                      <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/curlbR&quot;</span>
                      <span class="n">units</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                      <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                           <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">curlb_2D</span><span class="p">%</span><span class="n">R</span><span class="p">)</span>

                      <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/curlbPHI&quot;</span>
                      <span class="n">units</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                      <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                           <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">curlb_2D</span><span class="p">%</span><span class="n">PHI</span><span class="p">)</span>

                      <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/curlbZ&quot;</span>
                      <span class="n">units</span> <span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                      <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                           <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">curlb_2D</span><span class="p">%</span><span class="n">Z</span><span class="p">)</span>

                   <span class="k">end if</span>

<span class="k">                else if</span><span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">field_model</span><span class="p">(</span><span class="mi">12</span><span class="p">:</span><span class="mi">13</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;3D&#39;</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                </span>
<span class="k">                   </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/BR&quot;</span>
                   <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span>
                   <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">B_3D</span><span class="p">%</span><span class="n">R</span><span class="p">)</span>

                   <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/BPHI&quot;</span>
                   <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span>
                   <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">B_3D</span><span class="p">%</span><span class="n">PHI</span><span class="p">)</span>

                   <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/BZ&quot;</span>
                   <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span>
                   <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">B_3D</span><span class="p">%</span><span class="n">Z</span><span class="p">)</span>
                   
                   <span class="k">if</span> <span class="p">(</span><span class="nb">ALLOCATED</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">FLAG3D</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                      </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Flag&quot;</span>
                      <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                           <span class="n">F</span><span class="p">%</span><span class="n">FLAG3D</span><span class="p">)</span>
                   <span class="k">end if</span>
<span class="k">                </span>
<span class="k">                   if</span>  <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">orbit_model</span><span class="p">(</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">).</span><span class="n">EQ</span><span class="p">.</span><span class="s1">&#39;pre&#39;</span><span class="p">)</span> <span class="k">then</span>

<span class="k">                      </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/gradBR&quot;</span>
                      <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                      <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                           <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">gradB_3D</span><span class="p">%</span><span class="n">R</span><span class="p">)</span>

                      <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/gradBPHI&quot;</span>
                      <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                      <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                           <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">gradB_3D</span><span class="p">%</span><span class="n">PHI</span><span class="p">)</span>

                      <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/gradBZ&quot;</span>
                      <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                      <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                           <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">gradB_3D</span><span class="p">%</span><span class="n">Z</span><span class="p">)</span>

                      <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/curlbR&quot;</span>
                      <span class="n">units</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                      <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                           <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">curlb_3D</span><span class="p">%</span><span class="n">R</span><span class="p">)</span>

                      <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/curlbPHI&quot;</span>
                      <span class="n">units</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                      <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                           <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">curlb_3D</span><span class="p">%</span><span class="n">PHI</span><span class="p">)</span>

                      <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/curlbZ&quot;</span>
                      <span class="n">units</span> <span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                      <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                           <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">curlb_3D</span><span class="p">%</span><span class="n">Z</span><span class="p">)</span>

                   <span class="k">end if</span>
<span class="k">                end if</span>
<span class="k">                   </span>
<span class="k">                DEALLOCATE</span><span class="p">(</span><span class="n">attr_array</span><span class="p">)</span>
             <span class="k">end if</span>

<span class="k">          else if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">field_model</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">8</span><span class="p">)</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="s1">&#39;EXTERNAL&#39;</span><span class="p">)</span> <span class="k">then</span>
<span class="k">             ALLOCATE</span><span class="p">(</span><span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
             
             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/dims&quot;</span>
             <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Mesh dimension of the magnetic  &amp;</span>
<span class="s2">                  field (NR,NPHI,NZ)&quot;</span>
             <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/R&quot;</span>
             <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Radial position of the magnetic field grid nodes&quot;</span>
             <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                  <span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">R</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

             <span class="k">if</span> <span class="p">(</span><span class="nb">ALLOCATED</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">PHI</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                if</span> <span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">Dim2x1t</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                   </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/PHI&quot;</span>
                   <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Azimuthal angle of the magnetic &amp;</span>
<span class="s2">                        field grid nodes&quot;</span>
                   <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">PHI</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="nb">time</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>
                <span class="k">else</span>
<span class="k">                   </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/PHI&quot;</span>
                   <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Azimuthal angle of the magnetic &amp;</span>
<span class="s2">                        field grid nodes&quot;</span>
                   <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">PHI</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>
                <span class="k">end if</span>
<span class="k">             end if</span>

<span class="k">             </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Z&quot;</span>
             <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Z position of the magnetic field grid nodes&quot;</span>
             <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">Z</span><span class="o">*</span> <span class="p">&amp;</span>
                  <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>

             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Bo&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Toroidal field at the magnetic axis in T&quot;</span>
             <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Bo</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Eo&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Electric field at the magnetic axis in V/m&quot;</span>
             <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Eo</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Eo</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/E_dyn&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Magnitude of dynamic E&quot;</span>
             <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">E_dyn</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Eo</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>
             
             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/E_pulse&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Magnitude of dynamic E&quot;</span>
             <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">E_pulse</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="nb">time</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/E_width&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Magnitude of dynamic E&quot;</span>
             <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">E_width</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="nb">time</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>
             
             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Ro&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Radial position of magnetic axis&quot;</span>
             <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Ro</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Zo&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Radial position of magnetic axis&quot;</span>
             <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Zo</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Axisymmetric&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Radial position of magnetic axis&quot;</span>
             <span class="k">if</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">axisymmetric_fields</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="mi">1_idef</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>
             <span class="k">else</span>
<span class="k">                call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="mi">0_idef</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>
             <span class="k">end if</span>

<span class="k">             if</span> <span class="p">(</span><span class="nb">ALLOCATED</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">PSIp</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/psi_p&quot;</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="o">**</span><span class="mi">2</span>
                <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">PSIp</span><span class="p">)</span>
             <span class="k">end if</span>

<span class="k">             if</span> <span class="p">(</span><span class="nb">ALLOCATED</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">E_3D</span><span class="p">%</span><span class="n">R</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/ER3D&quot;</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Eo</span>
                <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">E_3D</span><span class="p">%</span><span class="n">R</span><span class="p">)</span>
             <span class="k">end if</span>
<span class="k">             </span>
<span class="k">             if</span> <span class="p">(</span><span class="nb">ALLOCATED</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">E_3D</span><span class="p">%</span><span class="n">PHI</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/EPHI3D&quot;</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Eo</span>
                <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">E_3D</span><span class="p">%</span><span class="n">PHI</span><span class="p">)</span>
             <span class="k">end if</span>
<span class="k">             </span>
<span class="k">             if</span> <span class="p">(</span><span class="nb">ALLOCATED</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">PSIp3D</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/psi_p3D&quot;</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="o">**</span><span class="mi">2</span>
                <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">PSIp3D</span><span class="p">)</span>
             <span class="k">end if</span>

<span class="k">             if</span> <span class="p">(</span><span class="nb">ALLOCATED</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">FLAG2D</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Flag2D&quot;</span>
                <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">F</span><span class="p">%</span><span class="n">FLAG2D</span><span class="p">)</span>
             <span class="k">end if</span>

<span class="k">             if</span> <span class="p">(</span><span class="nb">ALLOCATED</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">FLAG3D</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Flag3D&quot;</span>
                <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">F</span><span class="p">%</span><span class="n">FLAG3D</span><span class="p">)</span>
             <span class="k">end if</span>


<span class="k">             if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">SC_E</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/dt_E_SC&quot;</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Time step for self-consistent E calculation&quot;</span>
                <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dt_E_SC</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Ip_exp&quot;</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Scaling for self-consistent current density&quot;</span>
                <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Ip_exp</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Ip0&quot;</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Total RE current normalization&quot;</span>
                <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Ip0</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>
                
                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/PSIP_1D&quot;</span>
                <span class="n">attr_array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;1D minor radial mesh for &amp;</span>
<span class="s2">                     self-consistent fields&quot;</span>
                <span class="k">call </span><span class="n">save_1d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">PSIP_1D</span><span class="p">,</span><span class="n">attr_array</span><span class="p">)</span>
             <span class="k">end if</span>
<span class="k">             </span>
<span class="k">             if</span>  <span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">axisymmetric_fields</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
                  <span class="p">.</span><span class="nb">not</span><span class="p">.(</span><span class="n">params</span><span class="p">%</span><span class="n">field_model</span><span class="p">(</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;PSI&#39;</span><span class="p">))</span> <span class="k">then</span>

<span class="k">                </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/BR&quot;</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span>
                <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">B_2D</span><span class="p">%</span><span class="n">R</span><span class="p">)</span>

                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/BPHI&quot;</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span>
                <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">B_2D</span><span class="p">%</span><span class="n">PHI</span><span class="p">)</span>

                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/BZ&quot;</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span>
                <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">B_2D</span><span class="p">%</span><span class="n">Z</span><span class="p">)</span>

                <span class="k">if</span>  <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">orbit_model</span><span class="p">(</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">).</span><span class="n">EQ</span><span class="p">.</span><span class="s1">&#39;pre&#39;</span><span class="p">)</span> <span class="k">then</span>

<span class="k">                   </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/gradBR&quot;</span>
                   <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                   <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">gradB_2D</span><span class="p">%</span><span class="n">R</span><span class="p">)</span>

                   <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/gradBPHI&quot;</span>
                   <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                   <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">gradB_2D</span><span class="p">%</span><span class="n">PHI</span><span class="p">)</span>

                   <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/gradBZ&quot;</span>
                   <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                   <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">gradB_2D</span><span class="p">%</span><span class="n">Z</span><span class="p">)</span>

                   <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/curlbR&quot;</span>
                   <span class="n">units</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                   <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">curlb_2D</span><span class="p">%</span><span class="n">R</span><span class="p">)</span>

                   <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/curlbPHI&quot;</span>
                   <span class="n">units</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                   <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">curlb_2D</span><span class="p">%</span><span class="n">PHI</span><span class="p">)</span>

                   <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/curlbZ&quot;</span>
                   <span class="n">units</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                   <span class="k">call </span><span class="n">rsave_2d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">curlb_2D</span><span class="p">%</span><span class="n">Z</span><span class="p">)</span>

                <span class="k">end if</span>
<span class="k">                </span>
<span class="k">             else if</span> <span class="p">((.</span><span class="nb">not</span><span class="p">.</span><span class="n">F</span><span class="p">%</span><span class="n">axisymmetric_fields</span><span class="p">).</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
                  <span class="p">.</span><span class="nb">not</span><span class="p">.(</span><span class="n">params</span><span class="p">%</span><span class="n">field_model</span><span class="p">(</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;PSI&#39;</span><span class="p">))</span> <span class="k">then</span>

<span class="k">                </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/BR&quot;</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span>
                <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">B_3D</span><span class="p">%</span><span class="n">R</span><span class="p">)</span>

                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/BPHI&quot;</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span>
                <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">B_3D</span><span class="p">%</span><span class="n">PHI</span><span class="p">)</span>

                <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/BZ&quot;</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span>
                <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">B_3D</span><span class="p">%</span><span class="n">Z</span><span class="p">)</span>

                <span class="k">if</span>  <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">orbit_model</span><span class="p">(</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">).</span><span class="n">EQ</span><span class="p">.</span><span class="s1">&#39;pre&#39;</span><span class="p">)</span> <span class="k">then</span>

<span class="k">                   </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/gradBR&quot;</span>
                   <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                   <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">gradB_3D</span><span class="p">%</span><span class="n">R</span><span class="p">)</span>

                   <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/gradBPHI&quot;</span>
                   <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                   <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">gradB_3D</span><span class="p">%</span><span class="n">PHI</span><span class="p">)</span>

                   <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/gradBZ&quot;</span>
                   <span class="n">units</span> <span class="o">=</span> <span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                   <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">gradB_3D</span><span class="p">%</span><span class="n">Z</span><span class="p">)</span>

                   <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/curlbR&quot;</span>
                   <span class="n">units</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                   <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">curlb_3D</span><span class="p">%</span><span class="n">R</span><span class="p">)</span>

                   <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/curlbPHI&quot;</span>
                   <span class="n">units</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                   <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">curlb_3D</span><span class="p">%</span><span class="n">PHI</span><span class="p">)</span>

                   <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/curlbZ&quot;</span>
                   <span class="n">units</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span>
                   <span class="k">call </span><span class="n">rsave_3d_array_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="n">units</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">curlb_3D</span><span class="p">%</span><span class="n">Z</span><span class="p">)</span>

                <span class="k">end if</span>
<span class="k">             end if</span>
<span class="k">             </span>
<span class="k">             DEALLOCATE</span><span class="p">(</span><span class="n">attr_array</span><span class="p">)</span>
          <span class="k">else if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">field_model</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="s1">&#39;UNIFORM&#39;</span><span class="p">)</span> <span class="k">then</span>
<span class="k">             </span><span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Bo&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Magnetic field in T&quot;</span>
             <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Bo</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

             <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/Eo&quot;</span>
             <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Electric field in V/m&quot;</span>
             <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Eo</span><span class="o">*</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Eo</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>
          <span class="k">end if</span>

<span class="k">          call </span><span class="n">h5gclose_f</span><span class="p">(</span><span class="n">group_id</span><span class="p">,</span> <span class="n">h5error</span><span class="p">)</span>


          <span class="c">! Characteristic scales</span>
          <span class="n">gname</span> <span class="o">=</span> <span class="s2">&quot;scales&quot;</span>
          <span class="k">call </span><span class="n">h5gcreate_f</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">),</span> <span class="n">group_id</span><span class="p">,</span> <span class="n">h5error</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/t&quot;</span>
          <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Characteristic time in secs&quot;</span>
          <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="nb">time</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/m&quot;</span>
          <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Characteristic mass in kg&quot;</span>
          <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">mass</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/q&quot;</span>
          <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Characteristic charge in Coulombs&quot;</span>
          <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">charge</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/l&quot;</span>
          <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Characteristic length in m&quot;</span>
          <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">length</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/v&quot;</span>
          <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Characteristic velocity in m&quot;</span>
          <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">velocity</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/K&quot;</span>
          <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Characteristic kinetic energy in J&quot;</span>
          <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">energy</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/n&quot;</span>
          <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Characteristic plasma density in m^-3&quot;</span>
          <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">density</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/E&quot;</span>
          <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Characteristic electric field in V/m&quot;</span>
          <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Eo</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/B&quot;</span>
          <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Characteristic magnetic field in T&quot;</span>
          <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">Bo</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/P&quot;</span>
          <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Characteristic pressure in Pa&quot;</span>
          <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">pressure</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

          <span class="n">dset</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;/T&quot;</span>
          <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Characteristic plasma temperature in J&quot;</span>
          <span class="k">call </span><span class="n">save_to_hdf5</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span><span class="n">dset</span><span class="p">,</span><span class="n">params</span><span class="p">%</span><span class="n">cpp</span><span class="p">%</span><span class="n">temperature</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>

          <span class="k">call </span><span class="n">h5gclose_f</span><span class="p">(</span><span class="n">group_id</span><span class="p">,</span> <span class="n">h5error</span><span class="p">)</span>

          <span class="k">call </span><span class="n">h5fclose_f</span><span class="p">(</span><span class="n">h5file_id</span><span class="p">,</span> <span class="n">h5error</span><span class="p">)</span>
       <span class="k">end if</span>

<span class="k">    end if</span>
<span class="k">  end subroutine </span><span class="n">save_simulation_parameters</span>
</pre></div>

    </section>
    <br>
    
    
    </div>
  </div>


    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2020 
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on  
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> KORC-Full Orbit was developed by Matt Beidler</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>