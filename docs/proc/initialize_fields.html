<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="Kinetic Orbit Runaway electrons Code (KORC)">
    
    <meta name="author" content="Matt Beidler" >
    <link rel="icon" href="../favicon.png">

    <title>initialize_fields &ndash; KORC</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">KORC </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>README</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/main.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/main.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>initialize_fields
      <small>Subroutine</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 1.4% of total for procedures.">296 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/korc_fields.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
     <li><a href='../sourcefile/korc_fields.f90.html'>korc_fields.f90</a></li>
    
     <li><a href='../module/korc_fields.html'>korc_fields</a></li>
    
  
     <li class="active">initialize_fields</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/initialize_fields.html#src">initialize_fields</a>
  </div>
</div>



</div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>
public subroutine initialize_fields(params, F)
    
    
   
</h2>
    
  


    
    <p></p><div class="alert alert-info" role="alert"><h4>Note</h4><p>Subroutine that initializes the analytical or externally
 calculated electric and magnetic fields. </p></div>
<p>In this subroutine we load the parameters of the electric and
 magnetic fields from the namelists 'analytical_fields_params' and
 'externalPlasmaModel' in the input file.
 Sign convention in analytical fields corresponds to
 DIII-D fields with <script type="math/tex">B_\phi<0</script> and <script type="math/tex">B_\theta<0</script>.
 Sign convention in analytical fields corresponds to
 DIII-D fields with <script type="math/tex">B_\phi<0</script> and <script type="math/tex">B_\theta<0</script>.</p>
    

    <h3>Arguments</h3>
    
      
<table class="table table-striped varlist">
<thead><tr><th>Type</th>
<th>Intent</th><th>Optional</th>
<th>Attributes</th><th></th><th>Name</th><th></th></thead>



<tbody>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-params~176"></span>type(KORC_PARAMS),</td>
  <td>intent(inout)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>params</strong></td><td><p>Core KORC simulation parameters.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-f~116"></span>type(FIELDS),</td>
  <td>intent(out)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>F</strong></td><td><p>An instance of the KORC derived type FIELDS.</p>
<p>Magnetic field at magnetic axis for an 'ANALYTICAL' magnetic field,
 or the magnitude of the magnetic field for a 'UNFIROM' plasma.</p>
<p>Plasma edge <script type="math/tex">r_{edge}</script> as measured from the magnetic axis.</p>
<p>Radial position of the magnetic axis <script type="math/tex">R_0</script>
</p>
<p>Safety factor at the plasma edge.</p>
<p>Safety factor at the magnetic axis <script type="math/tex">q_0</script>.</p>
<p>String with information about the direction of the plasma current, 
 'PARALLEL'  or 'ANTI-PARALLEL' to the toroidal magnetic field.</p>
<p>Electric field at the magnetic axis.</p>
<p>Logical variable that specifies if the electric field is 
 going to be used on in a given simulation.</p>
<p>Logical variable that specifies if the magnetic field is 
 going to be used on in a given simulation.</p>
<p>Logical variable that specifies if the poloidal magnetic 
 flux is going to be used on in a given simulation.</p>
<p>Logical variable that specifies if the plasma is axisymmetric.</p></td>
  
</tr>

</tbody>
</table>

    
    
    
    <br>
    
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Calls</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: proc~~initialize_fields~~CallsGraph Pages: 1 -->
<svg id="procinitialize_fieldsCallsGraph" width="641pt" height="416pt"
 viewBox="0.00 0.00 641.00 416.13" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~initialize_fields~~CallsGraph" class="graph" transform="scale(.8616 .8616) rotate(0) translate(4 479)">
<title>proc~~initialize_fields~~CallsGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-479 740,-479 740,4 -4,4"/>
<!-- proc~initialize_fields -->
<g id="proc~~initialize_fields~~CallsGraph_node1" class="node">
<title>proc~initialize_fields</title>
<polygon fill="none" stroke="#000000" points="80,-265 0,-265 0,-241 80,-241 80,-265"/>
<text text-anchor="middle" x="40" y="-250.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">initialize_fields</text>
</g>
<!-- proc~which_fields_in_file -->
<g id="proc~~initialize_fields~~CallsGraph_node2" class="node">
<title>proc~which_fields_in_file</title>
<g id="a_proc~~initialize_fields~~CallsGraph_node2"><a xlink:href=".././proc/which_fields_in_file.html" xlink:title="which_fields_in_file">
<polygon fill="#d9534f" stroke="#d9534f" points="256.5,-349 153.5,-349 153.5,-325 256.5,-325 256.5,-349"/>
<text text-anchor="middle" x="205" y="-334.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">which_fields_in_file</text>
</a>
</g>
</g>
<!-- proc~initialize_fields&#45;&gt;proc~which_fields_in_file -->
<g id="proc~~initialize_fields~~CallsGraph_edge1" class="edge">
<title>proc~initialize_fields&#45;&gt;proc~which_fields_in_file</title>
<path fill="none" stroke="#000000" d="M51.1379,-265.1563C64.962,-279.4941 89.9184,-303.0151 116,-316 124.5437,-320.2536 133.9828,-323.6674 143.4256,-326.4014"/>
<polygon fill="#000000" stroke="#000000" points="142.666,-329.8211 153.2298,-329.0111 144.4666,-323.0566 142.666,-329.8211"/>
</g>
<!-- proc~allocate_2d_fields_arrays -->
<g id="proc~~initialize_fields~~CallsGraph_node3" class="node">
<title>proc~allocate_2d_fields_arrays</title>
<g id="a_proc~~initialize_fields~~CallsGraph_node3"><a xlink:href=".././proc/allocate_2d_fields_arrays.html" xlink:title="ALLOCATE_2D_FIELDS_ARRAYS">
<polygon fill="#d9534f" stroke="#d9534f" points="294,-475 116,-475 116,-451 294,-451 294,-475"/>
<text text-anchor="middle" x="205" y="-460.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ALLOCATE_2D_FIELDS_ARRAYS</text>
</a>
</g>
</g>
<!-- proc~initialize_fields&#45;&gt;proc~allocate_2d_fields_arrays -->
<g id="proc~~initialize_fields~~CallsGraph_edge2" class="edge">
<title>proc~initialize_fields&#45;&gt;proc~allocate_2d_fields_arrays</title>
<path fill="none" stroke="#000000" d="M41.1305,-265.3842C44.91,-299.2474 60.2183,-394.0452 116,-442 117.5349,-443.3196 119.1377,-444.5598 120.7978,-445.7252"/>
<polygon fill="#000000" stroke="#000000" points="119.1492,-448.8175 129.5269,-450.9514 122.745,-442.8116 119.1492,-448.8175"/>
</g>
<!-- proc~initialize_gc_fields_3d -->
<g id="proc~~initialize_fields~~CallsGraph_node4" class="node">
<title>proc~initialize_gc_fields_3d</title>
<g id="a_proc~~initialize_fields~~CallsGraph_node4"><a xlink:href=".././proc/initialize_gc_fields_3d.html" xlink:title="initialize_GC_fields_3D">
<polygon fill="#d9534f" stroke="#d9534f" points="265.5,-391 144.5,-391 144.5,-367 265.5,-367 265.5,-391"/>
<text text-anchor="middle" x="205" y="-376.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">initialize_GC_fields_3D</text>
</a>
</g>
</g>
<!-- proc~initialize_fields&#45;&gt;proc~initialize_gc_fields_3d -->
<g id="proc~~initialize_fields~~CallsGraph_edge3" class="edge">
<title>proc~initialize_fields&#45;&gt;proc~initialize_gc_fields_3d</title>
<path fill="none" stroke="#000000" d="M45.294,-265.259C55.5334,-287.4442 80.2373,-334.1587 116,-358 121.6801,-361.7866 127.963,-364.8937 134.486,-367.4426"/>
<polygon fill="#000000" stroke="#000000" points="133.5777,-370.8318 144.1725,-370.7919 135.8652,-364.2161 133.5777,-370.8318"/>
</g>
<!-- proc~load_prev_iter -->
<g id="proc~~initialize_fields~~CallsGraph_node5" class="node">
<title>proc~load_prev_iter</title>
<g id="a_proc~~initialize_fields~~CallsGraph_node5"><a xlink:href=".././proc/load_prev_iter.html" xlink:title="load_prev_iter">
<polygon fill="#d9534f" stroke="#d9534f" points="244.5,-433 165.5,-433 165.5,-409 244.5,-409 244.5,-433"/>
<text text-anchor="middle" x="205" y="-418.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">load_prev_iter</text>
</a>
</g>
</g>
<!-- proc~initialize_fields&#45;&gt;proc~load_prev_iter -->
<g id="proc~~initialize_fields~~CallsGraph_edge4" class="edge">
<title>proc~initialize_fields&#45;&gt;proc~load_prev_iter</title>
<path fill="none" stroke="#000000" d="M42.6111,-265.0968C49.3796,-293.4121 70.2487,-364.2956 116,-400 127.179,-408.7241 141.3916,-413.9168 155.1601,-416.9804"/>
<polygon fill="#000000" stroke="#000000" points="154.5808,-420.4329 165.0575,-418.855 155.8835,-413.5551 154.5808,-420.4329"/>
</g>
<!-- proc~allocate_1d_fs_arrays -->
<g id="proc~~initialize_fields~~CallsGraph_node6" class="node">
<title>proc~allocate_1d_fs_arrays</title>
<g id="a_proc~~initialize_fields~~CallsGraph_node6"><a xlink:href=".././proc/allocate_1d_fs_arrays.html" xlink:title="allocate_1D_FS_arrays">
<polygon fill="#d9534f" stroke="#d9534f" points="266,-181 144,-181 144,-157 266,-157 266,-181"/>
<text text-anchor="middle" x="205" y="-166.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">allocate_1D_FS_arrays</text>
</a>
</g>
</g>
<!-- proc~initialize_fields&#45;&gt;proc~allocate_1d_fs_arrays -->
<g id="proc~~initialize_fields~~CallsGraph_edge5" class="edge">
<title>proc~initialize_fields&#45;&gt;proc~allocate_1d_fs_arrays</title>
<path fill="none" stroke="#000000" d="M51.1379,-240.8437C64.962,-226.5059 89.9184,-202.9849 116,-190 121.6892,-187.1676 127.7753,-184.7075 133.9952,-182.5726"/>
<polygon fill="#000000" stroke="#000000" points="135.3507,-185.8155 143.8416,-179.4786 133.2522,-179.1374 135.3507,-185.8155"/>
</g>
<!-- proc~load_1d_fs_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_node7" class="node">
<title>proc~load_1d_fs_from_hdf5</title>
<g id="a_proc~~initialize_fields~~CallsGraph_node7"><a xlink:href=".././proc/load_1d_fs_from_hdf5.html" xlink:title="load_1D_FS_from_hdf5">
<polygon fill="#d9534f" stroke="#d9534f" points="267,-265 143,-265 143,-241 267,-241 267,-265"/>
<text text-anchor="middle" x="205" y="-250.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">load_1D_FS_from_hdf5</text>
</a>
</g>
</g>
<!-- proc~initialize_fields&#45;&gt;proc~load_1d_fs_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_edge6" class="edge">
<title>proc~initialize_fields&#45;&gt;proc~load_1d_fs_from_hdf5</title>
<path fill="none" stroke="#000000" d="M80.3635,-253C96.1484,-253 114.7465,-253 132.6913,-253"/>
<polygon fill="#000000" stroke="#000000" points="132.8622,-256.5001 142.8621,-253 132.8621,-249.5001 132.8622,-256.5001"/>
</g>
<!-- proc~initialize_gc_fields -->
<g id="proc~~initialize_fields~~CallsGraph_node8" class="node">
<title>proc~initialize_gc_fields</title>
<g id="a_proc~~initialize_fields~~CallsGraph_node8"><a xlink:href=".././proc/initialize_gc_fields.html" xlink:title="initialize_GC_fields">
<polygon fill="#d9534f" stroke="#d9534f" points="256,-223 154,-223 154,-199 256,-199 256,-223"/>
<text text-anchor="middle" x="205" y="-208.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">initialize_GC_fields</text>
</a>
</g>
</g>
<!-- proc~initialize_fields&#45;&gt;proc~initialize_gc_fields -->
<g id="proc~~initialize_fields~~CallsGraph_edge7" class="edge">
<title>proc~initialize_fields&#45;&gt;proc~initialize_gc_fields</title>
<path fill="none" stroke="#000000" d="M80.1554,-241.5987C91.7029,-238.4031 104.3302,-234.9879 116,-232 124.9226,-229.7155 134.3719,-227.3879 143.651,-225.1541"/>
<polygon fill="#000000" stroke="#000000" points="144.7064,-228.5005 153.6199,-222.7735 143.0805,-221.692 144.7064,-228.5005"/>
</g>
<!-- proc~load_dim_data_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_node9" class="node">
<title>proc~load_dim_data_from_hdf5</title>
<g id="a_proc~~initialize_fields~~CallsGraph_node9"><a xlink:href=".././proc/load_dim_data_from_hdf5.html" xlink:title="load_dim_data_from_hdf5">
<polygon fill="#d9534f" stroke="#d9534f" points="272.5,-307 137.5,-307 137.5,-283 272.5,-283 272.5,-307"/>
<text text-anchor="middle" x="205" y="-292.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">load_dim_data_from_hdf5</text>
</a>
</g>
</g>
<!-- proc~initialize_fields&#45;&gt;proc~load_dim_data_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_edge8" class="edge">
<title>proc~initialize_fields&#45;&gt;proc~load_dim_data_from_hdf5</title>
<path fill="none" stroke="#000000" d="M80.1554,-264.4013C91.7029,-267.5969 104.3302,-271.0121 116,-274 124.4924,-276.1744 133.462,-278.3878 142.3078,-280.5222"/>
<polygon fill="#000000" stroke="#000000" points="141.6704,-283.9684 152.2104,-282.8922 143.2998,-277.1607 141.6704,-283.9684"/>
</g>
<!-- proc~korc_abort -->
<g id="proc~~initialize_fields~~CallsGraph_node10" class="node">
<title>proc~korc_abort</title>
<g id="a_proc~~initialize_fields~~CallsGraph_node10"><a xlink:href=".././proc/korc_abort.html" xlink:title="korc_abort">
<polygon fill="#d9534f" stroke="#d9534f" points="236,-97 174,-97 174,-73 236,-73 236,-97"/>
<text text-anchor="middle" x="205" y="-82.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">korc_abort</text>
</a>
</g>
</g>
<!-- proc~initialize_fields&#45;&gt;proc~korc_abort -->
<g id="proc~~initialize_fields~~CallsGraph_edge9" class="edge">
<title>proc~initialize_fields&#45;&gt;proc~korc_abort</title>
<path fill="none" stroke="#000000" d="M42.6111,-240.9032C49.3796,-212.5879 70.2487,-141.7044 116,-106 129.4494,-95.5041 147.2898,-90.1196 163.465,-87.4047"/>
<polygon fill="#000000" stroke="#000000" points="164.3637,-90.8139 173.7911,-85.9792 163.4064,-83.8797 164.3637,-90.8139"/>
</g>
<!-- proc~load_field_data_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_node11" class="node">
<title>proc~load_field_data_from_hdf5</title>
<g id="a_proc~~initialize_fields~~CallsGraph_node11"><a xlink:href=".././proc/load_field_data_from_hdf5.html" xlink:title="load_field_data_from_hdf5">
<polygon fill="#d9534f" stroke="#d9534f" points="273.5,-139 136.5,-139 136.5,-115 273.5,-115 273.5,-139"/>
<text text-anchor="middle" x="205" y="-124.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">load_field_data_from_hdf5</text>
</a>
</g>
</g>
<!-- proc~initialize_fields&#45;&gt;proc~load_field_data_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_edge10" class="edge">
<title>proc~initialize_fields&#45;&gt;proc~load_field_data_from_hdf5</title>
<path fill="none" stroke="#000000" d="M45.294,-240.741C55.5334,-218.5558 80.2373,-171.8413 116,-148 119.4923,-145.6719 123.2124,-143.6007 127.0761,-141.7581"/>
<polygon fill="#000000" stroke="#000000" points="128.4598,-144.9731 136.3123,-137.8605 125.7382,-138.5238 128.4598,-144.9731"/>
</g>
<!-- proc~allocate_3d_fields_arrays -->
<g id="proc~~initialize_fields~~CallsGraph_node12" class="node">
<title>proc~allocate_3d_fields_arrays</title>
<g id="a_proc~~initialize_fields~~CallsGraph_node12"><a xlink:href=".././proc/allocate_3d_fields_arrays.html" xlink:title="ALLOCATE_3D_FIELDS_ARRAYS">
<polygon fill="#d9534f" stroke="#d9534f" points="294,-45 116,-45 116,-21 294,-21 294,-45"/>
<text text-anchor="middle" x="205" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ALLOCATE_3D_FIELDS_ARRAYS</text>
</a>
</g>
</g>
<!-- proc~initialize_fields&#45;&gt;proc~allocate_3d_fields_arrays -->
<g id="proc~~initialize_fields~~CallsGraph_edge11" class="edge">
<title>proc~initialize_fields&#45;&gt;proc~allocate_3d_fields_arrays</title>
<path fill="none" stroke="#000000" d="M41.3998,-240.9133C45.8678,-207.8101 62.7725,-114.7749 116,-64 122.3654,-57.9279 129.9828,-53.039 138.0454,-49.1041"/>
<polygon fill="#000000" stroke="#000000" points="139.5379,-52.2715 147.2947,-45.0546 136.7304,-45.8591 139.5379,-52.2715"/>
</g>
<!-- h5fclose_f -->
<g id="proc~~initialize_fields~~CallsGraph_node14" class="node">
<title>h5fclose_f</title>
<polygon fill="#777777" stroke="#777777" points="427.5,-265 367.5,-265 367.5,-241 427.5,-241 427.5,-265"/>
<text text-anchor="middle" x="397.5" y="-250.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">h5fclose_f</text>
</g>
<!-- proc~which_fields_in_file&#45;&gt;h5fclose_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge12" class="edge">
<title>proc~which_fields_in_file&#45;&gt;h5fclose_f</title>
<path fill="none" stroke="#000000" d="M256.5808,-330.5799C269.4333,-327.4697 282.7454,-322.853 294,-316 314.9989,-303.2136 309.4608,-287.5124 330,-274 338.2945,-268.5432 348.0874,-264.4381 357.6034,-261.3754"/>
<polygon fill="#000000" stroke="#000000" points="358.7172,-264.6966 367.3454,-258.548 356.7661,-257.974 358.7172,-264.6966"/>
</g>
<!-- h5fopen_f -->
<g id="proc~~initialize_fields~~CallsGraph_node17" class="node">
<title>h5fopen_f</title>
<polygon fill="#777777" stroke="#777777" points="427,-307 368,-307 368,-283 427,-283 427,-307"/>
<text text-anchor="middle" x="397.5" y="-292.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">h5fopen_f</text>
</g>
<!-- proc~which_fields_in_file&#45;&gt;h5fopen_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge13" class="edge">
<title>proc~which_fields_in_file&#45;&gt;h5fopen_f</title>
<path fill="none" stroke="#000000" d="M256.5865,-325.7448C288.4658,-318.7893 328.7445,-310.0012 358.0661,-303.6038"/>
<polygon fill="#000000" stroke="#000000" points="358.9248,-306.9988 367.9489,-301.4475 357.4326,-300.1597 358.9248,-306.9988"/>
</g>
<!-- proc~allocate_v_field_2d -->
<g id="proc~~initialize_fields~~CallsGraph_node21" class="node">
<title>proc~allocate_v_field_2d</title>
<g id="a_proc~~initialize_fields~~CallsGraph_node21"><a xlink:href=".././proc/allocate_v_field_2d.html" xlink:title="ALLOCATE_V_FIELD_2D">
<polygon fill="#d9534f" stroke="#d9534f" points="465,-475 330,-475 330,-451 465,-451 465,-475"/>
<text text-anchor="middle" x="397.5" y="-460.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ALLOCATE_V_FIELD_2D</text>
</a>
</g>
</g>
<!-- proc~allocate_2d_fields_arrays&#45;&gt;proc~allocate_v_field_2d -->
<g id="proc~~initialize_fields~~CallsGraph_edge14" class="edge">
<title>proc~allocate_2d_fields_arrays&#45;&gt;proc~allocate_v_field_2d</title>
<path fill="none" stroke="#000000" d="M294.206,-463C302.7363,-463 311.3406,-463 319.7493,-463"/>
<polygon fill="#000000" stroke="#000000" points="319.8908,-466.5001 329.8908,-463 319.8907,-459.5001 319.8908,-466.5001"/>
</g>
<!-- mpi_bcast -->
<g id="proc~~initialize_fields~~CallsGraph_node13" class="node">
<title>mpi_bcast</title>
<polygon fill="#777777" stroke="#777777" points="427.5,-433 367.5,-433 367.5,-409 427.5,-409 427.5,-433"/>
<text text-anchor="middle" x="397.5" y="-418.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_bcast</text>
</g>
<!-- proc~load_prev_iter&#45;&gt;mpi_bcast -->
<g id="proc~~initialize_fields~~CallsGraph_edge15" class="edge">
<title>proc~load_prev_iter&#45;&gt;mpi_bcast</title>
<path fill="none" stroke="#000000" d="M244.8861,-421C277.778,-421 324.2292,-421 357.2269,-421"/>
<polygon fill="#000000" stroke="#000000" points="357.4335,-424.5001 367.4334,-421 357.4334,-417.5001 357.4335,-424.5001"/>
</g>
<!-- proc~load_prev_iter&#45;&gt;h5fclose_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge16" class="edge">
<title>proc~load_prev_iter&#45;&gt;h5fclose_f</title>
<path fill="none" stroke="#000000" d="M244.6873,-420.3184C261.8271,-418.027 280.908,-412.4959 294,-400 336.1305,-359.7878 289.3004,-315.6599 330,-274 337.3328,-266.4942 347.2969,-261.6595 357.3166,-258.5491"/>
<polygon fill="#000000" stroke="#000000" points="358.4541,-261.8701 367.2596,-255.9783 356.7018,-255.093 358.4541,-261.8701"/>
</g>
<!-- proc~load_prev_iter&#45;&gt;h5fopen_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge18" class="edge">
<title>proc~load_prev_iter&#45;&gt;h5fopen_f</title>
<path fill="none" stroke="#000000" d="M244.8589,-416.484C260.8788,-413.4528 279.0542,-408.4024 294,-400 331.9551,-378.662 365.1687,-339.3194 383.1833,-315.3216"/>
<polygon fill="#000000" stroke="#000000" points="386.0213,-317.3701 389.1131,-307.2364 380.3767,-313.2302 386.0213,-317.3701"/>
</g>
<!-- interface~load_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_node20" class="node">
<title>interface~load_from_hdf5</title>
<g id="a_proc~~initialize_fields~~CallsGraph_node20"><a xlink:href=".././interface/load_from_hdf5.html" xlink:title="load_from_hdf5">
<polygon fill="#a7506f" stroke="#a7506f" points="440,-223 355,-223 355,-199 440,-199 440,-223"/>
<text text-anchor="middle" x="397.5" y="-208.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">load_from_hdf5</text>
</a>
</g>
</g>
<!-- proc~load_prev_iter&#45;&gt;interface~load_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_edge17" class="edge">
<title>proc~load_prev_iter&#45;&gt;interface~load_from_hdf5</title>
<path fill="none" stroke="#000000" d="M244.6289,-420.7753C261.9666,-418.6044 281.2241,-413.0421 294,-400 347.4362,-345.4502 278.5026,-288.3838 330,-232 334.2909,-227.3019 339.6122,-223.6455 345.3705,-220.8014"/>
<polygon fill="#000000" stroke="#000000" points="346.7762,-224.0079 354.6939,-216.9679 344.1142,-217.5338 346.7762,-224.0079"/>
</g>
<!-- proc~allocate_1d_fs_arrays&#45;&gt;h5fclose_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge19" class="edge">
<title>proc~allocate_1d_fs_arrays&#45;&gt;h5fclose_f</title>
<path fill="none" stroke="#000000" d="M266.3838,-178.082C276.0378,-181.0096 285.593,-184.8809 294,-190 314.9989,-202.7864 309.4608,-218.4876 330,-232 338.2945,-237.4568 348.0874,-241.5619 357.6034,-244.6246"/>
<polygon fill="#000000" stroke="#000000" points="356.7661,-248.026 367.3454,-247.452 358.7172,-241.3034 356.7661,-248.026"/>
</g>
<!-- proc~allocate_1d_fs_arrays&#45;&gt;h5fopen_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge21" class="edge">
<title>proc~allocate_1d_fs_arrays&#45;&gt;h5fopen_f</title>
<path fill="none" stroke="#000000" d="M266.0469,-175.3933C276.1767,-178.5987 285.978,-183.2595 294,-190 325.097,-216.1295 299.835,-246.7998 330,-274 337.7929,-281.027 347.9097,-285.7026 357.9289,-288.8137"/>
<polygon fill="#000000" stroke="#000000" points="357.2632,-292.2579 367.8258,-291.4324 359.0538,-285.4908 357.2632,-292.2579"/>
</g>
<!-- proc~allocate_1d_fs_arrays&#45;&gt;interface~load_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_edge20" class="edge">
<title>proc~allocate_1d_fs_arrays&#45;&gt;interface~load_from_hdf5</title>
<path fill="none" stroke="#000000" d="M260.1628,-181.0355C286.8603,-186.8604 318.7498,-193.8181 345.0769,-199.5622"/>
<polygon fill="#000000" stroke="#000000" points="344.356,-202.9872 354.8723,-201.6994 345.8482,-196.1481 344.356,-202.9872"/>
</g>
<!-- proc~load_1d_fs_from_hdf5&#45;&gt;h5fclose_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge22" class="edge">
<title>proc~load_1d_fs_from_hdf5&#45;&gt;h5fclose_f</title>
<path fill="none" stroke="#000000" d="M267.2334,-253C296.6797,-253 331.0008,-253 357.0202,-253"/>
<polygon fill="#000000" stroke="#000000" points="357.2677,-256.5001 367.2677,-253 357.2676,-249.5001 357.2677,-256.5001"/>
</g>
<!-- proc~load_1d_fs_from_hdf5&#45;&gt;h5fopen_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge24" class="edge">
<title>proc~load_1d_fs_from_hdf5&#45;&gt;h5fopen_f</title>
<path fill="none" stroke="#000000" d="M260.1628,-265.0355C291.4306,-271.8576 329.8202,-280.2335 358.0546,-286.3937"/>
<polygon fill="#000000" stroke="#000000" points="357.449,-289.8439 367.9653,-288.5561 358.9412,-283.0048 357.449,-289.8439"/>
</g>
<!-- interface~load_array_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_node18" class="node">
<title>interface~load_array_from_hdf5</title>
<g id="a_proc~~initialize_fields~~CallsGraph_node18"><a xlink:href=".././interface/load_array_from_hdf5.html" xlink:title="load_array_from_hdf5">
<polygon fill="#a7506f" stroke="#a7506f" points="455,-150 340,-150 340,-126 455,-126 455,-150"/>
<text text-anchor="middle" x="397.5" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">load_array_from_hdf5</text>
</a>
</g>
</g>
<!-- proc~load_1d_fs_from_hdf5&#45;&gt;interface~load_array_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_edge23" class="edge">
<title>proc~load_1d_fs_from_hdf5&#45;&gt;interface~load_array_from_hdf5</title>
<path fill="none" stroke="#000000" d="M267.3177,-243.6317C276.6531,-240.7393 285.8642,-236.954 294,-232 314.9989,-219.2136 312.1676,-206.9248 330,-190 342.8152,-177.837 358.3653,-165.7045 371.3089,-156.2215"/>
<polygon fill="#000000" stroke="#000000" points="373.7207,-158.7976 379.7877,-150.1118 369.6284,-153.1184 373.7207,-158.7976"/>
</g>
<!-- proc~load_dim_data_from_hdf5&#45;&gt;h5fclose_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge25" class="edge">
<title>proc~load_dim_data_from_hdf5&#45;&gt;h5fclose_f</title>
<path fill="none" stroke="#000000" d="M260.1628,-282.9645C291.2327,-276.1856 329.3346,-267.8725 357.5173,-261.7235"/>
<polygon fill="#000000" stroke="#000000" points="358.3962,-265.1142 367.4202,-259.5629 356.904,-258.2751 358.3962,-265.1142"/>
</g>
<!-- proc~load_dim_data_from_hdf5&#45;&gt;h5fopen_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge27" class="edge">
<title>proc~load_dim_data_from_hdf5&#45;&gt;h5fopen_f</title>
<path fill="none" stroke="#000000" d="M272.5976,-295C301.1301,-295 333.3587,-295 357.9309,-295"/>
<polygon fill="#000000" stroke="#000000" points="357.96,-298.5001 367.9599,-295 357.9599,-291.5001 357.96,-298.5001"/>
</g>
<!-- proc~load_dim_data_from_hdf5&#45;&gt;interface~load_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_edge26" class="edge">
<title>proc~load_dim_data_from_hdf5&#45;&gt;interface~load_from_hdf5</title>
<path fill="none" stroke="#000000" d="M272.8964,-283.7869C280.2945,-281.1784 287.4913,-277.9632 294,-274 314.9989,-261.2136 309.4608,-245.5124 330,-232 334.6779,-228.9225 339.8324,-226.2749 345.1451,-224.0018"/>
<polygon fill="#000000" stroke="#000000" points="346.7217,-227.146 354.8099,-220.3025 344.2194,-220.6085 346.7217,-227.146"/>
</g>
<!-- mpi_barrier -->
<g id="proc~~initialize_fields~~CallsGraph_node15" class="node">
<title>mpi_barrier</title>
<polygon fill="#777777" stroke="#777777" points="430.5,-66 364.5,-66 364.5,-42 430.5,-42 430.5,-66"/>
<text text-anchor="middle" x="397.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_barrier</text>
</g>
<!-- proc~korc_abort&#45;&gt;mpi_barrier -->
<g id="proc~~initialize_fields~~CallsGraph_edge28" class="edge">
<title>proc~korc_abort&#45;&gt;mpi_barrier</title>
<path fill="none" stroke="#000000" d="M236.3569,-79.9503C268.3556,-74.7973 318.2657,-66.7598 354.061,-60.9954"/>
<polygon fill="#000000" stroke="#000000" points="354.9017,-64.4052 364.218,-59.3597 353.7887,-57.4942 354.9017,-64.4052"/>
</g>
<!-- mpi_abort -->
<g id="proc~~initialize_fields~~CallsGraph_node16" class="node">
<title>mpi_abort</title>
<polygon fill="#777777" stroke="#777777" points="427,-108 368,-108 368,-84 427,-84 427,-108"/>
<text text-anchor="middle" x="397.5" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_abort</text>
</g>
<!-- proc~korc_abort&#45;&gt;mpi_abort -->
<g id="proc~~initialize_fields~~CallsGraph_edge29" class="edge">
<title>proc~korc_abort&#45;&gt;mpi_abort</title>
<path fill="none" stroke="#000000" d="M236.3569,-86.7918C269.4222,-88.6813 321.6129,-91.6636 357.5923,-93.7196"/>
<polygon fill="#000000" stroke="#000000" points="357.5559,-97.2231 367.7393,-94.2994 357.9553,-90.2345 357.5559,-97.2231"/>
</g>
<!-- proc~load_field_data_from_hdf5&#45;&gt;h5fclose_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge30" class="edge">
<title>proc~load_field_data_from_hdf5&#45;&gt;h5fclose_f</title>
<path fill="none" stroke="#000000" d="M273.7843,-136.1705C281.1078,-139.1377 288.0443,-142.9957 294,-148 325.097,-174.1295 299.835,-204.7998 330,-232 337.7245,-238.9653 347.7324,-243.6204 357.6652,-246.7315"/>
<polygon fill="#000000" stroke="#000000" points="356.921,-250.1553 367.4856,-249.3562 358.7285,-243.3927 356.921,-250.1553"/>
</g>
<!-- proc~load_field_data_from_hdf5&#45;&gt;h5fopen_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge33" class="edge">
<title>proc~load_field_data_from_hdf5&#45;&gt;h5fopen_f</title>
<path fill="none" stroke="#000000" d="M273.5433,-135.0774C281.0875,-138.2134 288.1431,-142.4097 294,-148 336.1305,-188.2122 289.3004,-232.3401 330,-274 337.5392,-281.7171 347.8598,-286.6105 358.1627,-289.7095"/>
<polygon fill="#000000" stroke="#000000" points="357.3927,-293.1247 367.9439,-292.1644 359.0968,-286.3353 357.3927,-293.1247"/>
</g>
<!-- proc~load_field_data_from_hdf5&#45;&gt;interface~load_array_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_edge31" class="edge">
<title>proc~load_field_data_from_hdf5&#45;&gt;interface~load_array_from_hdf5</title>
<path fill="none" stroke="#000000" d="M273.6816,-130.9247C291.9088,-131.9662 311.5764,-133.0901 329.7534,-134.1288"/>
<polygon fill="#000000" stroke="#000000" points="329.7859,-137.6362 339.9693,-134.7125 330.1853,-130.6476 329.7859,-137.6362"/>
</g>
<!-- proc~load_field_data_from_hdf5&#45;&gt;interface~load_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_edge32" class="edge">
<title>proc~load_field_data_from_hdf5&#45;&gt;interface~load_from_hdf5</title>
<path fill="none" stroke="#000000" d="M267.551,-139.115C276.5716,-141.6199 285.6278,-144.5659 294,-148 322.6512,-159.7522 352.5768,-178.8216 372.8364,-192.9062"/>
<polygon fill="#000000" stroke="#000000" points="370.9743,-195.8761 381.16,-198.7916 375.0156,-190.1605 370.9743,-195.8761"/>
</g>
<!-- proc~allocate_v_field_3d -->
<g id="proc~~initialize_fields~~CallsGraph_node19" class="node">
<title>proc~allocate_v_field_3d</title>
<g id="a_proc~~initialize_fields~~CallsGraph_node19"><a xlink:href=".././proc/allocate_v_field_3d.html" xlink:title="ALLOCATE_V_FIELD_3D">
<polygon fill="#d9534f" stroke="#d9534f" points="465,-24 330,-24 330,0 465,0 465,-24"/>
<text text-anchor="middle" x="397.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ALLOCATE_V_FIELD_3D</text>
</a>
</g>
</g>
<!-- proc~allocate_3d_fields_arrays&#45;&gt;proc~allocate_v_field_3d -->
<g id="proc~~initialize_fields~~CallsGraph_edge34" class="edge">
<title>proc~allocate_3d_fields_arrays&#45;&gt;proc~allocate_v_field_3d</title>
<path fill="none" stroke="#000000" d="M294.206,-23.2684C302.7363,-22.3379 311.3406,-21.3992 319.7493,-20.4819"/>
<polygon fill="#000000" stroke="#000000" points="320.3293,-23.9395 329.8908,-19.3756 319.5701,-16.9808 320.3293,-23.9395"/>
</g>
<!-- proc~rload_3d_array_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_node22" class="node">
<title>proc~rload_3d_array_from_hdf5</title>
<g id="a_proc~~initialize_fields~~CallsGraph_node22"><a xlink:href=".././proc/rload_3d_array_from_hdf5.html" xlink:title="rload_3d_array_from_hdf5">
<polygon fill="#d9534f" stroke="#d9534f" points="637,-181 501,-181 501,-157 637,-157 637,-181"/>
<text text-anchor="middle" x="569" y="-166.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">rload_3d_array_from_hdf5</text>
</a>
</g>
</g>
<!-- interface~load_array_from_hdf5&#45;&gt;proc~rload_3d_array_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_edge35" class="edge">
<title>interface~load_array_from_hdf5&#45;&gt;proc~rload_3d_array_from_hdf5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M455.0841,-148.4088C467.0623,-150.5739 479.8654,-152.8882 492.4044,-155.1547"/>
<polygon fill="#000000" stroke="#000000" points="491.9198,-158.6238 502.3829,-156.9584 493.165,-151.7354 491.9198,-158.6238"/>
</g>
<!-- proc~rload_1d_array_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_node23" class="node">
<title>proc~rload_1d_array_from_hdf5</title>
<g id="a_proc~~initialize_fields~~CallsGraph_node23"><a xlink:href=".././proc/rload_1d_array_from_hdf5.html" xlink:title="rload_1d_array_from_hdf5">
<polygon fill="#d9534f" stroke="#d9534f" points="637,-139 501,-139 501,-115 637,-115 637,-139"/>
<text text-anchor="middle" x="569" y="-124.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">rload_1d_array_from_hdf5</text>
</a>
</g>
</g>
<!-- interface~load_array_from_hdf5&#45;&gt;proc~rload_1d_array_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_edge36" class="edge">
<title>interface~load_array_from_hdf5&#45;&gt;proc~rload_1d_array_from_hdf5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M455.0841,-134.3066C466.5636,-133.5703 478.8007,-132.7854 490.8369,-132.0134"/>
<polygon fill="#000000" stroke="#000000" points="491.1235,-135.5023 500.879,-131.3693 490.6754,-128.5166 491.1235,-135.5023"/>
</g>
<!-- proc~rload_2d_array_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_node24" class="node">
<title>proc~rload_2d_array_from_hdf5</title>
<g id="a_proc~~initialize_fields~~CallsGraph_node24"><a xlink:href=".././proc/rload_2d_array_from_hdf5.html" xlink:title="rload_2d_array_from_hdf5">
<polygon fill="#d9534f" stroke="#d9534f" points="637,-97 501,-97 501,-73 637,-73 637,-97"/>
<text text-anchor="middle" x="569" y="-82.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">rload_2d_array_from_hdf5</text>
</a>
</g>
</g>
<!-- interface~load_array_from_hdf5&#45;&gt;proc~rload_2d_array_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_edge37" class="edge">
<title>interface~load_array_from_hdf5&#45;&gt;proc~rload_2d_array_from_hdf5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M436.3265,-125.9924C455.7483,-119.9868 479.6161,-112.6076 501,-106 507.1201,-104.1089 513.5503,-102.1224 519.9138,-100.1569"/>
<polygon fill="#000000" stroke="#000000" points="521.283,-103.3972 529.8048,-97.102 519.2173,-96.709 521.283,-103.3972"/>
</g>
<!-- proc~rload_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_node25" class="node">
<title>proc~rload_from_hdf5</title>
<g id="a_proc~~initialize_fields~~CallsGraph_node25"><a xlink:href=".././proc/rload_from_hdf5.html" xlink:title="rload_from_hdf5">
<polygon fill="#d9534f" stroke="#d9534f" points="613.5,-223 524.5,-223 524.5,-199 613.5,-199 613.5,-223"/>
<text text-anchor="middle" x="569" y="-208.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">rload_from_hdf5</text>
</a>
</g>
</g>
<!-- interface~load_from_hdf5&#45;&gt;proc~rload_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_edge39" class="edge">
<title>interface~load_from_hdf5&#45;&gt;proc~rload_from_hdf5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M440.3343,-211C462.7317,-211 490.3919,-211 514.3199,-211"/>
<polygon fill="#000000" stroke="#000000" points="514.32,-214.5001 524.32,-211 514.3199,-207.5001 514.32,-214.5001"/>
</g>
<!-- proc~iload_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_node26" class="node">
<title>proc~iload_from_hdf5</title>
<g id="a_proc~~initialize_fields~~CallsGraph_node26"><a xlink:href=".././proc/iload_from_hdf5.html" xlink:title="iload_from_hdf5">
<polygon fill="#d9534f" stroke="#d9534f" points="613,-265 525,-265 525,-241 613,-241 613,-265"/>
<text text-anchor="middle" x="569" y="-250.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">iload_from_hdf5</text>
</a>
</g>
</g>
<!-- interface~load_from_hdf5&#45;&gt;proc~iload_from_hdf5 -->
<g id="proc~~initialize_fields~~CallsGraph_edge38" class="edge">
<title>interface~load_from_hdf5&#45;&gt;proc~iload_from_hdf5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M440.3343,-221.49C463.006,-227.0423 491.0705,-233.9152 515.1976,-239.8239"/>
<polygon fill="#000000" stroke="#000000" points="514.376,-243.226 524.9215,-242.2053 516.0411,-236.427 514.376,-243.226"/>
</g>
<!-- h5dclose_f -->
<g id="proc~~initialize_fields~~CallsGraph_node27" class="node">
<title>h5dclose_f</title>
<polygon fill="#777777" stroke="#777777" points="736,-202 673,-202 673,-178 736,-178 736,-202"/>
<text text-anchor="middle" x="704.5" y="-187.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">h5dclose_f</text>
</g>
<!-- proc~rload_3d_array_from_hdf5&#45;&gt;h5dclose_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge40" class="edge">
<title>proc~rload_3d_array_from_hdf5&#45;&gt;h5dclose_f</title>
<path fill="none" stroke="#000000" d="M637.147,-179.5615C645.9512,-180.926 654.7464,-182.2891 662.938,-183.5587"/>
<polygon fill="#000000" stroke="#000000" points="662.5282,-187.0369 672.9463,-185.1098 663.6004,-180.1194 662.5282,-187.0369"/>
</g>
<!-- h5dread_f -->
<g id="proc~~initialize_fields~~CallsGraph_node28" class="node">
<title>h5dread_f</title>
<polygon fill="#777777" stroke="#777777" points="734.5,-160 674.5,-160 674.5,-136 734.5,-136 734.5,-160"/>
<text text-anchor="middle" x="704.5" y="-145.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">h5dread_f</text>
</g>
<!-- proc~rload_3d_array_from_hdf5&#45;&gt;h5dread_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge41" class="edge">
<title>proc~rload_3d_array_from_hdf5&#45;&gt;h5dread_f</title>
<path fill="none" stroke="#000000" d="M637.147,-158.4385C646.4238,-157.0007 655.6907,-155.5645 664.2519,-154.2377"/>
<polygon fill="#000000" stroke="#000000" points="664.952,-157.6711 674.298,-152.6808 663.8799,-150.7537 664.952,-157.6711"/>
</g>
<!-- proc~rload_1d_array_from_hdf5&#45;&gt;h5dclose_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge42" class="edge">
<title>proc~rload_1d_array_from_hdf5&#45;&gt;h5dclose_f</title>
<path fill="none" stroke="#000000" d="M613.8729,-139.0586C621.7134,-141.6714 629.6934,-144.6662 637,-148 645.1874,-151.7358 662.5489,-162.564 677.6134,-172.2896"/>
<polygon fill="#000000" stroke="#000000" points="675.8392,-175.3107 686.131,-177.8264 679.6543,-169.4417 675.8392,-175.3107"/>
</g>
<!-- proc~rload_1d_array_from_hdf5&#45;&gt;h5dread_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge43" class="edge">
<title>proc~rload_1d_array_from_hdf5&#45;&gt;h5dread_f</title>
<path fill="none" stroke="#000000" d="M637.147,-137.5615C646.4238,-138.9993 655.6907,-140.4355 664.2519,-141.7623"/>
<polygon fill="#000000" stroke="#000000" points="663.8799,-145.2463 674.298,-143.3192 664.952,-138.3289 663.8799,-145.2463"/>
</g>
<!-- proc~rload_2d_array_from_hdf5&#45;&gt;h5dclose_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge44" class="edge">
<title>proc~rload_2d_array_from_hdf5&#45;&gt;h5dclose_f</title>
<path fill="none" stroke="#000000" d="M622.249,-97.0343C627.528,-99.4907 632.5649,-102.4457 637,-106 662.1651,-126.1672 650.9949,-145.4251 673,-169 673.7624,-169.8168 674.5625,-170.6177 675.3918,-171.4013"/>
<polygon fill="#000000" stroke="#000000" points="673.4579,-174.3403 683.421,-177.9441 677.8798,-168.9138 673.4579,-174.3403"/>
</g>
<!-- proc~rload_2d_array_from_hdf5&#45;&gt;h5dread_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge45" class="edge">
<title>proc~rload_2d_array_from_hdf5&#45;&gt;h5dread_f</title>
<path fill="none" stroke="#000000" d="M613.8729,-97.0586C621.7134,-99.6714 629.6934,-102.6662 637,-106 651.6512,-112.6851 666.969,-122.0012 679.3023,-130.1613"/>
<polygon fill="#000000" stroke="#000000" points="677.4593,-133.1401 687.7032,-135.8446 681.3817,-127.3422 677.4593,-133.1401"/>
</g>
<!-- proc~rload_from_hdf5&#45;&gt;h5dclose_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge46" class="edge">
<title>proc~rload_from_hdf5&#45;&gt;h5dclose_f</title>
<path fill="none" stroke="#000000" d="M613.7433,-204.0656C629.4014,-201.6389 646.92,-198.9238 662.3584,-196.5312"/>
<polygon fill="#000000" stroke="#000000" points="663.3198,-199.924 672.6657,-194.9337 662.2476,-193.0066 663.3198,-199.924"/>
</g>
<!-- proc~rload_from_hdf5&#45;&gt;h5dread_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge47" class="edge">
<title>proc~rload_from_hdf5&#45;&gt;h5dread_f</title>
<path fill="none" stroke="#000000" d="M613.5112,-199.0618C621.4677,-196.4206 629.581,-193.3851 637,-190 645.1874,-186.2642 662.5489,-175.436 677.6134,-165.7104"/>
<polygon fill="#000000" stroke="#000000" points="679.6543,-168.5583 686.131,-160.1736 675.8392,-162.6893 679.6543,-168.5583"/>
</g>
<!-- proc~iload_from_hdf5&#45;&gt;h5dclose_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge48" class="edge">
<title>proc~iload_from_hdf5&#45;&gt;h5dclose_f</title>
<path fill="none" stroke="#000000" d="M613.1496,-241.1815C621.2217,-238.5125 629.4686,-235.4364 637,-232 651.6512,-225.3149 666.969,-215.9988 679.3023,-207.8387"/>
<polygon fill="#000000" stroke="#000000" points="681.3817,-210.6578 687.7032,-202.1554 677.4593,-204.8599 681.3817,-210.6578"/>
</g>
<!-- proc~iload_from_hdf5&#45;&gt;h5dread_f -->
<g id="proc~~initialize_fields~~CallsGraph_edge49" class="edge">
<title>proc~iload_from_hdf5&#45;&gt;h5dread_f</title>
<path fill="none" stroke="#000000" d="M613.1302,-244.671C621.642,-241.6583 630.058,-237.5633 637,-232 662.1651,-211.8328 650.9949,-192.5749 673,-169 673.7624,-168.1832 674.5625,-167.3823 675.3918,-166.5987"/>
<polygon fill="#000000" stroke="#000000" points="677.8798,-169.0862 683.421,-160.0559 673.4579,-163.6597 677.8798,-169.0862"/>
</g>
</g>
</svg>
</div><script>var panprocinitialize_fieldsCallsGraph = svgPanZoom('#procinitialize_fieldsCallsGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="554pt" height="32pt"
 viewBox="0.00 0.00 553.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 549.5,-28 549.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="63,-24 0,-24 0,0 63,0 63,-24"/>
<text text-anchor="middle" x="31.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="135.5,-24 81.5,-24 81.5,0 135.5,0 135.5,-24"/>
<text text-anchor="middle" x="108.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="207.5,-24 153.5,-24 153.5,0 207.5,0 207.5,-24"/>
<text text-anchor="middle" x="180.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Interface</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node4" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="359.5,-24 225.5,-24 225.5,0 359.5,0 359.5,-24"/>
<text text-anchor="middle" x="292.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node5" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="431.5,-24 377.5,-24 377.5,0 431.5,0 431.5,-24"/>
<text text-anchor="middle" x="404.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="545.5,-24 449.5,-24 449.5,0 545.5,0 545.5,-24"/>
<text text-anchor="middle" x="497.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a procedure to one which it calls. Dashed 
    arrows point from an interface to procedures which implement that interface.
    This could include the module procedures in a generic interface or the
    implementation in a submodule of an interface in a parent module.
    </p>
    </div></div></div></div>
      </div>
    </div>
     
     
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Called by</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: proc~~initialize_fields~~CalledByGraph Pages: 1 -->
<svg id="procinitialize_fieldsCalledByGraph" width="178pt" height="32pt"
 viewBox="0.00 0.00 178.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~initialize_fields~~CalledByGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>proc~~initialize_fields~~CalledByGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 174,-28 174,4 -4,4"/>
<!-- proc~initialize_fields -->
<g id="proc~~initialize_fields~~CalledByGraph_node1" class="node">
<title>proc~initialize_fields</title>
<polygon fill="none" stroke="#000000" points="170,-24 90,-24 90,0 170,0 170,-24"/>
<text text-anchor="middle" x="130" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">initialize_fields</text>
</g>
<!-- program~main -->
<g id="proc~~initialize_fields~~CalledByGraph_node2" class="node">
<title>program~main</title>
<g id="a_proc~~initialize_fields~~CalledByGraph_node2"><a xlink:href=".././program/main.html" xlink:title="main">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="54,-24 0,-24 0,0 54,0 54,-24"/>
<text text-anchor="middle" x="27" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">main</text>
</a>
</g>
</g>
<!-- program~main&#45;&gt;proc~initialize_fields -->
<g id="proc~~initialize_fields~~CalledByGraph_edge1" class="edge">
<title>program~main&#45;&gt;proc~initialize_fields</title>
<path fill="none" stroke="#000000" d="M54.062,-12C61.9446,-12 70.8216,-12 79.6533,-12"/>
<polygon fill="#000000" stroke="#000000" points="79.9379,-15.5001 89.9379,-12 79.9379,-8.5001 79.9379,-15.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="554pt" height="32pt"
 viewBox="0.00 0.00 553.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 549.5,-28 549.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="63,-24 0,-24 0,0 63,0 63,-24"/>
<text text-anchor="middle" x="31.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="135.5,-24 81.5,-24 81.5,0 135.5,0 135.5,-24"/>
<text text-anchor="middle" x="108.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="207.5,-24 153.5,-24 153.5,0 207.5,0 207.5,-24"/>
<text text-anchor="middle" x="180.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Interface</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node4" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="359.5,-24 225.5,-24 225.5,0 359.5,0 359.5,-24"/>
<text text-anchor="middle" x="292.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node5" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="431.5,-24 377.5,-24 377.5,0 431.5,0 431.5,-24"/>
<text text-anchor="middle" x="404.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="545.5,-24 449.5,-24 449.5,0 545.5,0 545.5,-24"/>
<text text-anchor="middle" x="497.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a procedure to one which it calls. Dashed 
    arrows point from an interface to procedures which implement that interface.
    This could include the module procedures in a generic interface or the
    implementation in a submodule of an interface in a parent module.
    </p>
    </div></div></div></div>
      </div>
    </div>
     
    <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/initialize_fields.html#src">initialize_fields</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    

    
    
    
    
    

    
    
    
    
    


    
    
    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span>  <span class="k">subroutine </span><span class="n">initialize_fields</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
    <span class="c">!! @note Subroutine that initializes the analytical or externally</span>
    <span class="c">!! calculated electric and magnetic fields. @endnote</span>
    <span class="c">!! In this subroutine we load the parameters of the electric and</span>
    <span class="c">!! magnetic fields from the namelists &#39;analytical_fields_params&#39; and</span>
    <span class="c">!! &#39;externalPlasmaModel&#39; in the input file.</span>
    <span class="k">TYPE</span><span class="p">(</span><span class="n">KORC_PARAMS</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">params</span>
    <span class="c">!! Core KORC simulation parameters.</span>
    <span class="k">TYPE</span><span class="p">(</span><span class="n">FIELDS</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">F</span>
    <span class="c">!! An instance of the KORC derived type FIELDS.</span>
    <span class="c">!REAL(rp)                       :: Bo</span>
    <span class="c">!! Magnetic field at magnetic axis for an &#39;ANALYTICAL&#39; magnetic field,</span>
    <span class="c">!! or the magnitude of the magnetic field for a &#39;UNFIROM&#39; plasma.</span>
    <span class="c">!REAL(rp)                       :: minor_radius</span>
    <span class="c">!! Plasma edge \(r_{edge}\) as measured from the magnetic axis.</span>
    <span class="c">!REAL(rp)                       :: major_radius</span>
    <span class="c">!! Radial position of the magnetic axis \(R_0\)</span>
    <span class="c">!REAL(rp)                       :: qa</span>
    <span class="c">!! Safety factor at the plasma edge.</span>
    <span class="c">!REAL(rp)                       :: qo</span>
    <span class="c">!! Safety factor at the magnetic axis \(q_0\).</span>
    <span class="c">!CHARACTER(MAX_STRING_LENGTH)   :: current_direction</span>
    <span class="c">!! String with information about the direction of the plasma current, </span>
    <span class="c">!! &#39;PARALLEL&#39;  or &#39;ANTI-PARALLEL&#39; to the toroidal magnetic field.</span>
    <span class="c">!CHARACTER(MAX_STRING_LENGTH)   :: E_model</span>
    <span class="c">!REAL(rp)                       :: Eo,E_dyn,E_pulse,E_width   </span>
    <span class="c">!! Electric field at the magnetic axis.</span>
    <span class="c">!LOGICAL                        :: Efield</span>
    <span class="c">!! Logical variable that specifies if the electric field is </span>
    <span class="c">!! going to be used on in a given simulation.</span>
    <span class="c">!LOGICAL                        :: dBfield</span>
    <span class="c">!LOGICAL                        :: Bfield</span>
    <span class="c">!! Logical variable that specifies if the magnetic field is </span>
    <span class="c">!! going to be used on in a given simulation.</span>
    <span class="c">!LOGICAL                        :: Bflux</span>
    <span class="c">!LOGICAL                        :: Bflux3D</span>
    <span class="c">!LOGICAL                        :: Dim2x1t</span>
    <span class="c">!LOGICAL                        :: E_2x1t,ReInterp_2x1t</span>
    <span class="c">!! Logical variable that specifies if the poloidal magnetic </span>
    <span class="c">!! flux is going to be used on in a given simulation.</span>
    <span class="c">!LOGICAL                        :: axisymmetric_fields</span>
    <span class="c">!! Logical variable that specifies if the plasma is axisymmetric.</span>
    <span class="kt">INTEGER</span>                        <span class="kd">::</span> <span class="n">ii</span>
    <span class="c">!! Iterators for creating mesh for GC model with analytic fields</span>
    <span class="kt">INTEGER</span>                        <span class="kd">::</span> <span class="n">kk</span>
    <span class="c">!! Iterators for creating mesh for GC model with analytic fields</span>
    <span class="c">!INTEGER                        :: nR</span>
    <span class="c">!! Number of mesh points in R for grid in GC model of analytical field</span>
    <span class="c">!INTEGER                        :: nZ,nPHI</span>
    <span class="c">!! Number of mesh points in Z for grid in GC model of analytical field</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">rm</span>
    <span class="c">!! Minor radius at each position in the grid for</span>
    <span class="c">!! GC model of analytical field</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">qr</span>
    <span class="c">!! Safety factor at each position in the grid for</span>
    <span class="c">!! GC model of analytical field</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">theta</span>
    <span class="c">!! Poloidal angle at each position in the grid for</span>
    <span class="c">!! GC model of analytical field</span>
    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">test</span>
    <span class="c">!integer :: res_double</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">RMAX</span><span class="p">,</span><span class="n">RMIN</span><span class="p">,</span><span class="n">ZMAX</span><span class="p">,</span><span class="n">ZMIN</span>
    <span class="c">!integer :: dim_1D,ind0_2x1t</span>
    <span class="c">!real(rp) :: dt_E_SC,Ip_exp,PSIp_lim,PSIp_0</span>
    <span class="c">!real(rp) :: t0_2x1t</span>
    

    <span class="c">!NAMELIST /analytical_fields_params/ Bo,minor_radius,major_radius,&amp;</span>
    <span class="c">!     qa,qo,Eo,current_direction,nR,nZ,nPHI,dim_1D,dt_E_SC,Ip_exp, &amp;</span>
    <span class="c">!     E_dyn,E_pulse,E_width</span>
    <span class="c">!NAMELIST /externalPlasmaModel/ Efield, Bfield, Bflux,Bflux3D,dBfield, &amp;</span>
    <span class="c">!     axisymmetric_fields, Eo,E_dyn,E_pulse,E_width,res_double, &amp;</span>
    <span class="c">!     dim_1D,dt_E_SC,Ip_exp,PSIp_lim,Dim2x1t,t0_2x1t,E_2x1t,ReInterp_2x1t, &amp;</span>
    <span class="c">!     ind0_2x1t,PSIp_0</span>

<span class="cp">#ifdef M3D_C1</span>
    <span class="n">F</span><span class="p">%</span><span class="n">M3D_C1_B</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">F</span><span class="p">%</span><span class="n">M3D_C1_E</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="cp">#endif</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">mpi_params</span><span class="p">%</span><span class="n">rank</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<span class="k">       write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(/,&quot;* * * * * * * * INITIALIZING FIELDS * * * * * * * *&quot;)&#39;</span><span class="p">)</span>
    <span class="k">end if</span>

<span class="c">!    SELECT CASE (TRIM(params%field_model))</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">field_model</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">10</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;ANALYTICAL&#39;</span><span class="p">)</span> <span class="k">then</span>
<span class="c">!    CASE(&#39;ANALYTICAL&#39;)</span>
       <span class="c">! Load the parameters of the analytical magnetic field</span>
       <span class="c">!open(unit=default_unit_open,file=TRIM(params%path_to_inputs), &amp;</span>
       <span class="c">!     status=&#39;OLD&#39;,form=&#39;formatted&#39;)</span>
       <span class="c">!read(default_unit_open,nml=analytical_fields_params)</span>
       <span class="c">!close(default_unit_open)</span>

       <span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">Bo</span> <span class="o">=</span> <span class="n">Bo</span>
       <span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">a</span> <span class="o">=</span> <span class="n">minor_radius</span>
       <span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">Ro</span> <span class="o">=</span> <span class="n">major_radius</span>
       <span class="n">F</span><span class="p">%</span><span class="n">Ro</span> <span class="o">=</span> <span class="n">major_radius</span>
       <span class="n">F</span><span class="p">%</span><span class="n">Zo</span> <span class="o">=</span> <span class="mf">0.0_rp</span>
       <span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">qa</span> <span class="o">=</span> <span class="n">qa</span>
       <span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">qo</span> <span class="o">=</span> <span class="n">qo</span>
       <span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">lambda</span> <span class="o">=</span> <span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">a</span><span class="o">/</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">qa</span><span class="o">/</span><span class="n">qo</span> <span class="o">-</span> <span class="mf">1.0_rp</span><span class="p">)</span>
       <span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">Bpo</span> <span class="o">=</span> <span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">lambda</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">Bo</span><span class="o">/</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">qo</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">Ro</span><span class="p">)</span>
       <span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">current_direction</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">current_direction</span><span class="p">)</span>
       <span class="k">SELECT CASE</span> <span class="p">(</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">current_direction</span><span class="p">))</span>
       <span class="k">CASE</span><span class="p">(</span><span class="s1">&#39;PARALLEL&#39;</span><span class="p">)</span>
          <span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">Bp_sign</span> <span class="o">=</span> <span class="mf">1.0_rp</span>
       <span class="k">CASE</span><span class="p">(</span><span class="s1">&#39;ANTI-PARALLEL&#39;</span><span class="p">)</span>
          <span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">Bp_sign</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0_rp</span>
       <span class="k">CASE </span><span class="n">DEFAULT</span>
       <span class="k">END SELECT</span>
<span class="k">       </span><span class="n">F</span><span class="p">%</span><span class="n">Eo</span> <span class="o">=</span> <span class="n">Eo</span>
       <span class="n">F</span><span class="p">%</span><span class="n">Bo</span> <span class="o">=</span> <span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">Bo</span>

       <span class="n">F</span><span class="p">%</span><span class="n">E_dyn</span> <span class="o">=</span> <span class="n">E_dyn</span>
       <span class="n">F</span><span class="p">%</span><span class="n">E_pulse</span> <span class="o">=</span> <span class="n">E_pulse</span>
       <span class="n">F</span><span class="p">%</span><span class="n">E_width</span> <span class="o">=</span> <span class="n">E_width</span>

       <span class="n">F</span><span class="p">%</span><span class="n">PSIp_lim</span><span class="o">=</span><span class="n">PSIp_lim</span>
       
       <span class="c">!write(output_unit_write,*) E_dyn,E_pulse,E_width</span>

       <span class="n">F</span><span class="p">%</span><span class="n">res_double</span><span class="o">=</span><span class="n">res_double</span>
       
       <span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">mpi_params</span><span class="p">%</span><span class="n">rank</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;ANALYTIC&quot;)&#39;</span><span class="p">)</span>
          <span class="k">write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;Magnetic field: &quot;,E17.10)&#39;</span><span class="p">)</span> <span class="n">F</span><span class="p">%</span><span class="n">Bo</span>
          <span class="k">write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;Electric field: &quot;,E17.10)&#39;</span><span class="p">)</span> <span class="n">F</span><span class="p">%</span><span class="n">Eo</span>

       <span class="k">end if</span>


<span class="k">       if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">field_eval</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;interp&#39;</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          </span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">nR</span>
          <span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">nPHI</span>
          <span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">nZ</span>

          <span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">field_model</span><span class="p">(</span><span class="mi">12</span><span class="p">:</span><span class="mi">14</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;PSI&#39;</span><span class="p">)</span> <span class="k">then</span>

<span class="k">             </span><span class="n">F</span><span class="p">%</span><span class="n">axisymmetric_fields</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
             <span class="n">F</span><span class="p">%</span><span class="n">Bfield</span><span class="o">=</span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
             <span class="n">F</span><span class="p">%</span><span class="n">Efield</span><span class="o">=</span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
             <span class="n">F</span><span class="p">%</span><span class="n">Bflux</span><span class="o">=</span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
             
             <span class="k">call </span><span class="n">ALLOCATE_2D_FIELDS_ARRAYS</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Bfield</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Bflux</span><span class="p">,</span> <span class="p">&amp;</span>
                  <span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="n">F</span><span class="p">%</span><span class="n">Efield</span><span class="p">)</span>

             <span class="k">do </span><span class="n">ii</span><span class="o">=</span><span class="mi">1_idef</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">Ro</span><span class="o">-</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">a</span><span class="o">/</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
             <span class="k">end do</span>
<span class="k">             do </span><span class="n">ii</span><span class="o">=</span><span class="mi">1_idef</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">Z</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">Zo</span><span class="o">-</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">a</span><span class="o">/</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
             <span class="k">end do</span>

             <span class="c">!write(6,*) F%X%R</span>
             <span class="c">!write(6,*) F%X%Z</span>
             
             <span class="k">do </span><span class="n">ii</span><span class="o">=</span><span class="mi">1_idef</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">do </span><span class="n">kk</span><span class="o">=</span><span class="mi">1_idef</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                   <span class="n">rm</span><span class="o">=</span><span class="nb">sqrt</span><span class="p">((</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="o">-</span><span class="n">F</span><span class="p">%</span><span class="n">Ro</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">Z</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">-</span><span class="n">F</span><span class="p">%</span><span class="n">Zo</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                   <span class="n">qr</span><span class="o">=</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">qo</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">rm</span><span class="o">/</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">lambda</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                   <span class="n">theta</span><span class="o">=</span><span class="n">atan2</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">Z</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">-</span><span class="n">F</span><span class="p">%</span><span class="n">Zo</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="o">-</span><span class="n">F</span><span class="p">%</span><span class="n">Ro</span><span class="p">)</span>
                   <span class="n">F</span><span class="p">%</span><span class="n">B_2D</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">kk</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">rm</span><span class="o">/</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">ii</span><span class="p">))</span><span class="o">*</span> <span class="p">&amp;</span>
                        <span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">Bo</span><span class="o">/</span><span class="n">qr</span><span class="p">)</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
                   <span class="n">F</span><span class="p">%</span><span class="n">B_2D</span><span class="p">%</span><span class="n">PHI</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">kk</span><span class="p">)</span><span class="o">=-</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">Ro</span><span class="o">/</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">ii</span><span class="p">))</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">Bo</span>
                   <span class="n">F</span><span class="p">%</span><span class="n">B_2D</span><span class="p">%</span><span class="n">Z</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">kk</span><span class="p">)</span><span class="o">=-</span><span class="p">(</span><span class="n">rm</span><span class="o">/</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">ii</span><span class="p">))</span><span class="o">*</span> <span class="p">&amp;</span>
                        <span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">Bo</span><span class="o">/</span><span class="n">qr</span><span class="p">)</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
                   <span class="n">F</span><span class="p">%</span><span class="n">E_2D</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">kk</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0_rp</span>
                   <span class="n">F</span><span class="p">%</span><span class="n">E_2D</span><span class="p">%</span><span class="n">PHI</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">kk</span><span class="p">)</span><span class="o">=-</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">Ro</span><span class="o">/</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">ii</span><span class="p">))</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">Eo</span>
                   <span class="n">F</span><span class="p">%</span><span class="n">E_2D</span><span class="p">%</span><span class="n">Z</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">kk</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0_rp</span>

                   <span class="n">F</span><span class="p">%</span><span class="n">PSIp</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">kk</span><span class="p">)</span><span class="o">=</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">lambda</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">Bo</span><span class="o">/</span> <span class="p">&amp;</span>
                        <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">qo</span><span class="o">*</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">Ro</span><span class="o">+</span><span class="n">rm</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)))</span><span class="o">*</span> <span class="p">&amp;</span>
                        <span class="nb">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">rm</span><span class="o">/</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">lambda</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

                   <span class="c">!! Sign convention in analytical fields corresponds to</span>
                   <span class="c">!! DIII-D fields with \(B_\phi&lt;0\) and \(B_\theta&lt;0\).</span>
                   <span class="n">F</span><span class="p">%</span><span class="n">FLAG2D</span><span class="o">=</span><span class="mf">1.</span>
                <span class="k">end do</span>
<span class="k">             end do</span>

<span class="k">             </span><span class="n">F</span><span class="p">%</span><span class="n">FLAG2D</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,:)</span><span class="o">=</span><span class="mf">0.</span>
             <span class="n">F</span><span class="p">%</span><span class="n">FLAG2D</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">),:)</span><span class="o">=</span><span class="mf">0.</span>
             <span class="n">F</span><span class="p">%</span><span class="n">FLAG2D</span><span class="p">(:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
             <span class="n">F</span><span class="p">%</span><span class="n">FLAG2D</span><span class="p">(:,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">=</span><span class="mf">0.</span>

             <span class="k">if</span> <span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">Bflux</span><span class="p">)</span> <span class="n">F</span><span class="p">%</span><span class="n">PSIP_min</span><span class="o">=</span><span class="nb">minval</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">PSIp</span><span class="p">)</span>  
             
             <span class="n">F</span><span class="p">%</span><span class="n">Bfield</span><span class="o">=</span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
             
          <span class="k">else if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">field_model</span><span class="p">(</span><span class="mi">12</span><span class="p">:</span><span class="mi">13</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;3D&#39;</span><span class="p">)</span> <span class="k">then</span>
<span class="k">             </span>
<span class="k">             </span><span class="n">F</span><span class="p">%</span><span class="n">axisymmetric_fields</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
             <span class="n">F</span><span class="p">%</span><span class="n">Bfield</span><span class="o">=</span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
             <span class="n">F</span><span class="p">%</span><span class="n">Efield</span><span class="o">=</span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
             
             <span class="k">call </span><span class="n">ALLOCATE_3D_FIELDS_ARRAYS</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Bfield</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Efield</span><span class="p">,.</span><span class="n">false</span><span class="p">.)</span>

             <span class="k">do </span><span class="n">ii</span><span class="o">=</span><span class="mi">1_idef</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">Ro</span><span class="o">-</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">a</span><span class="o">/</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
             <span class="k">end do</span>
<span class="k">             do </span><span class="n">ii</span><span class="o">=</span><span class="mi">1_idef</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">PHI</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="o">=</span><span class="mf">0._rp</span><span class="o">+</span><span class="p">(</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">C_PI</span><span class="o">/</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
             <span class="k">end do             </span>
<span class="k">             do </span><span class="n">ii</span><span class="o">=</span><span class="mi">1_idef</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">Z</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">Zo</span><span class="o">-</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">a</span><span class="o">/</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
             <span class="k">end do</span>

             <span class="c">!write(output_unit_write,*) size(F%B_3D%R)</span>
             
             <span class="k">do </span><span class="n">ii</span><span class="o">=</span><span class="mi">1_idef</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">do </span><span class="n">kk</span><span class="o">=</span><span class="mi">1_idef</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

                   <span class="c">!write(output_unit_write,*) ii,kk</span>
                   
                   <span class="n">rm</span><span class="o">=</span><span class="nb">sqrt</span><span class="p">((</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="o">-</span><span class="n">F</span><span class="p">%</span><span class="n">Ro</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">Z</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">-</span><span class="n">F</span><span class="p">%</span><span class="n">Zo</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                   <span class="n">qr</span><span class="o">=</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">qo</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">rm</span><span class="o">/</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">lambda</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                   <span class="n">theta</span><span class="o">=</span><span class="n">atan2</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">Z</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">-</span><span class="n">F</span><span class="p">%</span><span class="n">Zo</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="o">-</span><span class="n">F</span><span class="p">%</span><span class="n">Ro</span><span class="p">)</span>
                   <span class="n">F</span><span class="p">%</span><span class="n">B_3D</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">ii</span><span class="p">,:,</span><span class="n">kk</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">rm</span><span class="o">/</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">ii</span><span class="p">))</span><span class="o">*</span> <span class="p">&amp;</span>
                        <span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">Bo</span><span class="o">/</span><span class="n">qr</span><span class="p">)</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
                   <span class="n">F</span><span class="p">%</span><span class="n">B_3D</span><span class="p">%</span><span class="n">PHI</span><span class="p">(</span><span class="n">ii</span><span class="p">,:,</span><span class="n">kk</span><span class="p">)</span><span class="o">=-</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">Ro</span><span class="o">/</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">ii</span><span class="p">))</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">Bo</span>

                   <span class="c">!write(output_unit_write,*) F%B_3D%PHI(ii,1,kk)</span>
                   
                   <span class="n">F</span><span class="p">%</span><span class="n">B_3D</span><span class="p">%</span><span class="n">Z</span><span class="p">(</span><span class="n">ii</span><span class="p">,:,</span><span class="n">kk</span><span class="p">)</span><span class="o">=-</span><span class="p">(</span><span class="n">rm</span><span class="o">/</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">ii</span><span class="p">))</span><span class="o">*</span> <span class="p">&amp;</span>
                        <span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">Bo</span><span class="o">/</span><span class="n">qr</span><span class="p">)</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
                   <span class="n">F</span><span class="p">%</span><span class="n">E_3D</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">ii</span><span class="p">,:,</span><span class="n">kk</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0_rp</span>
                   <span class="n">F</span><span class="p">%</span><span class="n">E_3D</span><span class="p">%</span><span class="n">PHI</span><span class="p">(</span><span class="n">ii</span><span class="p">,:,</span><span class="n">kk</span><span class="p">)</span><span class="o">=-</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">Ro</span><span class="o">/</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">ii</span><span class="p">))</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">Eo</span>
                   <span class="n">F</span><span class="p">%</span><span class="n">E_3D</span><span class="p">%</span><span class="n">Z</span><span class="p">(</span><span class="n">ii</span><span class="p">,:,</span><span class="n">kk</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0_rp</span>


                   <span class="c">!! Sign convention in analytical fields corresponds to</span>
                   <span class="c">!! DIII-D fields with \(B_\phi&lt;0\) and \(B_\theta&lt;0\).</span>
                   <span class="n">F</span><span class="p">%</span><span class="n">FLAG3D</span><span class="o">=</span><span class="mf">1.</span>
                <span class="k">end do</span>
<span class="k">             end do</span>

<span class="k">             </span><span class="n">F</span><span class="p">%</span><span class="n">FLAG3D</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,:,:)</span><span class="o">=</span><span class="mf">0.</span>
             <span class="n">F</span><span class="p">%</span><span class="n">FLAG3D</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">),:,:)</span><span class="o">=</span><span class="mf">0.</span>
             <span class="n">F</span><span class="p">%</span><span class="n">FLAG3D</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
             <span class="n">F</span><span class="p">%</span><span class="n">FLAG3D</span><span class="p">(:,:,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">=</span><span class="mf">0.</span>



             
          <span class="k">end if</span>
<span class="k">         </span>

<span class="k">          if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">orbit_model</span><span class="p">(</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;pre&#39;</span><span class="p">)</span> <span class="k">then</span>
<span class="k">             if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">mpi_params</span><span class="p">%</span><span class="n">rank</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;Initializing GC fields from analytic EM fields&quot;)&#39;</span><span class="p">)</span>
             <span class="k">end if</span>

<span class="k">             if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">field_model</span><span class="p">(</span><span class="mi">12</span><span class="p">:</span><span class="mi">13</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;2D&#39;</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                call </span><span class="n">initialize_GC_fields</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
             <span class="k">else if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">field_model</span><span class="p">(</span><span class="mi">12</span><span class="p">:</span><span class="mi">13</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;3D&#39;</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                call </span><span class="n">initialize_GC_fields_3D</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
             <span class="k">end if             </span>

<span class="k">          end if</span>

          <span class="c">!F%Bfield= .FALSE.</span>
          <span class="c">!F%axisymmetric_fields = .TRUE.</span>
          <span class="c">!F%Bflux=.TRUE.</span>
          <span class="c">!F%Efield=.FALSE.</span>
          
       <span class="k">end if</span>

<span class="k">       if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">SC_E</span><span class="p">)</span> <span class="k">then</span>

<span class="k">          </span><span class="n">F</span><span class="p">%</span><span class="n">dim_1D</span><span class="o">=</span><span class="n">dim_1D</span>
          <span class="n">F</span><span class="p">%</span><span class="n">dt_E_SC</span><span class="o">=</span><span class="n">dt_E_SC</span>
          <span class="n">F</span><span class="p">%</span><span class="n">Ip_exp</span><span class="o">=</span><span class="n">Ip_exp</span>

          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">E_SC_1D</span><span class="p">%</span><span class="n">PHI</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dim_1D</span><span class="p">))</span>
          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">A1_SC_1D</span><span class="p">%</span><span class="n">PHI</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dim_1D</span><span class="p">))</span>
          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">A2_SC_1D</span><span class="p">%</span><span class="n">PHI</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dim_1D</span><span class="p">))</span>
          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">A3_SC_1D</span><span class="p">%</span><span class="n">PHI</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dim_1D</span><span class="p">))</span>
          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">J1_SC_1D</span><span class="p">%</span><span class="n">PHI</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dim_1D</span><span class="p">))</span>
          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">J2_SC_1D</span><span class="p">%</span><span class="n">PHI</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dim_1D</span><span class="p">))</span>
          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">J3_SC_1D</span><span class="p">%</span><span class="n">PHI</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dim_1D</span><span class="p">))</span>          
          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">r_1D</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dim_1D</span><span class="p">))</span>

          <span class="n">F</span><span class="p">%</span><span class="n">E_SC_1D</span><span class="p">%</span><span class="n">PHI</span><span class="o">=</span><span class="mf">0._rp</span>
          <span class="n">F</span><span class="p">%</span><span class="n">A1_SC_1D</span><span class="p">%</span><span class="n">PHI</span><span class="o">=</span><span class="mf">0._rp</span>
          <span class="n">F</span><span class="p">%</span><span class="n">A2_SC_1D</span><span class="p">%</span><span class="n">PHI</span><span class="o">=</span><span class="mf">0._rp</span>
          <span class="n">F</span><span class="p">%</span><span class="n">A3_SC_1D</span><span class="p">%</span><span class="n">PHI</span><span class="o">=</span><span class="mf">0._rp</span>
          <span class="n">F</span><span class="p">%</span><span class="n">J1_SC_1D</span><span class="p">%</span><span class="n">PHI</span><span class="o">=</span><span class="mf">0._rp</span>
          <span class="n">F</span><span class="p">%</span><span class="n">J2_SC_1D</span><span class="p">%</span><span class="n">PHI</span><span class="o">=</span><span class="mf">0._rp</span>
          <span class="n">F</span><span class="p">%</span><span class="n">J3_SC_1D</span><span class="p">%</span><span class="n">PHI</span><span class="o">=</span><span class="mf">0._rp</span>          
          <span class="n">F</span><span class="p">%</span><span class="n">r_1D</span><span class="o">=</span><span class="mf">0._rp</span>
                    
          <span class="k">do </span><span class="n">ii</span><span class="o">=</span><span class="mi">1_idef</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dim_1D</span>
             <span class="n">F</span><span class="p">%</span><span class="n">r_1D</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">AB</span><span class="p">%</span><span class="n">a</span><span class="o">/</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dim_1D</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
          <span class="k">end do</span>
<span class="k">          </span>
<span class="k">       end if</span>
       
<span class="c">!    CASE(&#39;EXTERNAL&#39;)</span>
    <span class="k">else if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">field_model</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">8</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;EXTERNAL&#39;</span><span class="p">)</span> <span class="k">then</span>
       <span class="c">! Load the magnetic field from an external HDF5 file</span>
       <span class="c">!open(unit=default_unit_open,file=TRIM(params%path_to_inputs), &amp;</span>
       <span class="c">!     status=&#39;OLD&#39;,form=&#39;formatted&#39;)</span>
       <span class="c">!read(default_unit_open,nml=externalPlasmaModel)</span>
       <span class="c">!close(default_unit_open)</span>

       <span class="n">F</span><span class="p">%</span><span class="n">Bfield</span> <span class="o">=</span> <span class="n">Bfield</span>
       <span class="n">F</span><span class="p">%</span><span class="n">dBfield</span> <span class="o">=</span> <span class="n">dBfield</span>
       <span class="n">F</span><span class="p">%</span><span class="n">Bflux</span> <span class="o">=</span> <span class="n">Bflux</span>
       <span class="n">F</span><span class="p">%</span><span class="n">Bflux3D</span> <span class="o">=</span> <span class="n">Bflux3D</span>
       <span class="n">F</span><span class="p">%</span><span class="n">Efield</span> <span class="o">=</span> <span class="n">Efield</span>
       <span class="n">F</span><span class="p">%</span><span class="n">axisymmetric_fields</span> <span class="o">=</span> <span class="n">axisymmetric_fields</span>
       <span class="n">F</span><span class="p">%</span><span class="n">Dim2x1t</span> <span class="o">=</span> <span class="n">Dim2x1t</span>
       <span class="n">F</span><span class="p">%</span><span class="n">ReInterp_2x1t</span> <span class="o">=</span> <span class="n">ReInterp_2x1t</span>
       <span class="n">F</span><span class="p">%</span><span class="n">t0_2x1t</span> <span class="o">=</span> <span class="n">t0_2x1t</span>
       <span class="n">F</span><span class="p">%</span><span class="n">ind0_2x1t</span> <span class="o">=</span> <span class="n">ind0_2x1t</span>

       <span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">proceed</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          call </span><span class="n">load_prev_iter</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
          <span class="n">F</span><span class="p">%</span><span class="n">ind_2x1t</span><span class="o">=</span><span class="n">params</span><span class="p">%</span><span class="n">prev_iter_2x1t</span>
       <span class="k">else</span>
<span class="k">          </span><span class="n">F</span><span class="p">%</span><span class="n">ind_2x1t</span><span class="o">=</span><span class="n">F</span><span class="p">%</span><span class="n">ind0_2x1t</span>
       <span class="k">end if</span>
<span class="k">          </span>

<span class="k">       </span><span class="n">F</span><span class="p">%</span><span class="n">E_2x1t</span> <span class="o">=</span> <span class="n">E_2x1t</span>
       
       <span class="n">F</span><span class="p">%</span><span class="n">E_dyn</span> <span class="o">=</span> <span class="n">E_dyn</span>
       <span class="n">F</span><span class="p">%</span><span class="n">E_pulse</span> <span class="o">=</span> <span class="n">E_pulse</span>
       <span class="n">F</span><span class="p">%</span><span class="n">E_width</span> <span class="o">=</span> <span class="n">E_width</span>

       <span class="n">F</span><span class="p">%</span><span class="n">PSIp_lim</span><span class="o">=</span><span class="n">PSIp_lim</span>
       
       <span class="n">F</span><span class="p">%</span><span class="n">res_double</span><span class="o">=</span><span class="n">res_double</span>

<span class="c">!       write(output_unit_write,&#39;(&quot;E_dyn: &quot;,E17.10)&#39;) E_dyn</span>
<span class="c">!       write(output_unit_write,&#39;(&quot;E_pulse: &quot;,E17.10)&#39;) E_pulse</span>
<span class="c">!       write(output_unit_write,&#39;(&quot;E_width: &quot;,E17.10)&#39;) E_width</span>
       
       <span class="k">call </span><span class="n">load_dim_data_from_hdf5</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
       <span class="c">!sets F%dims for 2D or 3D data</span>

       <span class="c">!write(output_unit_write,*) F%dims</span>
       
       <span class="k">call </span><span class="n">which_fields_in_file</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Bfield_in_file</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Efield_in_file</span><span class="p">,</span> <span class="p">&amp;</span>
            <span class="n">F</span><span class="p">%</span><span class="n">Bflux_in_file</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dBfield_in_file</span><span class="p">)</span>

       
       <span class="k">if</span> <span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">Bflux</span><span class="p">.</span><span class="nb">AND</span><span class="p">..</span><span class="nb">NOT</span><span class="p">.</span><span class="n">F</span><span class="p">%</span><span class="n">Bflux_in_file</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;ERROR: Magnetic flux to be used but no data in file!&quot;)&#39;</span><span class="p">)</span>
          <span class="k">call </span><span class="n">KORC_ABORT</span><span class="p">()</span>
       <span class="k">end if</span>

<span class="k">       if</span> <span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">Bfield</span><span class="p">.</span><span class="nb">AND</span><span class="p">..</span><span class="nb">NOT</span><span class="p">.</span><span class="n">F</span><span class="p">%</span><span class="n">Bfield_in_file</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;ERROR: Magnetic field to be used but no data in file!&quot;)&#39;</span><span class="p">)</span>
          <span class="k">call </span><span class="n">KORC_ABORT</span><span class="p">()</span>
       <span class="k">end if</span>

<span class="k">       if</span> <span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dBfield</span><span class="p">.</span><span class="nb">AND</span><span class="p">..</span><span class="nb">NOT</span><span class="p">.</span><span class="n">F</span><span class="p">%</span><span class="n">dBfield_in_file</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;ERROR: differential Magnetic field to be used &amp;</span>
<span class="s1">               but no data in file!&quot;)&#39;</span><span class="p">)</span>
<span class="c">!          call KORC_ABORT()</span>
       <span class="k">end if</span>
<span class="k">       </span>
<span class="k">       if</span> <span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">Efield</span><span class="p">.</span><span class="nb">AND</span><span class="p">..</span><span class="nb">NOT</span><span class="p">.</span><span class="n">F</span><span class="p">%</span><span class="n">Efield_in_file</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">mpi_params</span><span class="p">%</span><span class="n">rank</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0_idef</span><span class="p">)</span> <span class="k">then</span>
<span class="k">             write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(/,&quot;* * * * * * * * * *  FIELDS  * * * * * * * * * *&quot;)&#39;</span><span class="p">)</span>
             <span class="k">write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;MESSAGE: Analytical electric field will be used.&quot;)&#39;</span><span class="p">)</span>
             <span class="k">write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;* * * * * * * * * * * * ** * * * * * * * * * * *&quot;,/)&#39;</span><span class="p">)</span>
          <span class="k">end if</span>
<span class="k">       end if</span>

<span class="k">       if</span> <span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">axisymmetric_fields</span><span class="p">)</span> <span class="k">then</span>



<span class="k">          if</span> <span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">Dim2x1t</span><span class="p">)</span> <span class="k">then</span>

<span class="k">             call </span><span class="n">ALLOCATE_2D_FIELDS_ARRAYS</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Bfield</span><span class="p">,</span> <span class="p">&amp;</span>
                  <span class="n">F</span><span class="p">%</span><span class="n">Bflux</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dBfield</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Efield</span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="n">F</span><span class="p">%</span><span class="n">Efield_in_file</span><span class="p">)</span>
             
             <span class="k">call </span><span class="n">ALLOCATE_3D_FIELDS_ARRAYS</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Bfield</span><span class="p">,</span> <span class="p">&amp;</span>
                  <span class="n">F</span><span class="p">%</span><span class="n">Efield</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dBfield</span><span class="p">)</span>

          <span class="k">else</span>

<span class="k">             </span><span class="n">F</span><span class="p">%</span><span class="n">Efield_in_file</span><span class="o">=</span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>

             <span class="k">call </span><span class="n">ALLOCATE_2D_FIELDS_ARRAYS</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Bfield</span><span class="p">,</span> <span class="p">&amp;</span>
                  <span class="n">F</span><span class="p">%</span><span class="n">Bflux</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dBfield</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Efield</span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="n">F</span><span class="p">%</span><span class="n">Efield_in_file</span><span class="p">)</span>

             <span class="n">F</span><span class="p">%</span><span class="n">Efield_in_file</span><span class="o">=</span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
             
          <span class="k">end if</span>

<span class="k">       else</span>
<span class="k">          call </span><span class="n">ALLOCATE_3D_FIELDS_ARRAYS</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Bfield</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">Efield</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dBfield</span><span class="p">)</span>
          
       <span class="k">end if</span>
       <span class="c">!allocates 2D or 3D data arrays (fields and spatial)</span>

       
       <span class="k">call </span><span class="n">load_field_data_from_hdf5</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
            
       <span class="c">!       write(output_unit_write,*) F%PSIp</span>

       <span class="c">!write(output_unit_write,*) F%E_3D%PHI(:,F%ind0_2x1t,:)</span>

       
<span class="c">!       end if</span>

       <span class="k">if</span> <span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">Bflux</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          </span><span class="n">F</span><span class="p">%</span><span class="n">PSIP_min</span><span class="o">=</span><span class="nb">minval</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">PSIp</span><span class="p">)</span>         

       <span class="k">else if</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">Bflux3D</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          </span><span class="n">F</span><span class="p">%</span><span class="n">PSIP_min</span><span class="o">=</span><span class="nb">minval</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">PSIp3D</span><span class="p">(:,</span><span class="mi">1</span><span class="p">,:))</span>
       <span class="k">end if</span>

<span class="k">          </span>
<span class="k">       if</span> <span class="p">((.</span><span class="nb">not</span><span class="p">.</span><span class="n">F</span><span class="p">%</span><span class="n">Efield_in_file</span><span class="p">).</span><span class="nb">and</span><span class="p">.(.</span><span class="nb">not</span><span class="p">.</span><span class="n">F</span><span class="p">%</span><span class="n">Dim2x1t</span><span class="p">))</span> <span class="k">then</span>
<span class="k">          </span><span class="n">F</span><span class="p">%</span><span class="n">Eo</span> <span class="o">=</span> <span class="n">Eo</span>

          <span class="k">if</span> <span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">axisymmetric_fields</span><span class="p">)</span> <span class="k">then</span>
<span class="k">             </span><span class="n">F</span><span class="p">%</span><span class="n">E_2D</span><span class="p">%</span><span class="n">R</span><span class="o">=</span><span class="mf">0._rp</span>
             <span class="k">do </span><span class="n">ii</span><span class="o">=</span><span class="mi">1_idef</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">F</span><span class="p">%</span><span class="n">E_2D</span><span class="p">%</span><span class="n">PHI</span><span class="p">(</span><span class="n">ii</span><span class="p">,:)</span><span class="o">=</span><span class="n">F</span><span class="p">%</span><span class="n">Eo</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">Ro</span><span class="o">/</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
             <span class="k">end do</span>
<span class="k">             </span><span class="n">F</span><span class="p">%</span><span class="n">E_2D</span><span class="p">%</span><span class="n">Z</span><span class="o">=</span><span class="mf">0._rp</span>

          <span class="k">else</span>
<span class="k">             </span><span class="n">F</span><span class="p">%</span><span class="n">E_3D</span><span class="p">%</span><span class="n">R</span><span class="o">=</span><span class="mf">0._rp</span>
             <span class="k">do </span><span class="n">ii</span><span class="o">=</span><span class="mi">1_idef</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">F</span><span class="p">%</span><span class="n">E_3D</span><span class="p">%</span><span class="n">PHI</span><span class="p">(</span><span class="n">ii</span><span class="p">,:,:)</span><span class="o">=</span><span class="n">F</span><span class="p">%</span><span class="n">Eo</span><span class="o">*</span><span class="n">F</span><span class="p">%</span><span class="n">Ro</span><span class="o">/</span><span class="n">F</span><span class="p">%</span><span class="n">X</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
             <span class="k">end do</span>
<span class="k">             </span><span class="n">F</span><span class="p">%</span><span class="n">E_3D</span><span class="p">%</span><span class="n">Z</span><span class="o">=</span><span class="mf">0._rp</span>
          <span class="k">end if</span>
<span class="k">       end if</span>

<span class="k">       if</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dBfield</span><span class="p">.</span><span class="nb">and</span><span class="p">..</span><span class="nb">not</span><span class="p">.</span><span class="n">F</span><span class="p">%</span><span class="n">dBfield_in_file</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          if</span> <span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">axisymmetric_fields</span><span class="p">)</span> <span class="k">then</span>
<span class="k">             </span><span class="n">F</span><span class="p">%</span><span class="n">dBdR_2D</span><span class="p">%</span><span class="n">R</span><span class="o">=</span><span class="mf">0._rp</span>
             <span class="n">F</span><span class="p">%</span><span class="n">dBdR_2D</span><span class="p">%</span><span class="n">PHI</span><span class="o">=</span><span class="mf">0._rp</span>
             <span class="n">F</span><span class="p">%</span><span class="n">dBdR_2D</span><span class="p">%</span><span class="n">Z</span><span class="o">=</span><span class="mf">0._rp</span>

             <span class="n">F</span><span class="p">%</span><span class="n">dBdPHI_2D</span><span class="p">%</span><span class="n">R</span><span class="o">=</span><span class="mf">0._rp</span>
             <span class="n">F</span><span class="p">%</span><span class="n">dBdPHI_2D</span><span class="p">%</span><span class="n">PHI</span><span class="o">=</span><span class="mf">0._rp</span>
             <span class="n">F</span><span class="p">%</span><span class="n">dBdPHI_2D</span><span class="p">%</span><span class="n">Z</span><span class="o">=</span><span class="mf">0._rp</span>

             <span class="n">F</span><span class="p">%</span><span class="n">dBdZ_2D</span><span class="p">%</span><span class="n">R</span><span class="o">=</span><span class="mf">0._rp</span>
             <span class="n">F</span><span class="p">%</span><span class="n">dBdZ_2D</span><span class="p">%</span><span class="n">PHI</span><span class="o">=</span><span class="mf">0._rp</span>
             <span class="n">F</span><span class="p">%</span><span class="n">dBdZ_2D</span><span class="p">%</span><span class="n">Z</span><span class="o">=</span><span class="mf">0._rp</span>
          <span class="k">else</span>
<span class="k">             </span><span class="n">F</span><span class="p">%</span><span class="n">dBdR_3D</span><span class="p">%</span><span class="n">R</span><span class="o">=</span><span class="mf">0._rp</span>
             <span class="n">F</span><span class="p">%</span><span class="n">dBdR_3D</span><span class="p">%</span><span class="n">PHI</span><span class="o">=</span><span class="mf">0._rp</span>
             <span class="n">F</span><span class="p">%</span><span class="n">dBdR_3D</span><span class="p">%</span><span class="n">Z</span><span class="o">=</span><span class="mf">0._rp</span>

             <span class="n">F</span><span class="p">%</span><span class="n">dBdPHI_3D</span><span class="p">%</span><span class="n">R</span><span class="o">=</span><span class="mf">0._rp</span>
             <span class="n">F</span><span class="p">%</span><span class="n">dBdPHI_3D</span><span class="p">%</span><span class="n">PHI</span><span class="o">=</span><span class="mf">0._rp</span>
             <span class="n">F</span><span class="p">%</span><span class="n">dBdPHI_3D</span><span class="p">%</span><span class="n">Z</span><span class="o">=</span><span class="mf">0._rp</span>

             <span class="n">F</span><span class="p">%</span><span class="n">dBdZ_3D</span><span class="p">%</span><span class="n">R</span><span class="o">=</span><span class="mf">0._rp</span>
             <span class="n">F</span><span class="p">%</span><span class="n">dBdZ_3D</span><span class="p">%</span><span class="n">PHI</span><span class="o">=</span><span class="mf">0._rp</span>
             <span class="n">F</span><span class="p">%</span><span class="n">dBdZ_3D</span><span class="p">%</span><span class="n">Z</span><span class="o">=</span><span class="mf">0._rp</span>
          <span class="k">end if         </span>
<span class="k">       end if</span>
<span class="k">       </span>
<span class="k">       if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">mpi_params</span><span class="p">%</span><span class="n">rank</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>

<span class="k">          write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;EXTERNAL&quot;)&#39;</span><span class="p">)</span>
          <span class="k">write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;Magnetic field: &quot;,E17.10)&#39;</span><span class="p">)</span> <span class="n">F</span><span class="p">%</span><span class="n">Bo</span>
          <span class="k">write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;Electric field: &quot;,E17.10)&#39;</span><span class="p">)</span> <span class="n">F</span><span class="p">%</span><span class="n">Eo</span>

       <span class="k">end if</span>

<span class="k">       if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">SC_E</span><span class="p">)</span> <span class="k">then</span>

<span class="k">          </span><span class="n">F</span><span class="p">%</span><span class="n">dim_1D</span><span class="o">=</span><span class="n">dim_1D</span>
          <span class="n">F</span><span class="p">%</span><span class="n">dt_E_SC</span><span class="o">=</span><span class="n">dt_E_SC</span>
          <span class="n">F</span><span class="p">%</span><span class="n">Ip_exp</span><span class="o">=</span><span class="n">Ip_exp</span>

          <span class="k">write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;dt_E_SC&#39;</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dt_E_SC</span><span class="p">,</span><span class="s1">&#39;Ip_exp&#39;</span><span class="p">,</span><span class="n">Ip_exp</span>
          
          <span class="k">call </span><span class="n">allocate_1D_FS_arrays</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
          <span class="k">call </span><span class="n">load_1D_FS_from_hdf5</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>

<span class="c">!          write(output_unit_write,*) F%PSIP_1D</span>
          
       <span class="k">end if</span>
       
<span class="c">!       test=.true.</span>
       
<span class="c">!       if (F%Bflux.and.(.not.test)) then</span>

<span class="c">!          call initialize_fields_interpolant(params,F)</span>

<span class="c">!          F%Bfield=.TRUE.</span>
<span class="c">!          F%Efield=.TRUE.</span>
<span class="c">!          F%Efield_in_file=.TRUE.</span>


<span class="c">!          RMIN=F%X%R(1)</span>
<span class="c">!          RMAX=F%X%R(F%dims(1))</span>

<span class="c">!          ZMIN=F%X%Z(1)</span>
<span class="c">!          ZMAX=F%X%Z(F%dims(3))</span>

<span class="c">!          do ii=1_idef,res_double</span>
<span class="c">!             F%dims(1)=2*F%dims(1)-1</span>
<span class="c">!             F%dims(3)=2*F%dims(3)-1</span>
<span class="c">!          end do</span>

<span class="c">!          if (res_double&gt;0) then</span>
<span class="c">!             DEALLOCATE(F%X%R)</span>
<span class="c">!             DEALLOCATE(F%X%Z)</span>
<span class="c">!             DEALLOCATE(F%PSIp)</span>
<span class="c">!          end if</span>
          
<span class="c">!          call ALLOCATE_2D_FIELDS_ARRAYS(params,F,F%Bfield, &amp;</span>
<span class="c">!               F%Bflux,F%Efield.AND.F%Efield_in_file)</span>

<span class="c">!          do ii=1_idef,F%dims(1)</span>
<span class="c">!             F%X%R(ii)=RMIN+REAL(ii-1)/REAL(F%dims(1)-1)*(RMAX-RMIN)</span>
<span class="c">!          end do</span>

<span class="c">!          do ii=1_idef,F%dims(3)</span>
<span class="c">!             F%X%Z(ii)=ZMIN+REAL(ii-1)/REAL(F%dims(3)-1)*(ZMAX-ZMIN)</span>
<span class="c">!          end do            </span>
          
<span class="c">!          call calculate_initial_magnetic_field(F)</span>
          
<span class="c">!          F%E_2D%R=0._rp</span>
<span class="c">!          do ii=1_idef,F%dims(1)</span>
<span class="c">!             F%E_2D%PHI(ii,:)=F%Eo*F%Ro/F%X%R(ii)</span>
<span class="c">!          end do</span>
<span class="c">!          F%E_2D%Z=0._rp</span>
          
<span class="c">!       end if</span>

       
<span class="c">!       if (F%Bflux.and.test) then</span>

<span class="c">!          F%Bfield=.TRUE.</span>
<span class="c">!          F%Efield=.TRUE.</span>
<span class="c">!          F%Efield_in_file=.TRUE.</span>
            
          
<span class="c">!          call ALLOCATE_2D_FIELDS_ARRAYS(params,F,F%Bfield, &amp;</span>
<span class="c">!               F%Bflux,F%Efield.AND.F%Efield_in_file)</span>

          
          <span class="c">! B</span>
          <span class="c">! edge nodes at minimum R,Z</span>
<span class="c">!          F%B_2D%Z(1,:)=-(F%PSIp(2,:)-F%PSIp(1,:))/(F%X%R(2)-F%X%R(1))/F%X%R(1)</span>
<span class="c">!          F%B_2D%R(:,1)=(F%PSIp(:,2)-F%PSIp(:,1))/(F%X%Z(2)-F%X%Z(1))/F%X%R(:)</span>

          <span class="c">! edge nodes at maximum R,Z</span>
<span class="c">!          F%B_2D%Z(F%dims(1),:)=-(F%PSIp(F%dims(1),:)-F%PSIp(F%dims(1)-1,:))/ &amp;</span>
<span class="c">!               (F%X%R(F%dims(1))-F%X%R(F%dims(1)-1))/F%X%R(F%dims(1))</span>
<span class="c">!          F%B_2D%R(:,F%dims(3))=(F%PSIp(:,F%dims(3))-F%PSIp(:,F%dims(3)-1))/ &amp;</span>
<span class="c">!               (F%X%Z(F%dims(3))-F%X%Z(F%dims(3)-1))/F%X%R(:)</span>

<span class="c">!          do ii=2_idef,F%dims(1)-1</span>
             <span class="c">! central difference over R for interior nodes for BZ</span>
<span class="c">!             F%B_2D%Z(ii,:)=-(F%PSIp(ii+1,:)-F%PSIp(ii-1,:))/ &amp;</span>
<span class="c">!                  (F%X%R(ii+1)-F%X%R(ii-1))/F%X%R(ii)</span>

<span class="c">!          end do</span>
<span class="c">!          do ii=2_idef,F%dims(3)-1</span>
             <span class="c">! central difference over Z for interior nodes for BR</span>
<span class="c">!             F%B_2D%R(:,ii)=(F%PSIp(:,ii+1)-F%PSIp(:,ii-1))/ &amp;</span>
<span class="c">!                  (F%X%Z(ii+1)-F%X%Z(ii-1))/F%X%R(:)</span>
<span class="c">!          end do</span>

<span class="c">!          do ii=1_idef,F%dims(1)             </span>
<span class="c">!             F%B_2D%PHI(ii,:)=-F%Bo*F%Ro/F%X%R(ii)</span>
<span class="c">!          end do</span>

<span class="c">!          F%E_2D%R=0._rp</span>
<span class="c">!          do ii=1_idef,F%dims(1)</span>
<span class="c">!             F%E_2D%PHI(ii,:)=F%Eo*F%Ro/F%X%R(ii)</span>
<span class="c">!          end do</span>
<span class="c">!          F%E_2D%Z=0._rp</span>

<span class="c">!          F%Bfield=.FALSE.</span>
          

       
       <span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">mpi_params</span><span class="p">%</span><span class="n">rank</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>

<span class="k">          if</span> <span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">axisymmetric_fields</span><span class="p">)</span> <span class="k">then</span>
<span class="k">             if</span> <span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">Bflux</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;PSIp(r=0)&quot;,E17.10)&#39;</span><span class="p">)</span> <span class="n">F</span><span class="p">%</span><span class="n">PSIp</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;BPHI(r=0)&quot;,E17.10)&#39;</span><span class="p">)</span> <span class="n">F</span><span class="p">%</span><span class="n">Bo</span>
                <span class="k">write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;EPHI(r=0)&quot;,E17.10)&#39;</span><span class="p">)</span> <span class="n">F</span><span class="p">%</span><span class="n">Eo</span>
             <span class="k">else if</span> <span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">Bflux3D</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;PSIp(r=0)&quot;,E17.10)&#39;</span><span class="p">)</span> <span class="n">F</span><span class="p">%</span><span class="n">PSIp3D</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
             <span class="k">else</span>
<span class="k">                write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;BR(r=0)&quot;,E17.10)&#39;</span><span class="p">)</span> <span class="n">F</span><span class="p">%</span><span class="n">B_2D</span><span class="p">%</span><span class="n">R</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;BPHI(r=0)&quot;,E17.10)&#39;</span><span class="p">)</span> <span class="p">&amp;</span>
                     <span class="n">F</span><span class="p">%</span><span class="n">B_2D</span><span class="p">%</span><span class="n">PHI</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;BZ(r=0)&quot;,E17.10)&#39;</span><span class="p">)</span> <span class="n">F</span><span class="p">%</span><span class="n">B_2D</span><span class="p">%</span><span class="n">Z</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;EPHI(r=0)&quot;,E17.10)&#39;</span><span class="p">)</span> <span class="p">&amp;</span>
                     <span class="n">F</span><span class="p">%</span><span class="n">E_2D</span><span class="p">%</span><span class="n">PHI</span><span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">F</span><span class="p">%</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
             <span class="k">end if</span>
<span class="k">          end if</span>


<span class="k">       end if</span>

<span class="k">       if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">orbit_model</span><span class="p">(</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">).</span><span class="n">EQ</span><span class="p">.</span><span class="s1">&#39;pre&#39;</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">mpi_params</span><span class="p">%</span><span class="n">rank</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<span class="k">             write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;Initializing GC fields from external EM fields&quot;)&#39;</span><span class="p">)</span>
          <span class="k">end if</span>

<span class="k">          if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">field_model</span><span class="p">(</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;2DB&#39;</span><span class="p">)</span> <span class="k">then</span>
<span class="k">             if</span> <span class="p">(</span><span class="n">F</span><span class="p">%</span><span class="n">axisymmetric_fields</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                call </span><span class="n">initialize_GC_fields</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>             
             <span class="k">else             </span>
<span class="k">                call </span><span class="n">initialize_GC_fields_3D</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
             <span class="k">end if</span>
<span class="k">          end if</span>
<span class="k">       end if</span>

       <span class="c">!       write(output_unit_write,&#39;(&quot;gradBR&quot;,E17.10)&#39;) F%gradB_2D%R(F%dims(1)/2,F%dims(3)/2)</span>
       <span class="c">!       write(output_unit_write,&#39;(&quot;gradBPHI&quot;,E17.10)&#39;) F%gradB_2D%PHI(F%dims(1)/2,F%dims(3)/2)</span>
       <span class="c">!       write(output_unit_write,&#39;(&quot;gradBZ&quot;,E17.10)&#39;) F%gradB_2D%Z(F%dims(1)/2,F%dims(3)/2)</span>

    <span class="k">end if</span>

<span class="k">    if</span> <span class="p">(</span><span class="n">params</span><span class="p">%</span><span class="n">mpi_params</span><span class="p">%</span><span class="n">rank</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<span class="k">       write</span><span class="p">(</span><span class="n">output_unit_write</span><span class="p">,</span><span class="s1">&#39;(&quot;* * * * * * * * * * * * * * * * * * * * * * * * *&quot;,/)&#39;</span><span class="p">)</span>
    <span class="k">end if</span>
<span class="k">       </span>
<span class="k">  end subroutine </span><span class="n">initialize_fields</span>
</pre></div>

    </section>
    <br>
    
    
    </div>
  </div>


    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2020 
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on  
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> KORC was developed by Matt Beidler</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>